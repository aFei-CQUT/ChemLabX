ç›®å½•ç»“æ„:
|-- æ–‡ä»¶: .gitattributes
|-- æ–‡ä»¶: .gitignore
|-- æ–‡ä»¶å¤¹: csv_data
|   |-- æ–‡ä»¶å¤¹: ä¼ çƒ­
|   |   |-- æ–‡ä»¶å¤¹: ä¼ çƒ­åŸå§‹æ•°æ®è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®_æ— å¼ºåŒ–å¥—ç®¡.csv
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®_æœ‰å¼ºåŒ–å¥—ç®¡.csv
|   |   |   |-- æ–‡ä»¶: æ•°æ®é¢„å¤„ç†_æ— å¼ºåŒ–å¥—ç®¡.csv
|   |   |   |-- æ–‡ä»¶: æ•°æ®é¢„å¤„ç†_æœ‰å¼ºåŒ–å¥—ç®¡.csv
|   |   |-- æ–‡ä»¶å¤¹: ä¼ çƒ­åŸå§‹æ•°æ®è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®.csv
|   |   |   |-- æ–‡ä»¶: æ•°æ®é¢„å¤„ç†ç»“æœ.csv
|   |-- æ–‡ä»¶å¤¹: å¹²ç‡¥
|   |   |-- æ–‡ä»¶å¤¹: å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®1.csv
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®2.csv
|   |   |   |-- æ–‡ä»¶: æ•°æ®é¢„å¤„ç†.csv
|   |   |-- æ–‡ä»¶å¤¹: å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®1.csv
|   |   |   |-- æ–‡ä»¶: åŸå§‹æ•°æ®2.csv
|   |   |   |-- æ–‡ä»¶: æ•°æ®é¢„å¤„ç†.csv
|   |-- æ–‡ä»¶å¤¹: æµä½“
|   |   |-- æ–‡ä»¶å¤¹: æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: æµä½“é˜»åŠ›åŸå§‹æ•°æ®.csv
|   |   |   |-- æ–‡ä»¶: ç¦»å¿ƒæ³µåŸå§‹æ•°æ®.csv
|   |   |-- æ–‡ä»¶å¤¹: æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: æµä½“é˜»åŠ›åŸå§‹æ•°æ®.csv
|   |   |   |-- æ–‡ä»¶: ç¦»å¿ƒæ³µåŸå§‹æ•°æ®.csv
|   |-- æ–‡ä»¶å¤¹: ç²¾é¦
|   |   |-- æ–‡ä»¶å¤¹: ç²¾é¦åŸå§‹è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: Sheet1.csv
|   |   |-- æ–‡ä»¶å¤¹: ç²¾é¦åŸå§‹è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: Sheet1.csv
|   |-- æ–‡ä»¶å¤¹: èƒå–
|   |   |-- æ–‡ä»¶å¤¹: èƒå–åŸå§‹æ•°æ®è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: 1_åŸå§‹æ•°æ®è®°å½•.csv
|   |   |   |-- æ–‡ä»¶: 2_æ•°æ®é¢„å¤„ç†.csv
|   |   |   |-- æ–‡ä»¶: 3_åˆ†é…æ›²çº¿æ•°æ®é›†.csv
|   |   |   |-- æ–‡ä»¶: 5_å›¾è§£ç§¯åˆ†æ•°æ®é›†.csv
|   |   |   |-- æ–‡ä»¶: 6_å›¾è§£ç§¯åˆ†å›¾.csv
|   |   |   |-- æ–‡ä»¶: 7_ç»“æœæ•´åˆ.csv
|   |   |-- æ–‡ä»¶å¤¹: èƒå–åŸå§‹æ•°æ®è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: 1_åŸå§‹æ•°æ®è®°å½•.csv
|   |   |   |-- æ–‡ä»¶: 2_æ•°æ®é¢„å¤„ç†.csv
|   |   |   |-- æ–‡ä»¶: 3_åˆ†é…æ›²çº¿æ•°æ®é›†.csv
|   |   |   |-- æ–‡ä»¶: 5_å›¾è§£ç§¯åˆ†æ•°æ®é›†.csv
|   |-- æ–‡ä»¶å¤¹: è§£å¸
|   |   |-- æ–‡ä»¶å¤¹: è§£å¸åŸå§‹è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: å¹²å¡«æ–™.csv
|   |   |   |-- æ–‡ä»¶: æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv
|   |   |   |-- æ–‡ä»¶: æ¹¿å¡«æ–™.csv
|   |   |   |-- æ–‡ä»¶: ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv
|   |   |-- æ–‡ä»¶å¤¹: è§£å¸åŸå§‹è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: å¹²å¡«æ–™.csv
|   |   |   |-- æ–‡ä»¶: æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv
|   |   |   |-- æ–‡ä»¶: æ¹¿å¡«æ–™.csv
|   |   |   |-- æ–‡ä»¶: ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv
|   |-- æ–‡ä»¶å¤¹: è¿‡æ»¤
|   |   |-- æ–‡ä»¶å¤¹: è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨(é)
|   |   |   |-- æ–‡ä»¶: Sheet1.csv
|   |   |-- æ–‡ä»¶å¤¹: è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨[ç©º]
|   |   |   |-- æ–‡ä»¶: Sheet1.csv
|-- æ–‡ä»¶å¤¹: gui
|   |-- æ–‡ä»¶: app.py
|   |-- æ–‡ä»¶å¤¹: screens
|   |   |-- æ–‡ä»¶å¤¹: calculators
|   |   |   |-- æ–‡ä»¶: distillation_calculator.py
|   |   |   |-- æ–‡ä»¶: drying_calculator.py
|   |   |   |-- æ–‡ä»¶: extraction_calculator.py
|   |   |   |-- æ–‡ä»¶: filteration_calculator.py
|   |   |   |-- æ–‡ä»¶: fluid_flow_calculator.py
|   |   |   |-- æ–‡ä»¶: heat_transfer_calculator.py
|   |   |   |-- æ–‡ä»¶: oxygen_desorption_calculator.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: common_screens
|   |   |   |-- æ–‡ä»¶: base_screen.py
|   |   |   |-- æ–‡ä»¶: data_record_screen.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: common_widgets
|   |   |   |-- æ–‡ä»¶: plot_widget.py
|   |   |   |-- æ–‡ä»¶: spin_entries_widget.py
|   |   |   |-- æ–‡ä»¶: string_entries_widget.py
|   |   |   |-- æ–‡ä»¶: table_widget.py
|   |   |   |-- æ–‡ä»¶: text_widget.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: distillation_screen.py
|   |   |-- æ–‡ä»¶: drying_screen.py
|   |   |-- æ–‡ä»¶: extraction_screen.py
|   |   |-- æ–‡ä»¶: filteration_screen.py
|   |   |-- æ–‡ä»¶: fluid_flow_screen.py
|   |   |-- æ–‡ä»¶: heat_transfer_screen.py
|   |   |-- æ–‡ä»¶å¤¹: maths
|   |   |   |-- æ–‡ä»¶: common_maths.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: oxygen_desorption_screen.py
|   |   |-- æ–‡ä»¶å¤¹: plotters
|   |   |   |-- æ–‡ä»¶: distillation_plotter.py
|   |   |   |-- æ–‡ä»¶: drying_plotter.py
|   |   |   |-- æ–‡ä»¶: extraction_plotter.py
|   |   |   |-- æ–‡ä»¶: filteration_plotter.py
|   |   |   |-- æ–‡ä»¶: fluid_flow_plotter.py
|   |   |   |-- æ–‡ä»¶: heat_transfer_plotter.py
|   |   |   |-- æ–‡ä»¶: oxygen_desorption_plotter.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: processors
|   |   |   |-- æ–‡ä»¶: distillation_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: drying_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: extraction_expriment_processor.py
|   |   |   |-- æ–‡ä»¶: filteration_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: fluid_flow_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: heat_transfer_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: oxygen_desorption_experiment_processor.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: utils
|   |   |   |-- æ–‡ä»¶: config.py
|   |   |   |-- æ–‡ä»¶: expserial.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: widgets
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: __init__.py
|   |-- æ–‡ä»¶: __init__.py
|-- æ–‡ä»¶: LICENSE
|-- æ–‡ä»¶å¤¹: logos
|   |-- æ–‡ä»¶: ce.icns
|   |-- æ–‡ä»¶: ce.ico
|   |-- æ–‡ä»¶: ce.png
|-- æ–‡ä»¶: main.py
|-- æ–‡ä»¶å¤¹: manual
|   |-- (ç©ºç›®å½•)
|-- æ–‡ä»¶: README.md
|-- æ–‡ä»¶: requirements.txt
|-- æ–‡ä»¶: __init__.py


================================================================================
E:\Chem-Experiment-Process-App\.gitignore çš„å†…å®¹:
================================================================================
*.png
*.zip
*.xlsx
*.pyc

================================================================================
E:\Chem-Experiment-Process-App\main.py çš„å†…å®¹:
================================================================================
# Author: åˆ˜æŠ—é
# æœ¬è½¯ä»¶å‚è€ƒ åŒ—äº¬å¤§å­¦-ç‰©ç†åŒ–å­¦æº¶è§£ç‡ƒçƒ§çƒ­ä¸­çº§å®éªŒé¡¹ç›®ï¼ˆAuthorï¼šèµµæ³½åï¼‰ çš„è®¾è®¡è¿›è¡Œæ¶æ„çš„è®¾è®¡
# è¯¥è½¯ä»¶ä¸ºéç›ˆåˆ©è½¯ä»¶ï¼Œè‹¥åˆ†å‘è¯·å‚è€ƒ LICENSE æ–‡ä»¶

"""
å¿«é€Ÿå¯åŠ¨:
    è¿è¡Œ"main-win.exe"æˆ–"main-mac.app"å³å¯è‡ªåŠ¨è¿è¡Œmain.py
    å¦‚å‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå°è¯•è¿è¡Œ"requirements-win.exe"æˆ–"requirements-mac.app"å®‰è£…æˆ–æ›´æ–°ä¾èµ–åº“
    main-win/macéœ€è¦ä¸main.pyåœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œrequirements-win/macéœ€è¦ä¸requirements.txtåœ¨åŒä¸€ç›®å½•ä¸‹

å¯è°ƒå‚æ•°:
    dx: ç§¯åˆ†ã€ç»˜å›¾æ­¥é•¿
    time_interval: è®°å½•æ•°æ®é—´éš”ï¼Œå•ä½æ¯«ç§’
    plot_max_points: ç»˜å›¾æœ€å¤§ç‚¹æ•°
    port_timeout: ä¸²å£è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’
    std_limit: è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æ ‡å‡†å·®é˜ˆå€¼
    time_lower_limit: è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æœ€å°æ—¶é—´çª—å£
    time_upper_limit: è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æœ€å¤§æ—¶é—´çª—å£
    width_height_inches: ä¿å­˜å›¾ç‰‡å°ºå¯¸ï¼Œå•ä½è‹±å°º
    dpi: ä¿å­˜å›¾ç‰‡DPI

å†…ç½®åº“:
    csv
    os
    re
    sys
    shutil
    time
    tkinter
"""

# å†…ç½®åº“
import sys
import os
import shutil

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(current_script_path))
sys.path.insert(0, project_root)

# è‡ªå»ºåº“
from gui.app import App

# å¯è°ƒå‚æ•°
dx = 0.1  # ç§¯åˆ†ã€ç»˜å›¾æ­¥é•¿
time_interval = 500  # è®°å½•æ•°æ®é—´éš”ï¼Œå•ä½æ¯«ç§’
plot_max_points = 500  # ç»˜å›¾æœ€å¤§ç‚¹æ•°
port_timeout = 0.25  # ä¸²å£è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’
std_limit = 0.005  # è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æ ‡å‡†å·®é˜ˆå€¼
time_lower_limit = 30  # è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æœ€å°æ—¶é—´çª—å£
time_upper_limit = 40  # è‡ªåŠ¨å¯»æ‰¾å¹³å°æœŸçš„æœ€å¤§æ—¶é—´çª—å£
width_height_inches = (10, 6)  # ä¿å­˜å›¾ç‰‡å°ºå¯¸ï¼Œå•ä½è‹±å°º
dpi = 600  # ä¿å­˜å›¾ç‰‡DPI

if __name__ == "__main__":
    # è·å–å½“å‰è·¯å¾„
    # å¦‚æœæ˜¯pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶ï¼Œåˆ™è·å–å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
    if getattr(sys, "frozen", False):
        py_path = os.path.dirname(os.path.abspath(sys.executable))
        # å¦‚æœæ˜¯mac
        if sys.platform == "darwin":
            for i in range(3):
                py_path = os.path.dirname(py_path)
    # å¦‚æœæ˜¯è¿è¡Œçš„pyæ–‡ä»¶ï¼Œåˆ™è·å–pyæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
    else:
        py_path = os.path.dirname(os.path.abspath(__file__))
    App(
        dx,
        time_interval,
        plot_max_points,
        port_timeout,
        std_limit,
        time_lower_limit,
        time_upper_limit,
        width_height_inches,
        dpi,
        py_path,
    )
    # æ¸…é™¤ç¼“å­˜æ–‡ä»¶å¤¹
    pycache_dir = py_path + "/__pycache__"
    if os.path.exists(pycache_dir):
        shutil.rmtree(pycache_dir)


================================================================================
E:\Chem-Experiment-Process-App\README.md çš„å†…å®¹:
================================================================================
# Chem-Filter ğŸ§ª

**é‡åº†ç†å·¥å¤§å­¦åŒ–å­¦åŒ–å·¥å­¦é™¢åŒ–å·¥å®éªŒè®¾è®¡å¤§èµ›å‚èµ›é¡¹ç›®**

## é¡¹ç›®ç®€ä»‹

Chem-Filter æ˜¯ä¸€ä¸ªå®éªŒæ•°æ®å¤„ç†ä¸å¯è§†åŒ–çš„å·¥å…·ï¼Œä¸“ä¸ºåŒ–å­¦å®éªŒä¸­çš„æ•°æ®åˆ†æè€Œè®¾è®¡ã€‚è¯¥å·¥å…·é€šè¿‡å›¾å½¢åŒ–ç•Œé¢ï¼Œæ”¯æŒå¯¼å…¥æ•°æ®ã€æ•°æ®å¤„ç†ã€å¼‚å¸¸å€¼æ£€æµ‹åŠæ‹Ÿåˆåˆ†æï¼Œæœ€ç»ˆè¾“å‡ºå¤„ç†ç»“æœå¹¶ç”Ÿæˆå›¾è¡¨ï¼Œä»¥å¸®åŠ©å®éªŒäººå‘˜æ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œå®éªŒæ•°æ®åˆ†æã€‚

## åŠŸèƒ½æ¦‚è¿°

- **æ•°æ®åŠ è½½ä¸å¤„ç†**ï¼šæ”¯æŒä» CSV æ–‡ä»¶ä¸­å¯¼å…¥å®éªŒæ•°æ®ï¼Œè¿›è¡Œæ•°æ®æ¸…æ´—ã€æ ‡å‡†åŒ–å¤„ç†ã€‚
- **å¼‚å¸¸å€¼æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ’é™¤æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼Œä»¥æé«˜æ‹Ÿåˆç»“æœçš„å‡†ç¡®æ€§ã€‚
- **æ•°æ®æ‹Ÿåˆ**ï¼šæ”¯æŒçº¿æ€§æ‹Ÿåˆï¼Œå¹¶æä¾›æ‹Ÿåˆç»“æœçš„æ–œç‡ã€æˆªè·ç­‰ä¿¡æ¯ã€‚
- **å›¾è¡¨ç”Ÿæˆä¸å±•ç¤º**ï¼šç”ŸæˆåŒ…å«æ•°æ®æ‹Ÿåˆæ›²çº¿ã€å¼‚å¸¸å€¼æ£€æµ‹å›¾ã€æ•°æ®åˆ†å¸ƒç­‰çš„å„ç±»å›¾è¡¨ã€‚
- **ç»“æœå‹ç¼©ä¸å¯¼å‡º**ï¼šå°†ç”Ÿæˆçš„å›¾è¡¨å’Œæ•°æ®ç»“æœå‹ç¼©æˆ ZIP æ–‡ä»¶ï¼Œä¾¿äºåˆ†å‘å’Œå­˜å‚¨ã€‚

## æŠ€æœ¯æ ˆ

- **Python**ï¼šä¸»è¦ç¼–ç¨‹è¯­è¨€
- **Tkinter**ï¼šç”¨äºæ„å»ºå›¾å½¢ç•Œé¢
- **Matplotlib**ï¼šç”¨äºç»˜åˆ¶å›¾è¡¨å’Œå¯è§†åŒ–æ•°æ®
- **Pandas**ï¼šç”¨äºå¤„ç†å®éªŒæ•°æ®
- **NumPy**ï¼šç”¨äºç§‘å­¦è®¡ç®—
- **Scikit-learn**ï¼šç”¨äºæ•°æ®æ‹Ÿåˆå’Œå¼‚å¸¸å€¼æ£€æµ‹

## å®‰è£…æŒ‡å—

### ç¯å¢ƒå‡†å¤‡

1. å®‰è£… Python 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
2. å®‰è£…æ‰€éœ€çš„ä¾èµ–åº“ï¼š

```bash
pip install -r requirements.txt
```

### è¿è¡Œé¡¹ç›®

1. å°†é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼š

```bash
git clone https://github.com/your-username/Chem-Filter.git
```

2. è¿›å…¥é¡¹ç›®ç›®å½•å¹¶è¿è¡Œä¸»ç¨‹åºï¼š

```bash
python main.py
```

3. æ‰“å¼€ GUI ç•Œé¢åï¼Œé€‰æ‹©éœ€è¦åˆ†æçš„ CSV æ•°æ®æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å¤„ç†ã€æ‹ŸåˆåŠå›¾è¡¨ç”Ÿæˆã€‚

## ä½¿ç”¨è¯´æ˜

1. **å¯¼å…¥æ•°æ®**ï¼šç‚¹å‡»â€œå¯¼å…¥æ•°æ®â€æŒ‰é’®ï¼Œé€‰æ‹©éœ€è¦åˆ†æçš„ CSV æ–‡ä»¶ã€‚æ”¯æŒçš„æ•°æ®æ ¼å¼ä¸ºæ ‡å‡†çš„ CSV æ–‡ä»¶ã€‚
2. **å¤„ç†æ•°æ®**ï¼šç‚¹å‡»â€œå¤„ç†æ•°æ®â€æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€æ‹Ÿåˆï¼Œå¹¶æ£€æµ‹å¼‚å¸¸å€¼ã€‚
3. **ç»˜åˆ¶å›¾å½¢**ï¼šå¤„ç†å®Œæ•°æ®åï¼Œç‚¹å‡»â€œç»˜åˆ¶å›¾å½¢â€æŒ‰é’®ï¼Œç”Ÿæˆæ•°æ®æ‹Ÿåˆæ›²çº¿å’Œå¼‚å¸¸å€¼æ£€æµ‹å›¾ã€‚
4. **å¯¼å‡ºç»“æœ**ï¼šæ‰€æœ‰ç»“æœå›¾è¡¨ä¼šä¿å­˜åœ¨é¡¹ç›®æ–‡ä»¶å¤¹çš„â€œæ‹Ÿåˆå›¾ç»“æœâ€ä¸­ï¼Œå¹¶è‡ªåŠ¨å‹ç¼©æˆ ZIP æ–‡ä»¶ï¼Œä¾¿äºåˆ†äº«å’Œå­˜æ¡£ã€‚

## é¡¹ç›®ç»“æ„

```
ç›®å½•ç»“æ„:
|-- æ–‡ä»¶: .gitattributes
|-- æ–‡ä»¶: .gitignore
|-- æ–‡ä»¶å¤¹: .vscode
|   |-- (ç©ºç›®å½•)
|-- æ–‡ä»¶å¤¹: gui
|   |-- æ–‡ä»¶: app.py
|   |-- æ–‡ä»¶å¤¹: logos
|   |   |-- æ–‡ä»¶: chem.icns
|   |   |-- æ–‡ä»¶: chem.ico
|   |   |-- æ–‡ä»¶: chem.png
|   |-- æ–‡ä»¶å¤¹: screens
|   |   |-- æ–‡ä»¶å¤¹: common_screens
|   |   |   |-- æ–‡ä»¶: base_record_data_screen.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: filteration_calculator.py
|   |   |-- æ–‡ä»¶: filteration_experiment_processor.py
|   |   |-- æ–‡ä»¶: filteration_plotter.py
|   |   |-- æ–‡ä»¶: filteration_screen.py
|   |   |-- æ–‡ä»¶: __init__.py
|   |-- æ–‡ä»¶å¤¹: utils
|   |   |-- æ–‡ä»¶: config.py
|   |   |-- æ–‡ä»¶: expserial.py
|   |   |-- æ–‡ä»¶å¤¹: funcs
|   |   |   |-- æ–‡ä»¶: dct2cols.py
|   |   |   |-- æ–‡ä»¶: file_name_extension.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶å¤¹: maths
|   |   |   |-- æ–‡ä»¶: common_maths.py
|   |   |   |-- æ–‡ä»¶: maths_filteration.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: __init__.py
|   |-- æ–‡ä»¶å¤¹: widgets
|   |   |-- æ–‡ä»¶å¤¹: common_widgets
|   |   |   |-- æ–‡ä»¶: plot_widget.py
|   |   |   |-- æ–‡ä»¶: spin_entries_widget.py
|   |   |   |-- æ–‡ä»¶: string_entries_widget.py
|   |   |   |-- æ–‡ä»¶: table_widget.py
|   |   |   |-- æ–‡ä»¶: text_widget.py
|   |   |   |-- æ–‡ä»¶: __init__.py
|   |   |-- æ–‡ä»¶: filteration_spin_entries_widget.py
|   |   |-- æ–‡ä»¶: __init__.py
|   |-- æ–‡ä»¶: __init__.py
|-- æ–‡ä»¶: LICENSE
|-- æ–‡ä»¶: main.py
|-- æ–‡ä»¶å¤¹: manual
|   |-- (ç©ºç›®å½•)
|-- æ–‡ä»¶: README.md
|-- æ–‡ä»¶: requirements.txt
|-- æ–‡ä»¶: __init__.py
|-- æ–‡ä»¶å¤¹: æ‹Ÿåˆå›¾ç»“æœ
|   |-- æ–‡ä»¶: 1.png
|   |-- æ–‡ä»¶: 2.png
|   |-- æ–‡ä»¶: 3.png
|   |-- æ–‡ä»¶: 4.png
|   |-- æ–‡ä»¶: 5.png
|   |-- æ–‡ä»¶: 6.png
|   |-- æ–‡ä»¶: 7.png
|   |-- æ–‡ä»¶: 8.png
|   |-- æ–‡ä»¶: æ‹Ÿåˆå›¾æ•´åˆå›¾.png
|-- æ–‡ä»¶: æ‹Ÿåˆå›¾ç»“æœ.zip
|-- æ–‡ä»¶: è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨(é).csv
```

## å¼€å‘è€…

- **é¡¹ç›®è´Ÿè´£äºº**ï¼šåˆ˜æŠ—é
- **å¼€å‘äººå‘˜**ï¼šåˆ˜æŠ—é

## License

è¯¥é¡¹ç›®éµå¾ª GNU è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## é¸£è°¢

æœ¬é¡¹ç›®æ˜¯å—åˆ° [åŒ—äº¬å¤§å­¦-åŒ–å­¦ä¸åˆ†å­å·¥ç¨‹å­¦é™¢-ä¸­çº§ç‰©ç†åŒ–å­¦å®éªŒé¡¹ç›®](https://github.com/Zhao-Zehua/Dissolution-Combustion) çš„å¯å‘ï¼Œå‚è€ƒå…¶ä¸­çš„é€»è¾‘é‡æ–°è®¾è®¡ç»“æ„åç¼–å†™çš„ã€‚åœ¨æ­¤è¦ç‰¹åˆ«é¸£è°¢[Zehua ZhaoåŒå­¦](https://github.com/Zhao-Zehua)ã€‚


================================================================================
E:\Chem-Experiment-Process-App\requirements.txt çš„å†…å®¹:
================================================================================
# === pythonç‰ˆæœ¬ ===
# python = 3.9.21

# === ç¬¬ä¸‰æ–¹æ ¸å¿ƒç§‘å­¦è®¡ç®—åº“ ===
numpy
pandas
matplotlib
scikit-learn

# === æ•°æ®å¤„ç†ä¸æ–‡ä»¶æ“ä½œ ===
openpyxl                    # å¤„ç† Excel æ–‡ä»¶
opencv-python               # OpenCV å›¾åƒå¤„ç†

# === GUI ç›¸å…³ä¾èµ– ===
ttkbootstrap                # ç¬¬ä¸‰æ–¹ä¸»é¢˜åº“ï¼ˆç¡®ä¿åç§°æ­£ç¡®ï¼ŒPyPI ä¸Šçš„åŒ…åä¸º ttkthemesï¼‰

# === æ ‡å‡†åº“ï¼ˆæ— éœ€å®‰è£…ï¼Œä»…ä½œè¯´æ˜ï¼‰ ===
# logging       --> Python å†…ç½®
# tkinter       --> Python å†…ç½®

================================================================================
E:\Chem-Experiment-Process-App\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\app.py çš„å†…å®¹:
================================================================================
# app.py

# å¯¼å…¥æ ‡å‡†åº“ç»“æœ
import logging
import traceback
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(current_script_path))
sys.path.insert(0, project_root)

# å¯¼å…¥å¤–éƒ¨åº“
import ttkbootstrap as ttk
from tkinter import PhotoImage

# å¯¼å…¥å±å¹•ç±»
from gui.screens.filteration_screen import Filteration_Screen
from gui.screens.heat_transfer_screen import Heat_Transfer_Screen
from gui.screens.extraction_screen import Extraction_Screen
from gui.screens.drying_screen import Drying_Screen
from gui.screens.oxygen_desorption_screen import Oxygen_Desorption_Screen
from gui.screens.distillation_screen import Distillation_Screen
from gui.screens.fluid_flow_screen import Fluid_Flow_Screen

# å¯¼å…¥é…ç½®
from gui.screens.utils.config import *

# é…ç½®æ—¥å¿—è®°å½•
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")


class App:
    """
    åº”ç”¨ä¸»ä½“
    """

    def __init__(
        self,
        dx: float = 0.1,
        time_interval: int = 500,
        plot_max_points: int = 500,
        port_timeout: float = 0.25,
        std_limit: float = 0.005,
        time_lower_limit: int = 30,
        time_upper_limit: int = 40,
        width_height_inches: tuple = (10, 7),
        dpi: int = 600,
        py_path: str = os.path.dirname(os.path.abspath(__file__)),
    ):
        # æ•°æ®é…ç½®
        DATA_CONFIG["app"] = self
        DATA_CONFIG["dx"] = dx
        DATA_CONFIG["time_interval"] = time_interval
        DATA_CONFIG["plot_max_points"] = plot_max_points
        DATA_CONFIG["port_timeout"] = port_timeout
        DATA_CONFIG["py_path"] = py_path
        DATA_CONFIG["std_limit"] = std_limit
        DATA_CONFIG["time_lower_limit"] = time_lower_limit
        DATA_CONFIG["time_upper_limit"] = time_upper_limit
        DATA_CONFIG["width_height_inches"] = width_height_inches
        DATA_CONFIG["dpi"] = dpi

        # åˆå§‹åŒ–çª—å£
        DATA_CONFIG["window"] = ttk.Window(
            themename="sandstone",
            title="å®éªŒæ•°æ®é‡‡é›†ä¸å¤„ç†è½¯ä»¶ v1.0.0",
        )

        try:
            if sys.platform.startswith("darwin"):
                DATA_CONFIG["window"].iconphoto(
                    True,
                    PhotoImage(file="logos/ce.png"),
                )
            else:
                DATA_CONFIG["window"].iconbitmap("logos/ce.ico")
        except:
            pass

        # è®¾ç½®çª—å£æœ€å°å°ºå¯¸
        min_height = 960
        min_width = int(min_height * 4 / 3)
        DATA_CONFIG["window"].minsize(min_width, min_height)
        DATA_CONFIG["window"].geometry(f"{min_width}x{min_height}")

        # è·å–å±å¹•å°ºå¯¸
        screen_height = DATA_CONFIG["window"].winfo_screenheight()
        screen_width = DATA_CONFIG["window"].winfo_screenwidth()

        # é»˜è®¤çª—å£å°ºå¯¸ä¸ºå±å¹•é«˜åº¦çš„75%ï¼Œæ¯”ä¾‹4:3
        default_height = int(screen_height * 0.75)
        default_width = int(screen_height * 0.75 * 4 / 3)

        # æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´çª—å£å°ºå¯¸
        if (screen_height < min_height) or (screen_width < min_height):
            if (screen_height * 0.75 * 4 / 3) > min_width:
                default_height = int(screen_height * 0.75)
                default_width = int(screen_height * 0.75 * 4 / 3)
                DATA_CONFIG["window"].geometry(f"{default_width}x{default_height}")

        # çª—å£å·¦ä¸Šè§’æ˜¾ç¤º
        DATA_CONFIG["window"].geometry("+0+0")

        # åˆ›å»ºæ‰€æœ‰å±å¹•å®ä¾‹
        self.screens = {
            "filteration_screen": Filteration_Screen(DATA_CONFIG["window"]),
            "heat_transfer_screen": Heat_Transfer_Screen(DATA_CONFIG["window"]),
            "extraction_screen": Extraction_Screen(DATA_CONFIG["window"]),
            "drying_screen": Drying_Screen(DATA_CONFIG["window"]),
            "oxygen_desorption_screen": Oxygen_Desorption_Screen(DATA_CONFIG["window"]),
            "distillation_screen": Distillation_Screen(DATA_CONFIG["window"]),
            "fluid_flow_screen": Fluid_Flow_Screen(DATA_CONFIG["window"]),
        }

        # åˆå§‹åŒ– current_screen
        self.current_screen = None

        # åˆ›å»ºæ¨¡å¼åˆ‡æ¢èœå•
        self._create_mode_menu()

        # é»˜è®¤æ˜¾ç¤ºè¿‡æ»¤å®éªŒå±å¹•
        self.show_screen("filteration_screen")

        # ä¸»äº‹ä»¶å¾ªç¯
        DATA_CONFIG["window"].mainloop()

    def _create_mode_menu(self):
        """åˆ›å»ºæ¨¡å¼åˆ‡æ¢èœå•"""
        # åˆ›å»ºèœå•æ 
        menubar = ttk.Menu(DATA_CONFIG["window"])
        DATA_CONFIG["window"].config(menu=menubar)

        # åˆ›å»ºå®éªŒæ¨¡å¼èœå•
        mode_menu = ttk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="å®éªŒæ¨¡å¼", menu=mode_menu)

        # åˆ›å»ºèœå•é¡¹
        mode_menu.add_command(label="è¿‡æ»¤å®éªŒ", command=lambda: self.show_screen("filteration_screen"))
        mode_menu.add_command(label="ä¼ çƒ­å®éªŒ", command=lambda: self.show_screen("heat_transfer_screen"))
        mode_menu.add_command(label="èƒå–å®éªŒ", command=lambda: self.show_screen("extraction_screen"))
        mode_menu.add_command(label="å¹²ç‡¥å®éªŒ", command=lambda: self.show_screen("drying_screen"))
        mode_menu.add_command(label="è§£æå®éªŒ", command=lambda: self.show_screen("oxygen_desorption_screen"))
        mode_menu.add_command(label="ç²¾é¦å®éªŒ", command=lambda: self.show_screen("distillation_screen"))
        mode_menu.add_command(label="æµä½“å®éªŒ", command=lambda: self.show_screen("fluid_flow_screen"))

    def show_screen(self, screen_name):
        """æ˜¾ç¤ºæŒ‡å®šçš„å±å¹•"""
        if self.current_screen:
            self.current_screen.pack_forget()

        if screen_name in self.screens:
            self.current_screen = self.screens[screen_name]
            self.current_screen.pack(fill="both", expand=True)
        else:
            logging.error(f"æœªçŸ¥å±å¹•åç§°: {screen_name}")

    def change_mode(self, *args):
        """ç•Œé¢æ¨¡å¼åˆ‡æ¢ï¼Œåˆ‡æ¢çª—å£"""
        event = DATA_CONFIG["mode"].get()
        if event == "è¿‡æ»¤":
            self.show_screen("filteration_screen")
        elif event == "ä¼ çƒ­":
            self.show_screen("heat_transfer_screen")
        elif event == "èƒå–":
            self.show_screen("extraction_screen")
        elif event == "å¹²ç‡¥":
            self.show_screen("drying_screen")
        elif event == "è§£æ":
            self.show_screen("oxygen_desorption_screen")
        elif event == "ç²¾é¦":
            self.show_screen("distillation_screen")
        elif event == "æµä½“":
            self.show_screen("fluid_flow_screen")
        else:
            logging.error(f"æœªçŸ¥æ¨¡å¼: {event}")

    def data_changed(self):
        """æ•°æ®ä¿®æ”¹å“åº”å‡½æ•°ï¼ˆé¢„ç•™æ‰©å±•ï¼‰"""
        pass


================================================================================
E:\Chem-Experiment-Process-App\gui\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\distillation_screen.py çš„å†…å®¹:
================================================================================
# distillation_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import traceback
from tkinter import (
    Label,
    Toplevel,
    messagebox,
    ttk,
    Button,
    filedialog,
    Canvas,
    StringVar,
)
from tkinter.ttk import Progressbar
from PIL import Image, ImageTk
import numpy as np
import pandas as pd
import tkinter as tk

# é…ç½® logging ä¿¡æ¯
logging.getLogger("matplotlib.font_manager").setLevel(logging.ERROR)
logging.getLogger("PIL").setLevel(logging.WARNING)
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.text_widget import TextWidget
from gui.screens.processors.distillation_experiment_processor import Distillation_Experiment_Processor


class Distillation_Screen(ttk.Frame):
    """
    ç²¾é¦å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚
    """

    def __init__(self, window):
        super().__init__(window)
        self.window = window
        self.csv_file_path = None  # å­˜å‚¨CSVæ–‡ä»¶è·¯å¾„
        self.processed_data = None
        self.current_page = 0
        self.images_paths = []
        self.RAW_COLS = []  # åŠ¨æ€ç”Ÿæˆåˆ—æ ‡é¢˜
        self._init_components()
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        # å·¦ä¾§é¢æ¿
        self.left_frame = ttk.Frame(self.main_paned, width=600)
        self.main_paned.add(self.left_frame, weight=1)
        self._init_left_panel()

        # å³ä¾§é¢æ¿
        self.right_frame = ttk.Frame(self.main_paned, width=800)
        self.main_paned.add(self.right_frame, weight=2)
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§é¢æ¿"""
        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(side="top", fill="x", padx=5, pady=5)

        # å¯¼å…¥æ•°æ®æŒ‰é’® - ä¿®æ”¹ä¸ºå¯¼å…¥CSVæ–‡ä»¶
        self.import_data_btn = Button(button_frame, text="å¯¼å…¥CSVæ•°æ®", command=self.load_csv_data)
        self.import_data_btn.pack(side="left", padx=5, pady=5)

        # å¤„ç†æ•°æ®æŒ‰é’®
        self.process_data_btn = Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data)
        self.process_data_btn.pack(side="left", padx=5, pady=5)

        # ç»˜åˆ¶å›¾å½¢æŒ‰é’®
        self.plot_graph_btn = Button(button_frame, text="ç»˜åˆ¶å›¾å½¢", command=self.plot_graph)
        self.plot_graph_btn.pack(side="left", padx=5, pady=5)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame, text="åŸå§‹æ•°æ®")
        self.raw_data_display.pack(pady=10, fill="both", expand=True)
        self.raw_data_table = TableWidget(self.raw_data_display, [], widths=[])  # åˆå§‹æ—¶ä¸ºç©º
        self.raw_data_table.pack(pady=10, fill="both", expand=True)

        # ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame, text="è®¡ç®—ç»“æœ")
        self.res_data_display.pack(pady=10, fill="both", expand=True)
        self.res_data_table = TableWidget(self.res_data_display, [], widths=[])
        self.res_data_table.pack(pady=10, fill="both", expand=True)

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§é¢æ¿"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # ç»˜å›¾åŒºåŸŸ
        self.plot_frame = ttk.Frame(self.right_paned)
        self.right_paned.add(self.plot_frame, weight=1)

        # å›¾åƒæ˜¾ç¤ºCanvas
        self.image_canvas = Canvas(self.plot_frame)
        self.image_canvas.pack(fill="both", expand=True)
        self.image_canvas.bind("<Configure>", self.on_resize)

        # é¡µç æ ‡ç­¾
        self.page_label = ttk.Label(self.right_frame, text="Page 1/1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # ç¿»é¡µæŒ‰é’®
        button_frame = ttk.Frame(self.right_frame)
        button_frame.pack(side="bottom", fill="x", padx=5, pady=10)

        self.prev_btn = ttk.Button(button_frame, text="ä¸Šä¸€é¡µ", command=self.show_prev_page, state="disabled")
        self.prev_btn.pack(side="left", padx=5, pady=5)

        self.next_btn = ttk.Button(button_frame, text="ä¸‹ä¸€é¡µ", command=self.show_next_page, state="disabled")
        self.next_btn.pack(side="left", padx=5, pady=5)

    def load_csv_data(self):
        """åŠ è½½CSVæ–‡ä»¶æ•°æ®"""
        file_path = filedialog.askopenfilename(
            title="é€‰æ‹©ç²¾é¦å®éªŒCSVæ–‡ä»¶",
            filetypes=[("CSV Files", "*.csv")],
            initialdir="./",
        )

        if not file_path:
            return

        try:
            self.csv_file_path = file_path

            # åŠ è½½æ•°æ®åˆ°è¡¨æ ¼æ˜¾ç¤º
            df = pd.read_csv(file_path)
            # åŠ¨æ€ç”Ÿæˆåˆ—æ ‡é¢˜
            self.RAW_COLS = ["åºå·"] + df.columns.tolist()
            self.update_raw_data_table(df.values)

            messagebox.showinfo("æˆåŠŸ", "æ–‡ä»¶åŠ è½½å®Œæˆï¼")

        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"åŠ è½½CSVæ•°æ®å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def process_data(self):
        """å¤„ç†æ•°æ®"""
        if not self.csv_file_path:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¯¼å…¥CSVæ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # åˆ›å»ºå¤„ç†å™¨å®ä¾‹å¹¶å¤„ç†æ•°æ®
            self.processors = []
            self.processed_data_list = []

            # å¤„ç† R=4 çš„æƒ…å†µ
            processor_r4 = Distillation_Experiment_Processor(
                file_path=self.csv_file_path,
                R=4,  # å›æµæ¯”
                Î±m=2.0,  # é»˜è®¤ç›¸å¯¹æŒ¥å‘åº¦
                F=80,  # é»˜è®¤è¿›æ–™é‡
                tS=30,  # é»˜è®¤å¡”é¡¶æ¸©åº¦
                tF=26,  # é»˜è®¤å¡”åº•æ¸©åº¦
                output_dir="å®éªŒç»“æœ/R4",
            )
            processor_r4.process_experiment(show_plot=False)  # ä¸æ˜¾ç¤ºå›¾å½¢
            self.processors.append(processor_r4)
            self.processed_data_list.append(processor_r4.calculator.results)

            # å¤„ç† R=æ— ç©·å¤§ çš„æƒ…å†µ
            processor_r_inf = Distillation_Experiment_Processor(
                file_path=self.csv_file_path,
                R=10000,  # å›æµæ¯”ï¼ˆè¿‘ä¼¼æ— ç©·å¤§ï¼‰
                Î±m=2.0,  # é»˜è®¤ç›¸å¯¹æŒ¥å‘åº¦
                F=80,  # é»˜è®¤è¿›æ–™é‡
                tS=30,  # é»˜è®¤å¡”é¡¶æ¸©åº¦
                tF=26,  # é»˜è®¤å¡”åº•æ¸©åº¦
                output_dir="å®éªŒç»“æœ/R_inf",
            )
            processor_r_inf.process_experiment(show_plot=False)  # ä¸æ˜¾ç¤ºå›¾å½¢
            self.processors.append(processor_r_inf)
            self.processed_data_list.append(processor_r_inf.calculator.results)

            # æ›´æ–°ç»“æœè¡¨æ ¼
            self.update_results_table()

            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "æ•°æ®å¤„ç†å®Œæˆï¼")

        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"æ•°æ®å¤„ç†å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def plot_graph(self):
        """ç»˜åˆ¶å›¾å½¢"""
        if not hasattr(self, "processors") or not self.processors:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¤„ç†æ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # æ¸…ç©ºå›¾åƒè·¯å¾„
            self.images_paths = []

            # åˆ†åˆ«ç»˜åˆ¶ä¸¤ç§å›æµæ¯”çš„å›¾å½¢
            for processor in self.processors:
                plot_path = processor.result_paths["visualization"]
                processor.plotter.plot_mccabe_thiele(save_path=plot_path, show=False)
                self.images_paths.append(plot_path)

            # æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾
            if self.images_paths:
                self.current_page = 0
                self.show_current_page()
                self.enable_page_buttons()

            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "å›¾å½¢ç»˜åˆ¶å®Œæˆï¼")

        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"ç»˜åˆ¶å›¾å½¢å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def update_raw_data_table(self, raw_data=None):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        self.raw_data_table.clear()
        # åŠ¨æ€è®¾ç½®è¡¨æ ¼åˆ—
        self.raw_data_table.table["columns"] = self.RAW_COLS
        for col in self.RAW_COLS:
            self.raw_data_table.table.heading(col, text=col)
        if raw_data is not None:
            for idx, row in enumerate(raw_data):
                # ç¡®ä¿æ•°æ®è¡Œçš„é•¿åº¦ä¸åˆ—æ•°åŒ¹é…
                row_data = [idx + 1] + row.tolist()
                self.raw_data_table.append(row_data)

    def update_results_table(self):
        """æ›´æ–°ç»“æœè¡¨æ ¼"""
        self.res_data_table.clear()
        RESULT_COLS = ["ç»„å·", "å›æµæ¯”", "ç†è®ºå¡”æ¿æ•°", "å®é™…å¡”æ¿æ•°", "åˆ†ç¦»æ•ˆç‡"]
        self.res_data_table.table["columns"] = RESULT_COLS
        for col in RESULT_COLS:
            self.res_data_table.table.heading(col, text=col)

        for idx, (processor, data) in enumerate(zip(self.processors, self.processed_data_list)):
            # æ ¹æ®å›æµæ¯”åŒºåˆ†æƒ…å†µ
            if processor.R == 4:
                reflux_ratio = 4
            else:
                reflux_ratio = "æ— ç©·å¤§"

            # æ·»åŠ ç»“æœåˆ°è¡¨æ ¼
            self.res_data_table.append(
                [
                    idx + 1,
                    reflux_ratio,
                    f"{data['ç†è®ºå¡”æ¿æ•°']:.2f}",
                    f"{data['ç†è®ºå¡”æ¿æ•°'] - 1:.2f}",
                    "N/A",  # åˆ†ç¦»æ•ˆç‡éœ€è¦æ ¹æ®å…·ä½“å®éªŒè®¡ç®—
                ]
            )

    def show_processing_window(self):
        """æ˜¾ç¤ºå¤„ç†ä¸­çš„çª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("å¤„ç†ä¸­")
        self.processing_window.geometry("200x100")
        label = ttk.Label(self.processing_window, text="æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...")
        label.pack(expand=True)
        self.processing_window.grab_set()
        self.processing_window.update()

    def close_processing_window(self):
        """å…³é—­å¤„ç†ä¸­çš„çª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.grab_release()
            self.processing_window.destroy()

    def show_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µçš„å›¾å½¢"""
        self.image_canvas.delete("all")
        if not self.images_paths or self.current_page >= len(self.images_paths):
            return

        try:
            img = Image.open(self.images_paths[self.current_page])
            canvas_width = self.image_canvas.winfo_width()
            canvas_height = self.image_canvas.winfo_height()

            # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
            img_ratio = img.width / img.height
            canvas_ratio = canvas_width / canvas_height

            if canvas_ratio > img_ratio:
                new_height = canvas_height
                new_width = int(new_height * img_ratio)
            else:
                new_width = canvas_width
                new_height = int(new_width / img_ratio)

            img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
            img_tk = ImageTk.PhotoImage(img)

            # å±…ä¸­æ˜¾ç¤º
            x_pos = (canvas_width - new_width) // 2
            y_pos = (canvas_height - new_height) // 2

            self.image_canvas.create_image(x_pos, y_pos, image=img_tk, anchor="nw")
            self.image_canvas.image = img_tk

            # æ›´æ–°é¡µç 
            self.page_label.config(text=f"Page {self.current_page + 1}/{len(self.images_paths)}")

        except Exception as e:
            logging.error(f"åŠ è½½å›¾åƒå¤±è´¥: {str(e)}")

    def on_resize(self, event):
        """å¤„ç†ç”»å¸ƒå¤§å°å˜åŒ–"""
        if self.images_paths:
            self.show_current_page()

    def show_prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_current_page()
        self.enable_page_buttons()  # ç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def show_next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_current_page()
        self.enable_page_buttons()  # ç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def enable_page_buttons(self):
        """å¯ç”¨/ç¦ç”¨ç¿»é¡µæŒ‰é’®"""
        if not self.images_paths or len(self.images_paths) <= 1:
            self.prev_btn.config(state="disabled")
            self.next_btn.config(state="disabled")
        else:
            prev_state = "normal" if self.current_page > 0 else "disabled"
            next_state = "normal" if self.current_page < len(self.images_paths) - 1 else "disabled"
            self.prev_btn.config(state=prev_state)
            self.next_btn.config(state=next_state)

    def close_window(self):
        """å…³é—­çª—å£"""
        self.window.destroy()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\drying_screen.py çš„å†…å®¹:
================================================================================
# drying_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import traceback
from tkinter import (
    Label,
    Toplevel,
    messagebox,
    ttk,
    Button,
    filedialog,
    Canvas,
    StringVar,
)
from tkinter.ttk import Progressbar
from PIL import Image, ImageTk
import numpy as np
import pandas as pd
import tkinter as tk

# é…ç½® logging ä¿¡æ¯
logging.getLogger("matplotlib.font_manager").setLevel(logging.ERROR)
logging.getLogger("PIL").setLevel(logging.WARNING)
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.processors.drying_experiment_processor import Drying_Experiment_Processor


class Drying_Screen(ttk.Frame):
    """
    å¹²ç‡¥å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯¼å…¥åŠŸèƒ½
    """

    RAW_COLS = ["æ—¶é—´Ï„/min", "æ€»è´¨é‡W1/g", "å¹²çƒæ¸©åº¦t_dry/â„ƒ", "æ¹¿çƒæ¸©åº¦t_wet/â„ƒ"]
    RESULT_COLS = ["å‚æ•°", "å€¼"]

    def __init__(self, window):
        super().__init__(window)
        self.window = window
        self.csv_file_paths = None
        self.processed_data = None
        self.current_page = 0
        self.images_paths = []
        self._init_components()
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        # å·¦ä¾§é¢æ¿
        self.left_frame = ttk.Frame(self.main_paned, width=600)
        self.main_paned.add(self.left_frame, weight=1)
        self._init_left_panel()

        # å³ä¾§é¢æ¿
        self.right_frame = ttk.Frame(self.main_paned, width=800)
        self.main_paned.add(self.right_frame, weight=2)
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§é¢æ¿"""
        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(side="top", fill="x", padx=5, pady=5)

        # å¯¼å…¥æ•°æ®æŒ‰é’®
        self.import_data_btn = Button(button_frame, text="å¯¼å…¥CSVæ•°æ®", command=self.load_csv_data)
        self.import_data_btn.pack(side="left", padx=5, pady=5)

        # å¤„ç†æ•°æ®æŒ‰é’®
        self.process_data_btn = Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data)
        self.process_data_btn.pack(side="left", padx=5, pady=5)

        # ç»˜åˆ¶å›¾å½¢æŒ‰é’®
        self.plot_graph_btn = Button(button_frame, text="ç»˜åˆ¶å›¾å½¢", command=self.plot_graph)
        self.plot_graph_btn.pack(side="left", padx=5, pady=5)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame, text="åŸå§‹æ•°æ®")
        self.raw_data_display.pack(pady=10, fill="both", expand=True)
        self.raw_data_table = TableWidget(self.raw_data_display, self.RAW_COLS, widths=[100, 120, 120, 120])
        self.raw_data_table.pack(pady=10, fill="both", expand=True)

        # ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame, text="è®¡ç®—ç»“æœ")
        self.res_data_display.pack(pady=10, fill="both", expand=True)
        self.res_data_table = TableWidget(self.res_data_display, self.RESULT_COLS, widths=[100, 150])
        self.res_data_table.pack(pady=10, fill="both", expand=True)

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§é¢æ¿"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # ç»˜å›¾åŒºåŸŸ
        self.plot_frame = ttk.Frame(self.right_paned)
        self.right_paned.add(self.plot_frame, weight=1)

        # å›¾åƒæ˜¾ç¤ºCanvas
        self.image_canvas = Canvas(self.plot_frame)
        self.image_canvas.pack(fill="both", expand=True)
        self.image_canvas.bind("<Configure>", self.on_resize)

        # é¡µç æ ‡ç­¾
        self.page_label = ttk.Label(self.right_frame, text="Page 1/1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # ç¿»é¡µæŒ‰é’®
        button_frame = ttk.Frame(self.right_frame)
        button_frame.pack(side="bottom", fill="x", padx=5, pady=10)

        self.prev_btn = ttk.Button(button_frame, text="ä¸Šä¸€é¡µ", command=self.show_prev_page, state="disabled")
        self.prev_btn.pack(side="left", padx=5, pady=5)

        self.next_btn = ttk.Button(button_frame, text="ä¸‹ä¸€é¡µ", command=self.show_next_page, state="disabled")
        self.next_btn.pack(side="left", padx=5, pady=5)

    def load_csv_data(self):
        """åŠ è½½å¹²ç‡¥å®éªŒCSVæ–‡ä»¶"""
        file_paths = filedialog.askopenfilenames(
            title="é€‰æ‹©å¹²ç‡¥å®éªŒCSVæ–‡ä»¶ï¼ˆéœ€åŒ…å«åŸå§‹æ•°æ®1å’ŒåŸå§‹æ•°æ®2ï¼‰",
            filetypes=[("CSV Files", "*.csv")],
            initialdir="./",
        )

        if not file_paths:
            return

        try:
            # éªŒè¯æ–‡ä»¶å‘½åè§„èŒƒ
            data1_path, data2_path = None, None
            for path in file_paths:
                filename = os.path.basename(path).lower()
                if "åŸå§‹æ•°æ®1" in filename:
                    data1_path = path
                elif "åŸå§‹æ•°æ®2" in filename:
                    data2_path = path

            if not all([data1_path, data2_path]):
                raise ValueError("å¿…é¡»åŒ…å«åŸå§‹æ•°æ®1å’ŒåŸå§‹æ•°æ®2æ–‡ä»¶")

            # åŠ è½½åŸå§‹æ•°æ®2åˆ°è¡¨æ ¼æ˜¾ç¤º
            df = pd.read_csv(data2_path, header=0, skiprows=[1])
            raw_data = df[["ç´¯è®¡æ—¶é—´Ï„/min", "æ€»è´¨é‡W1/g", "å¹²çƒæ¸©åº¦t_dry/â„ƒ", "æ¹¿çƒæ¸©åº¦t_wet/â„ƒ"]].values

            self.csv_file_paths = [data1_path, data2_path]
            self.update_raw_data_table(raw_data)

            messagebox.showinfo("æˆåŠŸ", "æ–‡ä»¶åŠ è½½å®Œæˆï¼")

        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"åŠ è½½æ•°æ®å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def process_data(self):
        """å¤„ç†å¹²ç‡¥å®éªŒæ•°æ®"""
        if not self.csv_file_paths:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¯¼å…¥CSVæ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # åˆ›å»ºå¤„ç†å™¨å®ä¾‹
            self.processor = Drying_Experiment_Processor(self.csv_file_paths)
            outputs = self.processor.process_experiment()

            # è·å–è®¡ç®—ç»“æœ
            self.results = self.processor.get_results()
            self.images_paths = [
                outputs["combined_plot"],
                outputs["combined_plot"].replace("combined_plots", "drying_curve"),
                outputs["combined_plot"].replace("combined_plots", "drying_rate_curve"),
            ]

            # æ›´æ–°ç»“æœè¡¨æ ¼
            self.update_results_table()

            self.close_processing_window()
            self.enable_page_buttons()
            messagebox.showinfo("æˆåŠŸ", "æ•°æ®å¤„ç†å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"æ•°æ®å¤„ç†å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def plot_graph(self):
        """ç”Ÿæˆå¹¶æ˜¾ç¤ºå›¾è¡¨"""
        if not hasattr(self, "processor"):
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¤„ç†æ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾
            if self.images_paths:
                self.current_page = 0
                self.show_current_page()
                self.enable_page_buttons()

            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "å›¾è¡¨ç”Ÿæˆå®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"å›¾è¡¨ç”Ÿæˆå¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    # ä»¥ä¸‹æ˜¯é€šç”¨æ–¹æ³•ï¼Œä¸ä¼ çƒ­ç•Œé¢ä¿æŒä¸€è‡´
    def show_processing_window(self):
        """æ˜¾ç¤ºå¤„ç†ä¸­çš„çª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("å¤„ç†ä¸­")
        self.processing_window.geometry("200x100")
        label = ttk.Label(self.processing_window, text="æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...")
        label.pack(expand=True)
        self.processing_window.grab_set()
        self.processing_window.update()

    def close_processing_window(self):
        """å…³é—­å¤„ç†ä¸­çš„çª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.grab_release()
            self.processing_window.destroy()

    def update_raw_data_table(self, raw_data=None):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        self.raw_data_table.clear()
        if raw_data is not None:
            for row in raw_data:
                self.raw_data_table.append([row[0], row[1], row[2], row[3]])

    def update_results_table(self):
        """æ›´æ–°è®¡ç®—ç»“æœè¡¨æ ¼"""
        self.res_data_table.clear()
        if hasattr(self.processor, "U_c") and hasattr(self.processor, "Î±"):
            results = [
                ("æ’å®šå¹²ç‡¥é€Ÿç‡ U_c (kg/mÂ²Â·h)", f"{self.processor.U_c:.4f}"),
                ("ä¼ çƒ­ç³»æ•° Î± (kW/mÂ²Â·K)", f"{self.processor.Î±.mean():.4f}"),
                ("åˆå§‹ä½“ç§¯æµé‡ V_t0 (mÂ³/s)", f"{self.processor.V_t0:.6f}"),
            ]
            for param, value in results:
                self.res_data_table.append([param, value])

    def show_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µçš„å›¾å½¢"""
        self.image_canvas.delete("all")
        if not self.images_paths or self.current_page >= len(self.images_paths):
            return

        try:
            img = Image.open(self.images_paths[self.current_page])
            canvas_width = self.image_canvas.winfo_width()
            canvas_height = self.image_canvas.winfo_height()

            # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
            img_ratio = img.width / img.height
            canvas_ratio = canvas_width / canvas_height

            if canvas_ratio > img_ratio:
                new_height = canvas_height
                new_width = int(new_height * img_ratio)
            else:
                new_width = canvas_width
                new_height = int(new_width / img_ratio)

            img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
            img_tk = ImageTk.PhotoImage(img)

            # å±…ä¸­æ˜¾ç¤º
            x_pos = (canvas_width - new_width) // 2
            y_pos = (canvas_height - new_height) // 2

            self.image_canvas.create_image(x_pos, y_pos, image=img_tk, anchor="nw")
            self.image_canvas.image = img_tk

            # æ›´æ–°é¡µç 
            self.page_label.config(text=f"Page {self.current_page + 1}/{len(self.images_paths)}")
        except Exception as e:
            logging.error(f"åŠ è½½å›¾åƒå¤±è´¥: {str(e)}")

    def on_resize(self, event):
        """å¤„ç†ç”»å¸ƒå¤§å°å˜åŒ–"""
        if self.images_paths:
            self.show_current_page()

    def show_prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_current_page()
        self.enable_page_buttons()

    def show_next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_current_page()
        self.enable_page_buttons()

    def enable_page_buttons(self):
        """å¯ç”¨/ç¦ç”¨ç¿»é¡µæŒ‰é’®"""
        if not self.images_paths or len(self.images_paths) <= 1:
            self.prev_btn.config(state="disabled")
            self.next_btn.config(state="disabled")
        else:
            prev_state = "normal" if self.current_page > 0 else "disabled"
            next_state = "normal" if self.current_page < len(self.images_paths) - 1 else "disabled"
            self.prev_btn.config(state=prev_state)
            self.next_btn.config(state=next_state)

    def close_window(self):
        """å…³é—­çª—å£"""
        self.window.destroy()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\extraction_screen.py çš„å†…å®¹:
================================================================================
# extraction_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import traceback
import tkinter as tk

from tkinter import ttk, Button, filedialog, Canvas, messagebox, Toplevel, Label
from PIL import Image, ImageTk
from pathlib import Path
import pandas as pd

# é…ç½®æ—¥å¿—å’Œè·¯å¾„
logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(levelname)s - %(message)s")
# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.common_widgets.text_widget import TextWidget

# å¯¼å…¥èƒå–å¤„ç†æ¨¡å—
from gui.screens.calculators.extraction_calculator import Extraction_Calculator
from gui.screens.plotters.extraction_plotter import Extraction_Plotter


class Extraction_Screen(ttk.Frame):
    """
    èƒå–å®éªŒç•Œé¢ç±»
    -------------------------
    åŠŸèƒ½ï¼š
    1. æ•°æ®å¯¼å…¥ä¸å±•ç¤º
    2. å®éªŒæ•°æ®å¤„ç†
    3. å¯è§†åŒ–ç»“æœå±•ç¤º
    4. ç»“æœæ‰“åŒ…å¯¼å‡º
    """

    RAW_COLS = ["å®éªŒé¡¹ç›®", "é¡¹ç›®ä¸€", "é¡¹ç›®äºŒ"]
    RESULT_COLS = ["å‚æ•°", "é¡¹ç›®ä¸€", "é¡¹ç›®äºŒ", "é¡¹ç›®ä¸‰", "é¡¹ç›®å››"]

    def __init__(self, master):
        super().__init__(master)
        self.master = master
        self._init_ui()
        self._setup_bindings()

        # å®éªŒæ•°æ®ç›¸å…³å±æ€§
        self.calculator = None
        self.plotter = None
        self.current_page = 0
        self.image_paths = []
        self.file_dict = {"main": None, "distribution": None}  # åˆå§‹åŒ–æ–‡ä»¶å­—å…¸

    def _init_ui(self):
        """åˆå§‹åŒ–ç”¨æˆ·ç•Œé¢"""
        self._create_main_panes()
        self._create_left_panel()
        self._create_right_panel()
        self._configure_styles()

    def _create_main_panes(self):
        """åˆ›å»ºä¸»å¸ƒå±€é¢æ¿"""
        self.main_pane = ttk.PanedWindow(self, orient="horizontal")
        self.main_pane.pack(fill="both", expand=True)

        # å·¦ä¾§æ§åˆ¶é¢æ¿
        self.left_frame = ttk.Frame(self.main_pane, width=300)
        self.main_pane.add(self.left_frame, weight=1)

        # å³ä¾§å¯è§†åŒ–é¢æ¿
        self.right_frame = ttk.Frame(self.main_pane)
        self.main_pane.add(self.right_frame, weight=3)

    def _create_left_panel(self):
        """åˆ›å»ºå·¦ä¾§æ§åˆ¶é¢æ¿"""
        # æŒ‰é’®åŒºåŸŸ
        btn_frame = ttk.Frame(self.left_frame)
        btn_frame.pack(pady=10, fill="x")

        Button(btn_frame, text="å¯¼å…¥æ•°æ®", command=self.load_data).pack(fill="x", pady=2)
        Button(btn_frame, text="è®¡ç®—å‚æ•°", command=self.process_data).pack(fill="x", pady=2)
        Button(btn_frame, text="ç”Ÿæˆå›¾è¡¨", command=self.generate_plots).pack(fill="x", pady=2)
        Button(btn_frame, text="å¯¼å‡ºç»“æœ", command=self.export_results).pack(fill="x", pady=2)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_table = ttk.Treeview(self.left_frame, columns=self.RAW_COLS, show="headings", height=10)
        for col in self.RAW_COLS:
            self.raw_table.heading(col, text=col)
            self.raw_table.column(col, width=100, anchor="center")
        self.raw_table.pack(fill="both", expand=True, padx=5, pady=5)

        # ç»“æœè¡¨æ ¼
        self.result_table = ttk.Treeview(self.left_frame, columns=self.RESULT_COLS, show="headings", height=5)
        for col in self.RESULT_COLS:
            self.result_table.heading(col, text=col)
            self.result_table.column(col, width=100, anchor="center")
        self.result_table.pack(fill="both", expand=True, padx=5, pady=5)

        # æ–‡ä»¶çŠ¶æ€æ˜¾ç¤º
        self.file_status = ttk.Label(
            self.left_frame, text="å·²åŠ è½½æ–‡ä»¶ï¼š\nä¸»æ•°æ®ï¼šæ— \nåˆ†é…æ›²çº¿ï¼šæ— ", wraplength=280, anchor="w"
        )
        self.file_status.pack(fill="x", pady=5)

    def _create_right_panel(self):
        """åˆ›å»ºå³ä¾§å¯è§†åŒ–é¢æ¿"""
        # ç”»å¸ƒåŒºåŸŸ
        self.canvas = Canvas(self.right_frame, bg="white")
        self.canvas.pack(fill="both", expand=True)

        # åˆ†é¡µæ§åˆ¶
        control_frame = ttk.Frame(self.right_frame)
        control_frame.pack(pady=10)

        self.prev_btn = Button(control_frame, text="ä¸Šä¸€é¡µ", command=self.prev_page)
        self.prev_btn.pack(side="left", padx=5)
        self.page_label = ttk.Label(control_frame, text="ç¬¬1é¡µ/å…±0é¡µ")
        self.page_label.pack(side="left", padx=5)
        self.next_btn = Button(control_frame, text="ä¸‹ä¸€é¡µ", command=self.next_page)
        self.next_btn.pack(side="left", padx=5)

    def _configure_styles(self):
        """é…ç½®ç•Œé¢æ ·å¼"""
        style = ttk.Style()
        style.configure("TButton", padding=6)
        style.configure("Treeview.Heading", font=("Microsoft YaHei", 10, "bold"))
        style.configure("Treeview", rowheight=25)

    def _setup_bindings(self):
        """è®¾ç½®äº‹ä»¶ç»‘å®š"""
        self.canvas.bind("<Configure>", self._resize_image)

    def _identify_file_type(self, filename):
        """æ ¹æ®æ–‡ä»¶åè¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ˆå¢å¼ºç‰ˆï¼‰"""
        filename = filename.lower()
        patterns = {
            "main": ["åŸå§‹æ•°æ®", "main", "æ•°æ®è®°å½•", "_m", "input"],
            "distribution": ["åˆ†é…æ›²çº¿", "distribution", "dataset", "_d", "curve"],
        }

        for file_type, keywords in patterns.items():
            if any(kw in filename for kw in keywords):
                return file_type
        return None

    def load_data(self):
        """åŠ è½½CSVæ ¼å¼çš„å®éªŒæ•°æ®"""
        file_paths = filedialog.askopenfilenames(title="é€‰æ‹©CSVæ•°æ®æ–‡ä»¶", filetypes=[("CSV Files", "*.csv")])

        if not file_paths:
            return

        # æ¸…ç©ºæ—§æ•°æ®
        self.file_dict = {"main": None, "distribution": None}
        self.image_paths = []
        self.current_page = 0
        self._update_page_info()

        # è¯†åˆ«æ–‡ä»¶ç±»å‹
        unrecognized = []
        for path in file_paths:
            file_type = self._identify_file_type(os.path.basename(path))
            if file_type:
                if self.file_dict[file_type]:  # å·²å­˜åœ¨åŒç±»å‹æ–‡ä»¶
                    confirm = messagebox.askyesno("ç¡®è®¤", f"å·²åŠ è½½{file_type}æ–‡ä»¶ï¼Œæ˜¯å¦æ›¿æ¢ï¼Ÿ")
                    if not confirm:
                        continue
                self.file_dict[file_type] = path
            else:
                unrecognized.append(os.path.basename(path))

        # æ˜¾ç¤ºæœªè¯†åˆ«æ–‡ä»¶è­¦å‘Š
        if unrecognized:
            self.show_warning(
                f"ä»¥ä¸‹æ–‡ä»¶æœªèƒ½è¯†åˆ«ï¼š\n{', '.join(unrecognized)}\nè¯·ç¡®ä¿æ–‡ä»¶ååŒ…å«'åŸå§‹æ•°æ®'æˆ–'åˆ†é…æ›²çº¿'å…³é”®è¯"
            )

        # éªŒè¯å¿…è¦æ–‡ä»¶
        missing = [k for k, v in self.file_dict.items() if not v]
        if missing:
            self.show_error(f"ç¼ºå°‘å¿…è¦æ–‡ä»¶ç±»å‹ï¼š{', '.join(missing)}")
            return

        # çŠ¶æ€æ›´æ–°
        self._update_file_status()

        try:
            # åŠ è½½ä¸»æ•°æ®
            main_df = pd.read_csv(self.file_dict["main"])
            self._update_raw_table(main_df)

        except Exception as e:
            self.show_error(f"CSVæ–‡ä»¶è¯»å–å¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def _update_file_status(self):
        """æ›´æ–°æ–‡ä»¶çŠ¶æ€æ˜¾ç¤º"""
        main_file = os.path.basename(self.file_dict["main"]) if self.file_dict["main"] else "æ— "
        dist_file = os.path.basename(self.file_dict["distribution"]) if self.file_dict["distribution"] else "æ— "
        self.file_status.config(text=f"å·²åŠ è½½æ–‡ä»¶ï¼š\nä¸»æ•°æ®ï¼š{main_file}\nåˆ†é…æ›²çº¿ï¼š{dist_file}")

    def _update_raw_table(self, df):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        # éªŒè¯æ•°æ®åˆ—æ•°
        if df.shape[1] != len(self.RAW_COLS):
            self.show_error(f"æ•°æ®åˆ—æ•°ä¸åŒ¹é…ï¼éœ€è¦{len(self.RAW_COLS)}åˆ—ï¼Œå®é™…{df.shape[1]}åˆ—")
            return

        self.raw_table.delete(*self.raw_table.get_children())
        for _, row in df.iterrows():
            self.raw_table.insert("", "end", values=row.tolist())

    def process_data(self):
        """æ‰§è¡Œæ•°æ®å¤„ç†ï¼ˆå¢åŠ æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥ï¼‰"""
        if not all(self.file_dict.values()):
            self.show_warning("è¯·å…ˆå¯¼å…¥å®Œæ•´çš„æ•°æ®æ–‡ä»¶ï¼")
            return

        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        missing_files = []
        for ft, path in self.file_dict.items():
            if not os.path.exists(path):
                missing_files.append(ft)
        if missing_files:
            self.show_error(f"æ–‡ä»¶å·²ä¸¢å¤±ï¼š{', '.join(missing_files)}")
            return

        try:
            self.show_processing("æ­£åœ¨è®¡ç®—...")

            # åˆå§‹åŒ–è®¡ç®—æ¨¡å—
            self.calculator = Extraction_Calculator(
                main_file=self.file_dict["main"], distribution_file=self.file_dict["distribution"]
            )
            self.calculator.run_calculations()

            # æ›´æ–°ç»“æœè¡¨æ ¼
            self._update_result_table()
            self.close_processing()

        except Exception as e:
            self.close_processing()
            self.show_error(f"æ•°æ®å¤„ç†å¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def _update_result_table(self):
        """æ›´æ–°ç»“æœè¡¨æ ¼ï¼ˆä¼˜åŒ–æ•°å€¼æ˜¾ç¤ºï¼‰"""
        # ç¡®ä¿ç³»æ•°åˆ—è¡¨æœ‰4ä¸ªå…ƒç´ 
        coefficients = self.calculator.coefficients
        if len(coefficients) != 4:
            self.show_error("æ‹Ÿåˆç³»æ•°æ•°é‡å¼‚å¸¸ï¼")
            return

        results = [
            [
                "åˆ†é…ç³»æ•°çš„æ‹Ÿåˆé¡¹ç³»æ•°",
                f"{coefficients[0]:.4f}",  # xÂ³é¡¹
                f"{coefficients[1]:.4f}",  # xÂ²é¡¹
                f"{coefficients[2]:.4f}",  # xé¡¹
                f"{coefficients[3]:.4f}",  # å¸¸æ•°é¡¹
            ],
            ["æ“ä½œçº¿æ–œç‡", f"{self.calculator.k1:.2f}", f"{self.calculator.k2:.2f}", "", ""],  # ç©ºå€¼ç•™ç™½  # ç©ºå€¼ç•™ç™½
            [
                "ç§¯åˆ†ç»“æœ",
                f"{self.calculator.ans3[0]:.3e}",
                f"{self.calculator.ans3[1]:.3e}",
                "",  # ç©ºå€¼ç•™ç™½
                "",  # ç©ºå€¼ç•™ç™½
            ],
        ]
        self.result_table.delete(*self.result_table.get_children())
        for row in results:
            self.result_table.insert("", "end", values=row)

    def generate_plots(self):
        """ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨"""
        if self.calculator is None:
            self.show_warning("è¯·å…ˆè¿›è¡Œæ•°æ®å¤„ç†ï¼")
            return

        try:
            self.show_processing("æ­£åœ¨ç”Ÿæˆå›¾è¡¨...")

            # åˆå§‹åŒ–ç»˜å›¾æ¨¡å—
            self.plotter = Extraction_Plotter(self.calculator)
            self.plotter.create_output_dir()
            self.plotter.plot_main_curves()
            self.plotter.plot_integration_curves()

            # è·å–ç”Ÿæˆçš„å›¾è¡¨è·¯å¾„
            self.image_paths = [
                os.path.join(self.plotter.output_dir, f)
                for f in os.listdir(self.plotter.output_dir)
                if f.endswith(".png")
            ]

            self.current_page = 0
            self._update_page_info()
            self.show_current_image()
            self.close_processing()

        except Exception as e:
            self.close_processing()
            self.show_error(f"å›¾è¡¨ç”Ÿæˆå¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def export_results(self):
        """å¯¼å‡ºç»“æœæ–‡ä»¶"""
        if self.plotter is None:
            self.show_warning("è¯·å…ˆç”Ÿæˆå›¾è¡¨ï¼")
            return

        try:
            self.plotter.package_results("èƒå–å®éªŒç»“æœ.zip")
            messagebox.showinfo("å¯¼å‡ºæˆåŠŸ", "ç»“æœæ–‡ä»¶å·²ä¿å­˜ä¸ºï¼šèƒå–å®éªŒç»“æœ.zip")
        except Exception as e:
            self.show_error(f"å¯¼å‡ºå¤±è´¥: {str(e)}")

    def show_current_image(self):
        """æ˜¾ç¤ºå½“å‰é¡µå›¾åƒ"""
        self.canvas.delete("all")
        if self.image_paths:
            try:
                img_path = self.image_paths[self.current_page]
                img = Image.open(img_path)
                self._display_image(img)
            except Exception as e:
                self.show_error(f"å›¾åƒåŠ è½½å¤±è´¥: {str(e)}")

    def _display_image(self, img):
        """åœ¨ç”»å¸ƒä¸Šæ˜¾ç¤ºå›¾åƒ"""
        canvas_width = self.canvas.winfo_width()
        canvas_height = self.canvas.winfo_height()

        # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
        img_ratio = img.width / img.height
        canvas_ratio = canvas_width / canvas_height

        if img_ratio > canvas_ratio:
            new_width = canvas_width
            new_height = int(canvas_width / img_ratio)
        else:
            new_height = canvas_height
            new_width = int(canvas_height * img_ratio)

        img = img.resize((new_width, new_height), Image.LANCZOS)
        self.tk_img = ImageTk.PhotoImage(img)
        self.canvas.create_image(
            (canvas_width - new_width) // 2,
            (canvas_height - new_height) // 2,
            image=self.tk_img,
            anchor="nw",
        )

    def _resize_image(self, event):
        """å“åº”ç”»å¸ƒå°ºå¯¸å˜åŒ–"""
        self.show_current_image()

    def prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self._update_page_info()
            self.show_current_image()

    def next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.image_paths) - 1:
            self.current_page += 1
            self._update_page_info()
            self.show_current_image()

    def _update_page_info(self):
        """æ›´æ–°åˆ†é¡µä¿¡æ¯"""
        total = len(self.image_paths)
        current = self.current_page + 1
        self.page_label.config(text=f"ç¬¬{current}é¡µ/å…±{total}é¡µ")

    def show_processing(self, msg="å¤„ç†ä¸­..."):
        """æ˜¾ç¤ºå¤„ç†ä¸­çª—å£"""
        self.processing_win = Toplevel(self.master)
        self.processing_win.title("è¯·ç¨å€™")
        Label(self.processing_win, text=msg).pack(padx=20, pady=10)
        self.processing_win.grab_set()

    def close_processing(self):
        """å…³é—­å¤„ç†ä¸­çª—å£"""
        if hasattr(self, "processing_win"):
            self.processing_win.destroy()

    def show_error(self, msg):
        """æ˜¾ç¤ºé”™è¯¯æç¤º"""
        messagebox.showerror("é”™è¯¯", msg)

    def show_warning(self, msg):
        """æ˜¾ç¤ºè­¦å‘Šæç¤º"""
        messagebox.showwarning("è­¦å‘Š", msg)


if __name__ == "__main__":
    root = tk.Tk()
    root.title("èƒå–å®éªŒåˆ†æç³»ç»Ÿ")
    root.geometry("1200x800")
    Extraction_Screen(root).pack(fill="both", expand=True)
    root.mainloop()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\filteration_screen.py çš„å†…å®¹:
================================================================================
# filteration_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import traceback

from tkinter import (
    Label,
    PhotoImage,
    Toplevel,
    messagebox,
    ttk,
    Button,
    filedialog,
    Canvas,
)

# ä» PIL å¯¼å…¥ Image (tkinterä¹Ÿæœ‰Imageä½†æ˜¯åŠŸèƒ½ä¸å¦‚PILå¼ºå¤§) å’Œ ImageTk
from PIL import Image, ImageTk

# è®¾ç½®matplotlibæ—¥å¿—çº§åˆ«ä¸ºERRORï¼Œé¿å…æ˜¾ç¤ºfindfontçš„DEBUGä¿¡æ¯
logging.getLogger("matplotlib.font_manager").setLevel(logging.ERROR)

# è®¾ç½®Pillowæ—¥å¿—çº§åˆ«ä¸ºWARNINGï¼Œé¿å…æ˜¾ç¤ºDEBUGä¿¡æ¯
logging.getLogger("PIL").setLevel(logging.WARNING)

# é…ç½®æ—¥å¿—è®¾ç½®
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")

# å¯¼å…¥å¿…è¦çš„åº“
import pandas as pd

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.common_widgets.text_widget import TextWidget

# å¯¼å…¥æ•°æ®å¤„ç†ç±»
from gui.screens.processors.filteration_experiment_processor import Filteration_Experiment_Processor


class Filteration_Screen(ttk.Frame):
    """
    è¿‡æ»¤å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚
    """

    RAW_COLS = ["è¡Œå·", "ç´¢å¼•", "æ»¤é¢é«˜åº¦ (cm)", "æ—¶é—´Î¸ (s)", "æ—¶é—´å·®Î”Î¸ (s)"]
    RESULT_COLS = ["ç»„å·", "æ–œç‡", "æˆªè·"]

    def __init__(self, window):
        super().__init__(window, **SCREEN_CONFIG)
        self.window = window
        self.csv_file_path = None
        self.processed_data = None
        self.after_id = None  # ç”¨äºå­˜å‚¨å®šæ—¶è°ƒç”¨çš„IDï¼Œæ–¹ä¾¿å–æ¶ˆå®šæ—¶è°ƒç”¨
        self.current_page = 0  # å½“å‰é¡µï¼Œæ§åˆ¶æ˜¾ç¤ºçš„å›¾å½¢
        self.images_paths = []  # å­˜å‚¨å›¾åƒæ–‡ä»¶è·¯å¾„
        self._init_components()

        # å°†çª—å£å…³é—­äº‹ä»¶ç»‘å®šåˆ°close_windowæ–¹æ³•
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶ï¼ŒåŒ…æ‹¬è¡¨æ ¼ã€æŒ‰é’®å’Œç»˜å›¾åŒºåŸŸã€‚"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        self.left_frame = ttk.Frame(self.main_paned, **MAIN_FRAME_CONFIG)
        self.main_paned.add(self.left_frame, weight=1)

        self.right_frame = ttk.Frame(self.main_paned, **MAIN_FRAME_CONFIG)
        self.main_paned.add(self.right_frame, weight=2)

        self.csv_file_path_table = TableWidget(self.left_frame, self.RAW_COLS, widths=[10, 40, 40, 40])

        self._init_left_panel()
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§é¢æ¿ï¼ŒåŒ…å«æŒ‰é’®å’Œè¡¨æ ¼åŒºåŸŸã€‚"""
        self.left_paned = ttk.PanedWindow(self.left_frame, orient="vertical")
        self.left_paned.pack(expand=True, fill="both")

        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(side="top", fill="x", padx=5, pady=5)

        # å®šä¹‰æŒ‰é’®åŠå…¶åŠŸèƒ½
        self.com_port_btn = Button(button_frame, text="é€šä¿¡ä¸²å£", command=self._open_serial_port)
        self.com_port_btn.pack(side="top", fill="x", padx=5, pady=5)

        self.import_data_btn = Button(button_frame, text="å¯¼å…¥æ•°æ®", command=self.load_csv_data)
        self.import_data_btn.pack(side="top", fill="x", padx=5, pady=5)

        self.process_data_btn = Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data)
        self.process_data_btn.pack(side="top", fill="x", padx=5, pady=5)

        self.plot_graph_btn = Button(button_frame, text="ç»˜åˆ¶å›¾å½¢", command=self.plot_graph)
        self.plot_graph_btn.pack(side="top", fill="x", padx=5, pady=5)

        # æ˜¾ç¤ºåŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame)
        self.left_paned.add(self.raw_data_display, weight=1)

        self.raw_data_table = TableWidget(self.raw_data_display, self.RAW_COLS, widths=[10, 10, 15, 15, 15])
        self.raw_data_table.pack(pady=10, fill="both", expand=True)

        # æ˜¾ç¤ºå¤„ç†ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame)
        self.left_paned.add(self.res_data_display, weight=1)

        self.res_data_table = TableWidget(self.res_data_display, self.RESULT_COLS, widths=[10, 40, 40])
        self.res_data_table.pack(pady=10, fill="both", expand=True)

        self.left_paned.update_idletasks()

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§é¢æ¿ï¼ŒåŒ…å«ç»˜å›¾åŒºåŸŸå’Œæ–‡æœ¬è¾“å‡ºåŒºã€‚"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # ç»˜å›¾çš„ä¸»é¢æ¿
        self.image_panel = ttk.Frame(self.right_paned)
        self.right_paned.add(self.image_panel, weight=1)

        # åˆ›å»ºæ˜¾ç¤ºå›¾åƒçš„Canvas
        self.image_canvas = Canvas(self.image_panel)
        self.image_canvas.pack(fill="both", expand=True)

        # ç»‘å®šè°ƒæ•´ç”»å¸ƒå¤§å°çš„äº‹ä»¶
        self.image_canvas.bind("<Configure>", self.on_resize)

        # é¡µç æ ‡ç­¾
        self.page_label = ttk.Label(self.right_frame, text="Page 1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # åº•éƒ¨æŒ‰é’®
        button_frame = ttk.Frame(self.right_frame)
        button_frame.pack(side="bottom", fill="x", padx=5, pady=10)

        button_container = ttk.Frame(button_frame)
        button_container.pack(side="top", padx=10, pady=5)  # æŒ‰é’®ä¹‹é—´çš„é—´è·

        self.prev_btn = Button(button_container, text="ä¸Šä¸€é¡µ", command=self.prev_page)
        self.prev_btn.pack(side="left", padx=5, pady=5)

        self.next_btn = Button(button_container, text="ä¸‹ä¸€é¡µ", command=self.next_page)
        self.next_btn.pack(side="left", padx=5, pady=5)

    def show_processing_window(self):
        """å¼¹å‡ºæ­£åœ¨å¤„ç†çª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("Processing")
        self.processing_window.geometry("200x100")
        label = Label(self.processing_window, text="æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...")
        label.pack(expand=True)
        self.processing_window.update()  # å¼ºåˆ¶æ›´æ–°ï¼Œæ˜¾ç¤ºçª—å£

    def close_processing_window(self):
        """å…³é—­æ­£åœ¨å¤„ç†çª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.destroy()

    def process_data(self):
        """å¤„ç†æ•°æ®ï¼Œå½“ç‚¹å‡»â€œå¤„ç†æ•°æ®â€æŒ‰é’®æ—¶è°ƒç”¨ã€‚"""
        if self.csv_file_path is None:
            messagebox.showwarning("Warning", "Please import data first!")
            return

        try:
            # å¼¹å‡ºå¤„ç†ä¸­çš„çª—å£
            self.show_processing_window()

            # åˆ›å»ºFilteration_Experiment_Processorå®ä¾‹
            self.processor = Filteration_Experiment_Processor(self.csv_file_path)

            # æ‰§è¡Œæ•°æ®å¤„ç†
            self.processor.calculate()  # å¤„ç†æ•°æ®ï¼ˆè®¡ç®—ã€æ‹Ÿåˆç­‰ï¼‰
            self.processor.store()  # å­˜å‚¨å¤„ç†åçš„æ•°æ®

            self.processed_data = self.processor.processed_data

            # æ›´æ–°ç»“æœè¡¨æ ¼
            self.update_results_table(self.processed_data)

            # æ›´æ–°å›¾åƒè·¯å¾„
            self.images_paths = self.processor.plotter.images_paths  # è·å–ç”Ÿæˆçš„å›¾åƒè·¯å¾„

            # å®Œæˆå¤„ç†åå…³é—­â€œæ­£åœ¨å¤„ç†â€çª—å£
            self.close_processing_window()

        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("Error", f"Error processing data: {e}")

    def plot_graph(self):
        """ç»˜åˆ¶å›¾å½¢å¹¶åœ¨å³ä¾§é¢æ¿æ˜¾ç¤º"""
        if not hasattr(self, "processor") or self.processor is None:
            messagebox.showwarning("Warning", "Please process data first!")
            return

        try:
            # å¼¹å‡ºå¤„ç†ä¸­çš„çª—å£
            self.show_processing_window()

            # ç›´æ¥è°ƒç”¨ç”Ÿæˆå›¾å½¢çš„æ–¹æ³•
            self.processor.plot()

            # å‹ç¼©ç”Ÿæˆçš„ç»“æœå›¾åƒæ–‡ä»¶
            self.processor.compress_results()

            # æ›´æ–°å›¾åƒè·¯å¾„
            self.images_paths = self.processor.plotter.images_paths

            # å®Œæˆå¤„ç†åå…³é—­â€œæ­£åœ¨å¤„ç†â€çª—å£
            self.close_processing_window()

            # è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºé¡µé¢
            self.show_page()

        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("Error", f"Error plotting graph: {e}")

    def on_resize(self, event):
        """å¤„ç†çª—å£å¤§å°è°ƒæ•´ï¼ŒåŠ¨æ€è°ƒæ•´å›¾åƒå¤§å°"""
        if self.images_paths:
            self.show_page()

    def show_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µçš„å›¾å½¢"""
        self.image_canvas.delete("all")  # æ¸…ç©ºç”»å¸ƒ

        if self.images_paths:
            img_path = self.images_paths[self.current_page]
            try:
                img = Image.open(img_path)
                canvas_width = self.image_canvas.winfo_width()
                canvas_height = self.image_canvas.winfo_height()

                # ä½¿ç”¨resizeæ–¹æ³•è°ƒæ•´å›¾åƒå¤§å°ï¼Œä¿æŒå®½é«˜æ¯”
                img = img.resize((canvas_width, canvas_height), Image.Resampling.LANCZOS)

                img_tk = ImageTk.PhotoImage(img)
                self.image_canvas.create_image(0, 0, image=img_tk, anchor="nw")
                self.image_canvas.image = img_tk  # ä¿æŒå¯¹å›¾åƒçš„å¼•ç”¨

            except Exception as e:
                print(f"Error loading image {img_path}: {e}")

        # æ›´æ–°é¡µç 
        self.page_label.config(text=f"Page {self.current_page + 1}")

        # å–æ¶ˆä¹‹å‰çš„å®šæ—¶è°ƒç”¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        if self.after_id is not None:
            self.window.after_cancel(self.after_id)

        # å®‰æ’ä¸‹ä¸€ä¸ªæ›´æ–°
        self.after_id = self.window.after(100, self.show_page)

    def close_window(self):
        """å…³é—­çª—å£å¹¶å–æ¶ˆæ‰€æœ‰å¾…å®šçš„ä»»åŠ¡"""
        if self.after_id is not None:
            self.window.after_cancel(self.after_id)  # å–æ¶ˆå¾…å®šçš„ä»»åŠ¡
        self.window.destroy()  # å…³é—­çª—å£

    def prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µçš„å›¾å½¢"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_page()

    def next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µçš„å›¾å½¢"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_page()

    def _open_serial_port(self):
        pass

    def load_csv_data(self):
        """åŠ è½½CSVæ–‡ä»¶å¹¶é¢„å¤„ç†æ•°æ®ã€‚"""
        file_path = filedialog.askopenfilename(title="é€‰æ‹©CSVæ–‡ä»¶", filetypes=[("CSV Files", "*.csv")])

        if file_path:
            try:
                data = pd.read_csv(file_path, header=0)
                for col in data.columns:
                    data[col] = pd.to_numeric(data[col], errors="coerce")
                data = data.dropna()

                self.csv_file_path = file_path
                self.update_raw_data_table(data)

            except Exception as e:
                messagebox.showerror("Error", f"Error loading data: {e}")

    def update_raw_data_table(self, raw_data=None):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼ã€‚"""
        if isinstance(self.raw_data_table, TableWidget):
            self.raw_data_table.clear()
            self.raw_data_table.table["columns"] = self.RAW_COLS
            for col in self.RAW_COLS:
                self.raw_data_table.table.heading(col, text=col)
            if raw_data is not None:
                df = pd.DataFrame(raw_data)
                for idx, row in df.iterrows():
                    self.raw_data_table.append([idx] + row.tolist())

    def update_results_table(self, processed_data=None):
        """æ›´æ–°å¤„ç†åçš„ç»“æœè¡¨æ ¼ã€‚"""
        if isinstance(self.res_data_table, TableWidget):
            self.res_data_table.clear()
            self.res_data_table.table["columns"] = self.RESULT_COLS
            for col in self.RESULT_COLS:
                self.res_data_table.table.heading(col, text=col)
            if processed_data is not None:
                for result in processed_data:
                    self.res_data_table.append([result["group"], result["slope"], result["intercept"]])


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\fluid_flow_screen.py çš„å†…å®¹:
================================================================================
# fluid_flow_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import traceback
from tkinter import (
    Label,
    Toplevel,
    messagebox,
    ttk,
    Button,
    filedialog,
    Canvas,
    StringVar,
)
from tkinter.ttk import Progressbar
from PIL import Image, ImageTk
import numpy as np
import pandas as pd

# é…ç½®æ—¥å¿—è®¾ç½®
# ä¿ç•™è‡ªå·±ä»£ç çš„DEBUGæ—¥å¿—ï¼Œè¿‡æ»¤ç¬¬ä¸‰æ–¹åº“çš„
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(name)s - %(levelname)s - %(message)s")

# è®¾ç½®ç¬¬ä¸‰æ–¹åº“çš„æ—¥å¿—çº§åˆ«
logging.getLogger("matplotlib").setLevel(logging.WARNING)
logging.getLogger("PIL").setLevel(logging.WARNING)
logging.getLogger("numpy").setLevel(logging.WARNING)
logging.getLogger("pandas").setLevel(logging.WARNING)

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.common_widgets.text_widget import TextWidget

# å®éªŒå¤„ç†å™¨ç±»
from gui.screens.processors.fluid_flow_experiment_processor import Fluid_Flow_Expriment_Processor


class Fluid_Flow_Screen(ttk.Frame):
    """
    æµä½“æµåŠ¨å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚
    """

    RAW_COLS = ["åºå·", "Q/(L/h)", "ç›´ç®¡é˜»åŠ›å‹é™/kPa", "æ¸©åº¦t/â„ƒ"]
    RESULT_COLS = ["ç»„å·", "Re", "Î»", "H/m", "N/kW", "Î·/%"]

    def __init__(self, window):
        super().__init__(window)
        self.window = window
        self.csv_file_paths = None  # æ”¹ä¸ºå­˜å‚¨CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        self.processed_data = None
        self.current_page = 0
        self.images_paths = []
        self._init_components()
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        # å·¦ä¾§é¢æ¿
        self.left_frame = ttk.Frame(self.main_paned, width=600)
        self.main_paned.add(self.left_frame, weight=1)
        self._init_left_panel()

        # å³ä¾§é¢æ¿
        self.right_frame = ttk.Frame(self.main_paned, width=800)
        self.main_paned.add(self.right_frame, weight=2)
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§é¢æ¿"""
        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(side="top", fill="x", padx=5, pady=5)

        # å¯¼å…¥æ•°æ®æŒ‰é’® - ä¿®æ”¹ä¸ºå¯¼å…¥CSVæ–‡ä»¶
        self.import_data_btn = Button(button_frame, text="å¯¼å…¥CSVæ•°æ®", command=self.load_csv_data)
        self.import_data_btn.pack(side="left", padx=5, pady=5)

        # å¤„ç†æ•°æ®æŒ‰é’®
        self.process_data_btn = Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data)
        self.process_data_btn.pack(side="left", padx=5, pady=5)

        # ç»˜åˆ¶å›¾å½¢æŒ‰é’®
        self.plot_graph_btn = Button(button_frame, text="ç»˜åˆ¶å›¾å½¢", command=self.plot_graph)
        self.plot_graph_btn.pack(side="left", padx=5, pady=5)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame, text="åŸå§‹æ•°æ®")
        self.raw_data_display.pack(pady=10, fill="both", expand=True)
        self.raw_data_table = TableWidget(self.raw_data_display, self.RAW_COLS, widths=[60, 120, 120, 120])
        self.raw_data_table.pack(pady=10, fill="both", expand=True)

        # ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame, text="è®¡ç®—ç»“æœ")
        self.res_data_display.pack(pady=10, fill="both", expand=True)
        self.res_data_table = TableWidget(self.res_data_display, self.RESULT_COLS, widths=[60, 120, 120, 120, 120, 120])
        self.res_data_table.pack(pady=10, fill="both", expand=True)

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§é¢æ¿"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # ç»˜å›¾åŒºåŸŸ
        self.plot_frame = ttk.Frame(self.right_paned)
        self.right_paned.add(self.plot_frame, weight=1)

        # å›¾åƒæ˜¾ç¤ºCanvas
        self.image_canvas = Canvas(self.plot_frame)
        self.image_canvas.pack(fill="both", expand=True)
        self.image_canvas.bind("<Configure>", self.on_resize)

        # é¡µç æ ‡ç­¾
        self.page_label = ttk.Label(self.right_frame, text="Page 1/1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # ç¿»é¡µæŒ‰é’®
        button_frame = ttk.Frame(self.right_frame)
        button_frame.pack(side="bottom", fill="x", padx=5, pady=10)

        self.prev_btn = ttk.Button(button_frame, text="ä¸Šä¸€é¡µ", command=self.show_prev_page, state="disabled")
        self.prev_btn.pack(side="left", padx=5, pady=5)

        self.next_btn = ttk.Button(button_frame, text="ä¸‹ä¸€é¡µ", command=self.show_next_page, state="disabled")
        self.next_btn.pack(side="left", padx=5, pady=5)

    def load_csv_data(self):
        """åŠ è½½CSVæ–‡ä»¶æ•°æ®å¹¶è‡ªåŠ¨åˆ†ç±»"""
        # é€‰æ‹©å¤šä¸ªCSVæ–‡ä»¶
        file_paths = filedialog.askopenfilenames(
            title="é€‰æ‹©æµä½“æµåŠ¨å®éªŒCSVæ–‡ä»¶ï¼ˆéœ€åŒ…å«æµä½“é˜»åŠ›ã€ç¦»å¿ƒæ³µæ•°æ®ï¼‰",
            filetypes=[("CSV Files", "*.csv")],
            initialdir="./",
        )

        if not file_paths:
            return

        try:
            # æ–‡ä»¶åˆ†ç±»å­—å…¸
            file_dict = {"fluid": None, "pump": None}

            # æ ¹æ®æ–‡ä»¶åå…³é”®è¯åˆ†ç±»æ–‡ä»¶
            for path in file_paths:
                filename = os.path.basename(path).lower()
                if "æµä½“é˜»åŠ›" in filename:
                    file_dict["fluid"] = path
                elif "ç¦»å¿ƒæ³µ" in filename:
                    file_dict["pump"] = path

            # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¿…è¦æ–‡ä»¶éƒ½å·²æ‰¾åˆ°
            missing_files = [name for name, path in file_dict.items() if path is None]
            if missing_files:
                messagebox.showerror("é”™è¯¯", f"ç¼ºå°‘å¿…è¦çš„æ–‡ä»¶ç±»å‹: {', '.join(missing_files)}")
                return

            # å­˜å‚¨åˆ†ç±»åçš„æ–‡ä»¶è·¯å¾„
            self.csv_file_paths = list(file_dict.values())

            # åŠ è½½æµä½“é˜»åŠ›æ•°æ®åˆ°è¡¨æ ¼æ˜¾ç¤º
            df = pd.read_csv(file_dict["fluid"], skiprows=2, header=None)
            raw_data = df.iloc[:, :4].values
            self.update_raw_data_table(raw_data)

            messagebox.showinfo(
                "æˆåŠŸ", "æ–‡ä»¶åŠ è½½å®Œæˆï¼Œå·²è‡ªåŠ¨åˆ†ç±»:\n" + "\n".join([f"{k}: {v}" for k, v in file_dict.items()])
            )

        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"åŠ è½½CSVæ•°æ®å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def process_data(self):
        """å¤„ç†æ•°æ®"""
        if not self.csv_file_paths:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¯¼å…¥CSVæ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # 1. åˆ›å»ºå¤„ç†å™¨å®ä¾‹å¹¶å¤„ç†æ•°æ®
            self.processor = Fluid_Flow_Expriment_Processor(self.csv_file_paths)
            self.processor.process_fluid_flow()
            self.processor.process_pump_characteristics()

            # 2. è·å–å¤„ç†åçš„æ•°æ®
            self.processed_data = {
                "fluid": self.processor.get_fluid_flow_results(),
                "pump": self.processor.get_pump_characteristics_results(),
            }

            # 3. æ›´æ–°ç»“æœè¡¨æ ¼
            self.update_results_table()

            # 4. å‡†å¤‡å›¾åƒè·¯å¾„
            self.images_paths = [
                "./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æ— æ’å€¼).png",
                "./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æœ‰æ’å€¼).png",
                "./æ‹Ÿåˆå›¾ç»“æœ/ç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿åŠäºŒæ¬¡æ‹Ÿåˆ.png",
            ]

            self.close_processing_window()
            self.enable_page_buttons()
            messagebox.showinfo("æˆåŠŸ", "æ•°æ®å¤„ç†å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"æ•°æ®å¤„ç†å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def plot_graph(self):
        """ç»˜åˆ¶å›¾å½¢"""
        if not hasattr(self, "processor") or not self.processor:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¤„ç†æ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # 1. è°ƒç”¨ç»˜å›¾æ–¹æ³•
            self.processor.generate_all_plots()

            # 2. æ›´æ–°å›¾åƒè·¯å¾„
            self.images_paths = [
                "./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æ— æ’å€¼).png",
                "./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æœ‰æ’å€¼).png",
                "./æ‹Ÿåˆå›¾ç»“æœ/ç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿åŠäºŒæ¬¡æ‹Ÿåˆ.png",
            ]

            # 3. æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾
            if self.images_paths:
                self.current_page = 0
                self.show_current_page()
                self.enable_page_buttons()

            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "å›¾å½¢ç»˜åˆ¶å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"ç»˜åˆ¶å›¾å½¢å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    # ä»¥ä¸‹æ˜¯åŸæœ‰çš„è¾…åŠ©æ–¹æ³•ï¼Œä¿æŒä¸å˜
    def show_processing_window(self):
        """æ˜¾ç¤ºå¤„ç†ä¸­çš„çª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("å¤„ç†ä¸­")
        self.processing_window.geometry("200x100")
        label = ttk.Label(self.processing_window, text="æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...")
        label.pack(expand=True)
        self.processing_window.grab_set()
        self.processing_window.update()

    def close_processing_window(self):
        """å…³é—­å¤„ç†ä¸­çš„çª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.grab_release()
            self.processing_window.destroy()

    def update_raw_data_table(self, raw_data=None):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        self.raw_data_table.clear()
        self.raw_data_table.table["columns"] = self.RAW_COLS
        for col in self.RAW_COLS:
            self.raw_data_table.table.heading(col, text=col)
        if raw_data is not None:
            for idx, row in enumerate(raw_data):
                self.raw_data_table.append([idx + 1, row[0], row[1], row[2]])

    def update_results_table(self):
        """æ›´æ–°ç»“æœè¡¨æ ¼"""
        self.res_data_table.clear()
        self.res_data_table.table["columns"] = self.RESULT_COLS
        for col in self.RESULT_COLS:
            self.res_data_table.table.heading(col, text=col)

        # æµä½“é˜»åŠ›ç»“æœ
        fluid_results = self.processed_data["fluid"]
        self.res_data_table.append(
            [
                "æµä½“é˜»åŠ›",
                f"{np.mean(fluid_results['reynolds']):.2f}",
                f"{np.mean(fluid_results['friction_factor']):.2f}",
                "",
                "",
                "",
            ]
        )

        # ç¦»å¿ƒæ³µç»“æœ
        pump_results = self.processed_data["pump"]
        self.res_data_table.append(
            [
                "ç¦»å¿ƒæ³µç‰¹æ€§",
                "",
                "",
                f"{np.mean(pump_results['head']):.2f}",
                f"{np.mean(pump_results['power']):.2f}",
                f"{np.mean(pump_results['efficiency']):.2f}",
            ]
        )

    def show_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µçš„å›¾å½¢"""
        self.image_canvas.delete("all")
        if not self.images_paths or self.current_page >= len(self.images_paths):
            return

        try:
            img = Image.open(self.images_paths[self.current_page])
            canvas_width = self.image_canvas.winfo_width()
            canvas_height = self.image_canvas.winfo_height()

            # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
            img_ratio = img.width / img.height
            canvas_ratio = canvas_width / canvas_height

            if canvas_ratio > img_ratio:
                new_height = canvas_height
                new_width = int(new_height * img_ratio)
            else:
                new_width = canvas_width
                new_height = int(new_width / img_ratio)

            img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
            img_tk = ImageTk.PhotoImage(img)

            # å±…ä¸­æ˜¾ç¤º
            x_pos = (canvas_width - new_width) // 2
            y_pos = (canvas_height - new_height) // 2

            self.image_canvas.create_image(x_pos, y_pos, image=img_tk, anchor="nw")
            self.image_canvas.image = img_tk

            # æ›´æ–°é¡µç 
            self.page_label.config(text=f"Page {self.current_page + 1}/{len(self.images_paths)}")
        except Exception as e:
            logging.error(f"åŠ è½½å›¾åƒå¤±è´¥: {str(e)}")

    def on_resize(self, event):
        """å¤„ç†ç”»å¸ƒå¤§å°å˜åŒ–"""
        if self.images_paths:
            self.show_current_page()

    def show_prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_current_page()
        self.enable_page_buttons()  # æ–°å¢ï¼šç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def show_next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_current_page()
        self.enable_page_buttons()  # æ–°å¢ï¼šç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def enable_page_buttons(self):
        """å¯ç”¨/ç¦ç”¨ç¿»é¡µæŒ‰é’®"""
        if not self.images_paths or len(self.images_paths) <= 1:
            self.prev_btn.config(state="disabled")
            self.next_btn.config(state="disabled")
        else:
            # æ ¹æ®å½“å‰é¡µç è®¾ç½®æŒ‰é’®çŠ¶æ€
            prev_state = "normal" if self.current_page > 0 else "disabled"
            next_state = "normal" if self.current_page < len(self.images_paths) - 1 else "disabled"
            self.prev_btn.config(state=prev_state)
            self.next_btn.config(state=next_state)

    def close_window(self):
        """å…³é—­çª—å£"""
        self.window.destroy()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\heat_transfer_screen.py çš„å†…å®¹:
================================================================================
# heat_transfer_screen.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)
import logging
import traceback
from tkinter import (
    Label,
    PhotoImage,
    Toplevel,
    messagebox,
    ttk,
    Button,
    filedialog,
    Canvas,
    StringVar,
)
from tkinter import ttk
from PIL import Image, ImageTk
import numpy as np
import pandas as pd

# é…ç½®æ—¥å¿—è®¾ç½®
# ä¿ç•™è‡ªå·±ä»£ç çš„DEBUGæ—¥å¿—ï¼Œè¿‡æ»¤ç¬¬ä¸‰æ–¹åº“çš„
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(name)s - %(levelname)s - %(message)s")

# è®¾ç½®ç¬¬ä¸‰æ–¹åº“çš„æ—¥å¿—çº§åˆ«
logging.getLogger("matplotlib").setLevel(logging.WARNING)
logging.getLogger("PIL").setLevel(logging.WARNING)
logging.getLogger("numpy").setLevel(logging.WARNING)
logging.getLogger("pandas").setLevel(logging.WARNING)

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG
from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.table_widget import TableWidget
from gui.screens.common_widgets.text_widget import TextWidget

# æ•°æ®å¤„ç†ç±»
from gui.screens.processors.heat_transfer_experiment_processor import Heat_Transfer_Experiment_Processor


class Heat_Transfer_Screen(ttk.Frame):
    """
    ä¼ çƒ­å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯¼å…¥åŠŸèƒ½ã€‚
    ä¿®æ”¹ä¸ºå¤„ç†CSVæ–‡ä»¶è€ŒéExcelæ–‡ä»¶ã€‚
    """

    RAW_COLS = ["åºå·", "Î”på­”æ¿/kPa", "tå…¥/Â°C", "tå‡º/Â°C"]
    RESULT_COLS = ["ç»„å·", "Re", "Pr", "Nu/Pr^0.4"]

    def __init__(self, window):
        super().__init__(window)
        self.window = window
        self.csv_file_paths = None  # æ”¹ä¸ºå­˜å‚¨CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        self.processed_data = None
        self.current_page = 0
        self.images_paths = []
        self._init_components()
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        # å·¦ä¾§é¢æ¿
        self.left_frame = ttk.Frame(self.main_paned, width=600)
        self.main_paned.add(self.left_frame, weight=1)
        self._init_left_panel()

        # å³ä¾§é¢æ¿
        self.right_frame = ttk.Frame(self.main_paned, width=800)
        self.main_paned.add(self.right_frame, weight=2)
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§é¢æ¿"""
        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(side="top", fill="x", padx=5, pady=5)

        # å¯¼å…¥æ•°æ®æŒ‰é’® - ä¿®æ”¹ä¸ºå¯¼å…¥CSVæ–‡ä»¶
        self.import_data_btn = Button(button_frame, text="å¯¼å…¥CSVæ•°æ®", command=self.load_csv_data)
        self.import_data_btn.pack(side="left", padx=5, pady=5)

        # å¤„ç†æ•°æ®æŒ‰é’®
        self.process_data_btn = Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data)
        self.process_data_btn.pack(side="left", padx=5, pady=5)

        # ç»˜åˆ¶å›¾å½¢æŒ‰é’®
        self.plot_graph_btn = Button(button_frame, text="ç»˜åˆ¶å›¾å½¢", command=self.plot_graph)
        self.plot_graph_btn.pack(side="left", padx=5, pady=5)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame, text="åŸå§‹æ•°æ®")
        self.raw_data_display.pack(pady=10, fill="both", expand=True)
        self.raw_data_table = TableWidget(self.raw_data_display, self.RAW_COLS, widths=[60, 120, 120, 120])
        self.raw_data_table.pack(pady=10, fill="both", expand=True)

        # ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame, text="è®¡ç®—ç»“æœ")
        self.res_data_display.pack(pady=10, fill="both", expand=True)
        self.res_data_table = TableWidget(self.res_data_display, self.RESULT_COLS, widths=[60, 120, 120, 120])
        self.res_data_table.pack(pady=10, fill="both", expand=True)

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§é¢æ¿"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # ç»˜å›¾åŒºåŸŸ
        self.plot_frame = ttk.Frame(self.right_paned)
        self.right_paned.add(self.plot_frame, weight=1)

        # å›¾åƒæ˜¾ç¤ºCanvas
        self.image_canvas = Canvas(self.plot_frame)
        self.image_canvas.pack(fill="both", expand=True)
        self.image_canvas.bind("<Configure>", self.on_resize)

        # é¡µç æ ‡ç­¾
        self.page_label = ttk.Label(self.right_frame, text="Page 1/1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # ç¿»é¡µæŒ‰é’®
        button_frame = ttk.Frame(self.right_frame)
        button_frame.pack(side="bottom", fill="x", padx=5, pady=10)

        self.prev_btn = ttk.Button(button_frame, text="ä¸Šä¸€é¡µ", command=self.show_prev_page, state="disabled")
        self.prev_btn.pack(side="left", padx=5, pady=5)

        self.next_btn = ttk.Button(button_frame, text="ä¸‹ä¸€é¡µ", command=self.show_next_page, state="disabled")
        self.next_btn.pack(side="left", padx=5, pady=5)

    def load_csv_data(self):
        """åŠ è½½CSVæ–‡ä»¶æ•°æ®å¹¶è‡ªåŠ¨åˆ†ç±»"""
        # é€‰æ‹©å¤šä¸ªCSVæ–‡ä»¶
        file_paths = filedialog.askopenfilenames(
            title="é€‰æ‹©ä¼ çƒ­å®éªŒCSVæ–‡ä»¶ï¼ˆéœ€åŒ…å«æ— å¼ºåŒ–å¥—ç®¡ã€æœ‰å¼ºåŒ–å¥—ç®¡ã€é¢„å¤„ç†æ–‡ä»¶ï¼‰",
            filetypes=[("CSV Files", "*.csv")],
            initialdir="./",
        )

        if not file_paths:
            return

        try:
            # æ–‡ä»¶åˆ†ç±»å­—å…¸
            file_dict = {"æ— å¼ºåŒ–å¥—ç®¡": None, "æœ‰å¼ºåŒ–å¥—ç®¡": None, "é¢„å¤„ç†_æ— ": None, "é¢„å¤„ç†_æœ‰": None}

            # æ ¹æ®æ–‡ä»¶åå…³é”®è¯åˆ†ç±»æ–‡ä»¶
            for path in file_paths:
                filename = os.path.basename(path).lower()
                if "æ— å¼ºåŒ–å¥—ç®¡" in filename and "é¢„å¤„ç†" not in filename:
                    file_dict["æ— å¼ºåŒ–å¥—ç®¡"] = path
                elif "æœ‰å¼ºåŒ–å¥—ç®¡" in filename and "é¢„å¤„ç†" not in filename:
                    file_dict["æœ‰å¼ºåŒ–å¥—ç®¡"] = path
                elif "é¢„å¤„ç†_æ— " in filename or "æ•°æ®é¢„å¤„ç†_æ— " in filename:
                    file_dict["é¢„å¤„ç†_æ— "] = path
                elif "é¢„å¤„ç†_æœ‰" in filename or "æ•°æ®é¢„å¤„ç†_æœ‰" in filename:
                    file_dict["é¢„å¤„ç†_æœ‰"] = path

            # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¿…è¦æ–‡ä»¶éƒ½å·²æ‰¾åˆ°
            missing_files = [name for name, path in file_dict.items() if path is None]
            if missing_files:
                messagebox.showerror("é”™è¯¯", f"ç¼ºå°‘å¿…è¦çš„æ–‡ä»¶ç±»å‹: {', '.join(missing_files)}")
                return

            # å­˜å‚¨åˆ†ç±»åçš„æ–‡ä»¶è·¯å¾„
            self.csv_file_paths = list(file_dict.values())

            # åŠ è½½æ— å¼ºåŒ–å¥—ç®¡æ•°æ®åˆ°è¡¨æ ¼æ˜¾ç¤º
            df = pd.read_csv(file_dict["æ— å¼ºåŒ–å¥—ç®¡"], header=None)
            raw_data = df.iloc[1:7, 1:4].values
            self.update_raw_data_table(raw_data)

            messagebox.showinfo(
                "æˆåŠŸ", "æ–‡ä»¶åŠ è½½å®Œæˆï¼Œå·²è‡ªåŠ¨åˆ†ç±»:\n" + "\n".join([f"{k}: {v}" for k, v in file_dict.items()])
            )

        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"åŠ è½½CSVæ•°æ®å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def process_data(self):
        """å¤„ç†æ•°æ®"""
        if not self.csv_file_paths:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¯¼å…¥CSVæ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # 1. åˆ›å»ºè®¡ç®—å™¨å®ä¾‹å¹¶å¤„ç†æ•°æ®
            self.processor = Heat_Transfer_Experiment_Processor(self.csv_file_paths)
            self.processor.calculate()  # è®¡ç®—æ•°æ®
            self.processor.store()  # å­˜å‚¨ç»“æœ

            # 2. è·å–å¤„ç†åçš„æ•°æ®
            self.processed_data = self.processor.processed_data

            # 3. æ›´æ–°ç»“æœè¡¨æ ¼
            self.update_results_table(self.processed_data)

            # 4. å‡†å¤‡å›¾åƒè·¯å¾„
            self.images_paths = [
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æ— å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æœ‰å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/ä¼ çƒ­æ€§èƒ½å¯¹æ¯”.png",
            ]

            self.close_processing_window()
            self.enable_page_buttons()
            messagebox.showinfo("æˆåŠŸ", "æ•°æ®å¤„ç†å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"æ•°æ®å¤„ç†å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    def plot_graph(self):
        """ç»˜åˆ¶å›¾å½¢"""
        if not hasattr(self, "processor") or not self.processor:
            messagebox.showwarning("è­¦å‘Š", "è¯·å…ˆå¤„ç†æ•°æ®ï¼")
            return

        try:
            self.show_processing_window()

            # 1. è°ƒç”¨ç»˜å›¾æ–¹æ³•
            self.processor.plot()

            # 2. å‹ç¼©ç»“æœ
            self.processor.compress_results()

            # 3. æ›´æ–°å›¾åƒè·¯å¾„
            self.images_paths = [
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æ— å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æœ‰å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/ä¼ çƒ­æ€§èƒ½å¯¹æ¯”.png",
            ]

            # 4. æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾
            if self.images_paths:
                self.current_page = 0
                self.show_current_page()
                self.enable_page_buttons()

            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "å›¾å½¢ç»˜åˆ¶å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"ç»˜åˆ¶å›¾å½¢å¤±è´¥ï¼š{str(e)}")
            logging.error(traceback.format_exc())

    # ä»¥ä¸‹æ˜¯åŸæœ‰çš„è¾…åŠ©æ–¹æ³•ï¼Œä¿æŒä¸å˜
    def show_processing_window(self):
        """æ˜¾ç¤ºå¤„ç†ä¸­çš„çª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("å¤„ç†ä¸­")
        self.processing_window.geometry("200x100")
        label = ttk.Label(self.processing_window, text="æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...")
        label.pack(expand=True)
        self.processing_window.grab_set()
        self.processing_window.update()

    def close_processing_window(self):
        """å…³é—­å¤„ç†ä¸­çš„çª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.grab_release()
            self.processing_window.destroy()

    def update_raw_data_table(self, raw_data=None):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        self.raw_data_table.clear()
        self.raw_data_table.table["columns"] = self.RAW_COLS
        for col in self.RAW_COLS:
            self.raw_data_table.table.heading(col, text=col)
        if raw_data is not None:
            for idx, row in enumerate(raw_data):
                self.raw_data_table.append([idx + 1, row[0], row[1], row[2]])

    def update_results_table(self, processed_data=None):
        """æ›´æ–°ç»“æœè¡¨æ ¼"""
        self.res_data_table.clear()
        self.res_data_table.table["columns"] = self.RESULT_COLS
        for col in self.RESULT_COLS:
            self.res_data_table.table.heading(col, text=col)
        if processed_data is not None:
            for data in processed_data:
                re_mean = np.mean(data["data_for_fit"][:, 0]) if data["data_for_fit"].size > 0 else 0
                pr_mean = np.mean(data["calculated_data"].loc["Pr"]) if "Pr" in data["calculated_data"].index else 0
                nu_pr_mean = np.mean(data["data_for_fit"][:, 1]) if data["data_for_fit"].size > 0 else 0
                self.res_data_table.append(
                    [
                        data["group"],
                        f"{re_mean:.2f}",
                        f"{pr_mean:.2f}",
                        f"{nu_pr_mean:.2f}",
                    ]
                )

    def show_current_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µçš„å›¾å½¢"""
        self.image_canvas.delete("all")
        if not self.images_paths or self.current_page >= len(self.images_paths):
            return

        try:
            img = Image.open(self.images_paths[self.current_page])
            canvas_width = self.image_canvas.winfo_width()
            canvas_height = self.image_canvas.winfo_height()

            # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
            img_ratio = img.width / img.height
            canvas_ratio = canvas_width / canvas_height

            if canvas_ratio > img_ratio:
                new_height = canvas_height
                new_width = int(new_height * img_ratio)
            else:
                new_width = canvas_width
                new_height = int(new_width / img_ratio)

            img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
            img_tk = ImageTk.PhotoImage(img)

            # å±…ä¸­æ˜¾ç¤º
            x_pos = (canvas_width - new_width) // 2
            y_pos = (canvas_height - new_height) // 2

            self.image_canvas.create_image(x_pos, y_pos, image=img_tk, anchor="nw")
            self.image_canvas.image = img_tk

            # æ›´æ–°é¡µç 
            self.page_label.config(text=f"Page {self.current_page + 1}/{len(self.images_paths)}")
        except Exception as e:
            logging.error(f"åŠ è½½å›¾åƒå¤±è´¥: {str(e)}")

    def on_resize(self, event):
        """å¤„ç†ç”»å¸ƒå¤§å°å˜åŒ–"""
        if self.images_paths:
            self.show_current_page()

    def show_prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_current_page()

    def show_prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_current_page()
        self.enable_page_buttons()  # æ–°å¢ï¼šç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def show_next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_current_page()
        self.enable_page_buttons()  # æ–°å¢ï¼šç¿»é¡µåæ›´æ–°æŒ‰é’®çŠ¶æ€

    def enable_page_buttons(self):
        """å¯ç”¨/ç¦ç”¨ç¿»é¡µæŒ‰é’®"""
        if not self.images_paths or len(self.images_paths) <= 1:
            self.prev_btn.config(state="disabled")
            self.next_btn.config(state="disabled")
        else:
            # æ ¹æ®å½“å‰é¡µç è®¾ç½®æŒ‰é’®çŠ¶æ€
            prev_state = "normal" if self.current_page > 0 else "disabled"
            next_state = "normal" if self.current_page < len(self.images_paths) - 1 else "disabled"
            self.prev_btn.config(state=prev_state)
            self.next_btn.config(state=next_state)

    def close_window(self):
        """å…³é—­çª—å£"""
        self.window.destroy()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\oxygen_desorption_screen.py çš„å†…å®¹:
================================================================================
# oxygen_desorption_screen.py

# å†…éƒ¨åº“
import sys
import os
import logging
import traceback
import tkinter as tk
from pathlib import Path
from tkinter import Label, PhotoImage, Toplevel, messagebox, ttk, Button, filedialog, Canvas
from PIL import Image, ImageTk
import pandas as pd

# é…ç½®æ—¥å¿—è®¾ç½®
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(name)s - %(levelname)s - %(message)s")
# è®¾ç½®ç¬¬ä¸‰æ–¹åº“çš„æ—¥å¿—çº§åˆ«
logging.getLogger("matplotlib").setLevel(logging.WARNING)
logging.getLogger("PIL").setLevel(logging.WARNING)
logging.getLogger("pandas").setLevel(logging.WARNING)

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = Path(current_script_path).parents[2]  # å‘ä¸Š3çº§åˆ°é¡¹ç›®æ ¹
sys.path.insert(0, str(project_root))

# å¯¼å…¥ç•Œé¢é…ç½®å’Œå°éƒ¨ä»¶
from gui.screens.utils.config import MAIN_FRAME_CONFIG, SCREEN_CONFIG

from gui.screens.common_widgets.plot_widget import PlotWidget
from gui.screens.common_widgets.table_widget import TableWidget

# å¯¼å…¥è®¡ç®—å™¨
from gui.screens.calculators.oxygen_desorption_calculator import Oxygen_Desorption_Calculator, Packed_Tower_Calculator

# å¯¼å…¥å¤„ç†å™¨
from gui.screens.processors.oxygen_desorption_experiment_processor import Oxygen_Desorption_Experiment_Processor


class Oxygen_Desorption_Screen(ttk.Frame):
    """
    æ°§è§£å¸å®éªŒç•Œé¢ç±»ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ˜¾ç¤ºå’Œå¯è§†åŒ–åŠŸèƒ½
    """

    RAW_COLS = ["åºå·", "æ°´æµé‡(L/h)", "ç©ºæ°”æµé‡(mÂ³/h)", "å‹å·®(mmH2O)", "å…¥å£æµ“åº¦(mg/L)", "å‡ºå£æµ“åº¦(mg/L)", "æ¸©åº¦(â„ƒ)"]
    RESULT_COLS = ["å®éªŒç»„åˆ«", "æ¶²ç›¸æµé‡(mol/s)", "æ°”ç›¸æµé‡(mol/s)", "ä¼ è´¨ç³»æ•°Kxa"]

    def __init__(self, window):
        super().__init__(window, **SCREEN_CONFIG)
        self.window = window
        self.file_paths = {}  # å­˜å‚¨å››ä¸ªæ–‡ä»¶çš„è·¯å¾„
        self.processed_data = None
        self.current_page = 0
        self.images_paths = []
        self._init_components()
        self.window.protocol("WM_DELETE_WINDOW", self.close_window)

    def _init_components(self):
        """åˆå§‹åŒ–ç•Œé¢ç»„ä»¶"""
        self.main_paned = ttk.PanedWindow(self, orient="horizontal")
        self.main_paned.pack(expand=True, fill="both")

        # å·¦ä¾§é¢æ¿
        self.left_frame = ttk.Frame(self.main_paned, **MAIN_FRAME_CONFIG)
        self.main_paned.add(self.left_frame, weight=1)

        # å³ä¾§é¢æ¿
        self.right_frame = ttk.Frame(self.main_paned, **MAIN_FRAME_CONFIG)
        self.main_paned.add(self.right_frame, weight=2)

        self._init_left_panel()
        self._init_right_panel()

    def _init_left_panel(self):
        """åˆå§‹åŒ–å·¦ä¾§æ“ä½œé¢æ¿"""
        # æ–‡ä»¶é€‰æ‹©åŒºåŸŸ
        file_select_frame = ttk.LabelFrame(self.left_frame, text="æ•°æ®æ–‡ä»¶é€‰æ‹©")
        file_select_frame.pack(fill="x", padx=5, pady=5)

        # æ·»åŠ "å¯¼å…¥æ‰€æœ‰æ–‡ä»¶"æŒ‰é’®
        ttk.Button(file_select_frame, text="å¯¼å…¥æ‰€æœ‰æ–‡ä»¶", command=self._import_all_files).grid(
            row=0, column=0, columnspan=3, pady=5, sticky="ew"
        )

        # æ–‡ä»¶æ˜¾ç¤ºåŒºåŸŸ
        ttk.Label(file_select_frame, text="å·²é€‰æ‹©æ–‡ä»¶:").grid(row=1, column=0, sticky="w")
        self.file_listbox = tk.Listbox(file_select_frame, height=4, width=40)
        self.file_listbox.grid(row=2, column=0, columnspan=3, padx=5, pady=5, sticky="ew")

        # æ“ä½œæŒ‰é’®åŒºåŸŸ
        button_frame = ttk.Frame(self.left_frame)
        button_frame.pack(fill="x", padx=5, pady=5)

        self.process_btn = ttk.Button(button_frame, text="å¤„ç†æ•°æ®", command=self.process_data, state="disabled")
        self.process_btn.pack(side="left", padx=5)

        self.plot_btn = ttk.Button(button_frame, text="ç”Ÿæˆå›¾è¡¨", command=self.plot_graph, state="disabled")
        self.plot_btn.pack(side="left", padx=5)

        # åŸå§‹æ•°æ®è¡¨æ ¼
        self.raw_data_display = ttk.LabelFrame(self.left_frame, text="åŸå§‹æ•°æ®é¢„è§ˆ")
        self.raw_data_display.pack(fill="both", expand=True, padx=5, pady=5)
        self.raw_data_table = TableWidget(self.raw_data_display, self.RAW_COLS, widths=[10] * len(self.RAW_COLS))
        self.raw_data_table.pack(fill="both", expand=True)

        # ç»“æœæ•°æ®è¡¨æ ¼
        self.res_data_display = ttk.LabelFrame(self.left_frame, text="å¤„ç†ç»“æœ")
        self.res_data_display.pack(fill="both", expand=True, padx=5, pady=5)
        self.res_data_table = TableWidget(self.res_data_display, self.RESULT_COLS, widths=[15] * len(self.RESULT_COLS))
        self.res_data_table.pack(fill="both", expand=True)

    def _init_right_panel(self):
        """åˆå§‹åŒ–å³ä¾§å¯è§†åŒ–é¢æ¿"""
        self.right_paned = ttk.PanedWindow(self.right_frame, orient="vertical")
        self.right_paned.pack(fill="both", expand=True)

        # å›¾åƒæ˜¾ç¤ºåŒºåŸŸ
        self.image_panel = ttk.Frame(self.right_paned)
        self.right_paned.add(self.image_panel, weight=1)
        self.image_canvas = Canvas(self.image_panel)
        self.image_canvas.pack(fill="both", expand=True)
        self.image_canvas.bind("<Configure>", self.on_resize)

        # åˆ†é¡µæ§åˆ¶
        self.page_label = ttk.Label(self.right_frame, text="Page 1/1")
        self.page_label.pack(side="top", padx=5, pady=5)

        # å¯¼èˆªæŒ‰é’®
        nav_frame = ttk.Frame(self.right_frame)
        nav_frame.pack(side="bottom", fill="x", padx=5, pady=10)
        self.prev_btn = ttk.Button(nav_frame, text="ä¸Šä¸€é¡µ", command=self.prev_page, state="disabled")
        self.prev_btn.pack(side="left", padx=5)
        self.next_btn = ttk.Button(nav_frame, text="ä¸‹ä¸€é¡µ", command=self.next_page, state="disabled")
        self.next_btn.pack(side="left", padx=5)

    def _import_all_files(self):
        """ä¸€æ¬¡æ€§å¯¼å…¥æ‰€æœ‰éœ€è¦çš„æ–‡ä»¶"""
        file_paths = filedialog.askopenfilenames(
            title="é€‰æ‹©æ°§è§£å¸å®éªŒæ•°æ®æ–‡ä»¶(è¯·åŒæ—¶é€‰æ‹©å¹²å¡«æ–™ã€æ¹¿å¡«æ–™ã€æ°´æµé‡ä¸€å®šå’Œç©ºæ°”æµé‡ä¸€å®šæ–‡ä»¶)",
            filetypes=[("CSVæ–‡ä»¶", "*.csv")],
        )

        if not file_paths:
            return

        # æ¸…ç©ºç°æœ‰æ–‡ä»¶è·¯å¾„
        self.file_paths = {}
        self.file_listbox.delete(0, tk.END)

        # æ ¹æ®æ–‡ä»¶åè‡ªåŠ¨åˆ†ç±»æ–‡ä»¶
        for file_path in file_paths:
            filename = os.path.basename(file_path).lower()

            if "å¹²å¡«æ–™" in filename:
                self.file_paths["dry_packed"] = file_path
                self.file_listbox.insert(tk.END, f"å¹²å¡«æ–™: {file_path}")
            elif "æ¹¿å¡«æ–™" in filename:
                self.file_paths["wet_packed"] = file_path
                self.file_listbox.insert(tk.END, f"æ¹¿å¡«æ–™: {file_path}")
            elif "æ°´æµé‡ä¸€å®š" in filename:
                self.file_paths["water_constant"] = file_path
                self.file_listbox.insert(tk.END, f"æ°´æµé‡ä¸€å®š: {file_path}")
            elif "ç©ºæ°”æµé‡ä¸€å®š" in filename:
                self.file_paths["air_constant"] = file_path
                self.file_listbox.insert(tk.END, f"ç©ºæ°”æµé‡ä¸€å®š: {file_path}")

        # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ–‡ä»¶éƒ½å·²é€‰æ‹©å¹¶åŠ è½½é¢„è§ˆ
        self._check_files_complete()
        if "dry_packed" in self.file_paths:
            self._load_data_preview(self.file_paths["dry_packed"])

    def _check_files_complete(self):
        """æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å·²é€‰æ‹©"""
        required_files = ["dry_packed", "wet_packed", "water_constant", "air_constant"]
        if all(f in self.file_paths for f in required_files):
            self.process_btn.config(state="normal")
        else:
            self.process_btn.config(state="disabled")
            missing_files = [f for f in required_files if f not in self.file_paths]
            messagebox.showwarning("è­¦å‘Š", f"ç¼ºå°‘ä»¥ä¸‹æ–‡ä»¶: {', '.join(missing_files)}\nè¯·ç¡®ä¿é€‰æ‹©äº†æ‰€æœ‰å¿…éœ€æ–‡ä»¶")

    def _load_data_preview(self, file_path):
        """åŠ è½½æ•°æ®é¢„è§ˆåˆ°è¡¨æ ¼"""
        try:
            df = pd.read_csv(file_path, header=None)
            # æ•°æ®ä»ç¬¬3è¡Œå¼€å§‹ï¼Œå‰ä¸¤è¡Œæ˜¯æ ‡é¢˜
            data = df.iloc[2:, 1:7].values  # å–ç¬¬2åˆ—åˆ°ç¬¬7åˆ—çš„æ•°æ®
            self.update_raw_data_table(data)
        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"æ•°æ®é¢„è§ˆåŠ è½½å¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def process_data(self):
        """æ‰§è¡Œæ•°æ®å¤„ç†æµç¨‹"""
        try:
            self.show_processing_window()

            # åˆ›å»ºå®éªŒå¤„ç†å™¨å®ä¾‹
            self.experiment = Oxygen_Desorption_Experiment_Processor(
                dry_packed_path=self.file_paths["dry_packed"],
                wet_packed_path=self.file_paths["wet_packed"],
                water_constant_path=self.file_paths["water_constant"],
                air_constant_path=self.file_paths["air_constant"],
            )

            # æ‰§è¡Œå®Œæ•´åˆ†æ
            self.experiment.run_full_analysis(compress_results=False)

            # æ›´æ–°ç»“æœè¡¨æ ¼
            self._update_results()

            # è®¾ç½®å›¾åƒè·¯å¾„
            self.images_paths = [
                str(Path(self.experiment.output_dir) / "å¡«æ–™å¡”æ€§èƒ½å¯¹æ¯”.png"),
                str(Path(self.experiment.output_dir) / "æ°§è§£å¸ä¼ è´¨å…³è”.png"),
            ]

            self.plot_btn.config(state="normal")
            self.close_processing_window()
            messagebox.showinfo("æˆåŠŸ", "æ•°æ®å¤„ç†å®Œæˆï¼")
        except Exception as e:
            self.close_processing_window()
            messagebox.showerror("é”™è¯¯", f"æ•°æ®å¤„ç†å¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def _update_results(self):
        """æ›´æ–°ç»“æœè¡¨æ ¼"""
        self.res_data_table.clear()

        # å¡«æ–™å¡”ç»“æœï¼ˆé€šè¿‡Packed_Tower_Calculatorè·å–ï¼‰
        tower_calculator = Packed_Tower_Calculator(self.experiment.data_loader)
        tower_calculator.analyze_all_files()
        for result in tower_calculator.results:
            self.res_data_table.append([Path(result["csv_file"]).stem, "-", "-", f"æ‹Ÿåˆç±»å‹: {result['fit_type']}"])

        # æ°§è§£å¸ç»“æœï¼ˆé€šè¿‡Oxygen_Desorption_Calculatorè·å–ï¼‰
        oxygen_calculator = Oxygen_Desorption_Calculator(self.experiment.data_loader)
        oxygen_calculator.analyze_all_files()
        for result in oxygen_calculator.results:
            for i in range(len(result["L"])):
                self.res_data_table.append(
                    [
                        f"{Path(result['csv_file']).stem}_{i+1}",
                        f"{result['L'][i]:.4f}",
                        f"{result['G'][i]:.4f}",
                        f"{result['Kxa'][i]:.4f}",
                    ]
                )

    def plot_graph(self):
        """ç”Ÿæˆå¹¶æ˜¾ç¤ºå›¾è¡¨"""
        if not self.images_paths:
            messagebox.showwarning("è­¦å‘Š", "æ²¡æœ‰å¯ç”¨çš„å›¾è¡¨æ•°æ®ï¼")
            return

        try:
            self.current_page = 0
            self.show_page()
            self._update_page_controls()
            messagebox.showinfo("æˆåŠŸ", "å›¾è¡¨ç”Ÿæˆå®Œæˆï¼")
        except Exception as e:
            messagebox.showerror("é”™è¯¯", f"å›¾è¡¨æ˜¾ç¤ºå¤±è´¥: {str(e)}")
            logging.error(traceback.format_exc())

    def show_processing_window(self):
        """æ˜¾ç¤ºå¤„ç†ä¸­æç¤ºçª—å£"""
        self.processing_window = Toplevel(self.window)
        self.processing_window.title("å¤„ç†ä¸­")
        self.processing_window.geometry("300x100")
        Label(self.processing_window, text="æ•°æ®å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...").pack(expand=True)
        self.processing_window.grab_set()
        self.processing_window.update()

    def close_processing_window(self):
        """å…³é—­å¤„ç†æç¤ºçª—å£"""
        if hasattr(self, "processing_window"):
            self.processing_window.grab_release()
            self.processing_window.destroy()

    def update_raw_data_table(self, data):
        """æ›´æ–°åŸå§‹æ•°æ®è¡¨æ ¼"""
        self.raw_data_table.clear()
        for idx, row in enumerate(data):
            self.raw_data_table.append([idx + 1] + list(row[:6]))  # åªæ˜¾ç¤ºå‰6åˆ—æ•°æ®

    def on_resize(self, event):
        """è°ƒæ•´å›¾åƒå°ºå¯¸"""
        if self.images_paths:
            self.show_page()

    def show_page(self):
        """æ˜¾ç¤ºå½“å‰é¡µå›¾åƒ"""
        self.image_canvas.delete("all")
        if self.current_page < len(self.images_paths):
            try:
                img = Image.open(self.images_paths[self.current_page])
                canvas_width = self.image_canvas.winfo_width()
                canvas_height = self.image_canvas.winfo_height()

                # ä¿æŒå®½é«˜æ¯”ç¼©æ”¾
                img_ratio = img.width / img.height
                canvas_ratio = canvas_width / canvas_height

                if canvas_ratio > img_ratio:
                    new_height = canvas_height
                    new_width = int(new_height * img_ratio)
                else:
                    new_width = canvas_width
                    new_height = int(new_width / img_ratio)

                img = img.resize((new_width, new_height), Image.Resampling.LANCZOS)
                img_tk = ImageTk.PhotoImage(img)

                # å±…ä¸­æ˜¾ç¤º
                x_pos = (canvas_width - new_width) // 2
                y_pos = (canvas_height - new_height) // 2

                self.image_canvas.create_image(x_pos, y_pos, anchor="nw", image=img_tk)
                self.image_canvas.image = img_tk
                self.page_label.config(text=f"Page {self.current_page + 1}/{len(self.images_paths)}")
            except Exception as e:
                logging.error(f"å›¾åƒåŠ è½½å¤±è´¥: {str(e)}")

    def prev_page(self):
        """æ˜¾ç¤ºä¸Šä¸€é¡µ"""
        if self.current_page > 0:
            self.current_page -= 1
            self.show_page()
            self._update_page_controls()

    def next_page(self):
        """æ˜¾ç¤ºä¸‹ä¸€é¡µ"""
        if self.current_page < len(self.images_paths) - 1:
            self.current_page += 1
            self.show_page()
            self._update_page_controls()

    def _update_page_controls(self):
        """æ›´æ–°åˆ†é¡µæ§åˆ¶æŒ‰é’®çŠ¶æ€"""
        if len(self.images_paths) <= 1:
            self.prev_btn.config(state="disabled")
            self.next_btn.config(state="disabled")
        else:
            self.prev_btn.config(state="normal" if self.current_page > 0 else "disabled")
            self.next_btn.config(state="normal" if self.current_page < len(self.images_paths) - 1 else "disabled")

    def close_window(self):
        """å®‰å…¨å…³é—­çª—å£"""
        self.window.destroy()


if __name__ == "__main__":
    root = tk.Tk()
    root.title("æ°§è§£å¸å®éªŒæ•°æ®å¤„ç†")
    root.geometry("1200x800")
    screen = Oxygen_Desorption_Screen(root)
    screen.pack(expand=True, fill="both")
    root.mainloop()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\distillation_calculator.py çš„å†…å®¹:
================================================================================
# distillation_calculator.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import pandas as pd
import numpy as np
import sympy


class Distillation_Calculator:
    """
    ç²¾é¦å¡”è®¡ç®—å™¨ç±»ï¼Œç”¨äºè®¡ç®—ç²¾é¦å¡”ç†è®ºæ¿æ•°åŠç›¸å…³å‚æ•°

    ä¸»è¦åŠŸèƒ½ï¼š
    - è¯»å–å®éªŒæ•°æ®æ–‡ä»¶ï¼ˆCSVæ ¼å¼ï¼‰
    - è®¡ç®—è¿›æ–™çƒ­çŠ¶æ€å‚æ•°
    - æ±‚è§£ç‰©æ–™å¹³è¡¡æ–¹ç¨‹
    - è®¡ç®—æ°”æ¶²ç›¸å¹³è¡¡å…³ç³»
    - ç»˜åˆ¶æ“ä½œçº¿å¹¶è®¡ç®—ç†è®ºå¡”æ¿æ•°
    """

    def __init__(self, file_path, R, Î±m, F, tS, tF):
        """
        åˆå§‹åŒ–ç²¾é¦è®¡ç®—å™¨

        å‚æ•°:
        ----------
        file_path : str
            åŒ…å«å®éªŒæ•°æ®çš„CSVæ–‡ä»¶è·¯å¾„
        R : float
            å›æµæ¯”(Reflux Ratio)
        Î±m : float
            å¹³å‡ç›¸å¯¹æŒ¥å‘åº¦
        F : float
            è¿›æ–™æµé‡(mol/h)
        tS : float
            æ³¡ç‚¹æ¸©åº¦(Â°C)
        tF : float
            è¿›æ–™æ¸©åº¦(Â°C)

        å¤„ç†æµç¨‹:
        1. è¯»å–å®éªŒæ•°æ®
        2. è®¾ç½®ç‰©æ€§å¸¸æ•°
        3. è®¡ç®—è¿›æ–™å‚æ•°
        4. è®¡ç®—å„ç»„åˆ†ç»„æˆ
        5. æ±‚è§£ç‰©æ–™å¹³è¡¡
        6. è®¡ç®—ç†è®ºå¡”æ¿æ•°
        """

        # æ–‡ä»¶è·¯å¾„
        self.file_path = file_path

        # ä»CSVè¯»å–å®éªŒæ•°æ®ï¼ˆå¤„ç†BOMå¤´ï¼‰
        self.df = pd.read_csv(file_path, header=0, encoding="utf-8-sig")

        # åˆå§‹åŒ–è¾“å…¥å‚æ•°
        self.R = R
        self.Î±m = Î±m
        self.F = F
        self.tS = tS
        self.tF = tF

        # åˆå§‹åŒ–ç»“æœå­—å…¸
        self.results = {}  # æ·»åŠ è¿™ä¸€è¡Œ

        # æ‰§è¡Œè®¡ç®—æµç¨‹
        self.set_constants()
        self.calculate_feed_parameters()
        self.calculate_compositions()
        self.solve_material_balance()
        self.calculate_stages()

        # å°†å…³é”®ç»“æœå­˜å‚¨åˆ° results å­—å…¸ä¸­
        self.results = {
            "å›æµæ¯”": self.R,
            "è¿›æ–™çƒ­çŠ¶æ€å‚æ•°": self.q,
            "é¦å‡ºæ¶²ç»„æˆ": self.xD,
            "é‡œæ®‹æ¶²ç»„æˆ": self.xW,
            "é¦å‡ºæ¶²æµé‡": self.D,
            "é‡œæ®‹æ¶²æµé‡": self.W,
            "ç†è®ºå¡”æ¿æ•°": self.NT,
            "å„ç†è®ºæ¿ç»„æˆ": list(zip(self.xn, self.yn)),
            "Qç‚¹åæ ‡": (self.xQ, self.yQ),
        }

    def set_constants(self):
        """è®¾ç½®ä¹™é†‡-æ°´ä½“ç³»çš„ç‰©æ€§å¸¸æ•°"""
        # å¯†åº¦ (g/mL)
        self.ÏA, self.ÏB = 0.789, 1.0  # ä¹™é†‡, æ°´

        # æ¯”çƒ­å®¹ (J/(gÂ·Â°C))
        self.cA, self.cB = 2.4e3, 4.189e3  # ä¹™é†‡, æ°´

        # æ‘©å°”æ±½åŒ–çƒ­ (kJ/kg)
        self.rA, self.rB = 850, 2260  # ä¹™é†‡, æ°´

        # æ‘©å°”è´¨é‡ (g/mol)
        self.MA, self.MB = 46, 18  # ä¹™é†‡, æ°´

        # è¿›æ–™æ‘©å°”åˆ†æ•° (å‡è®¾å€¼)
        self.xA, self.xB = 0.1, 0.9  # ä¹™é†‡, æ°´

    def calculate_feed_parameters(self):
        """è®¡ç®—è¿›æ–™çƒ­çŠ¶æ€å‚æ•°q"""
        # è®¡ç®—å¹³å‡æ¯”çƒ­å®¹ (J/(molÂ·Â°C))
        self.cpm = self.xA * self.cA * self.MA + self.xB * self.cB * self.MB

        # è®¡ç®—å¹³å‡æ±½åŒ–çƒ­ (J/mol)
        self.rm = self.xA * self.rA * self.MA + self.xB * self.rB * self.MB

        # è®¡ç®—qå€¼(è¿›æ–™çƒ­çŠ¶æ€å‚æ•°)
        if self.tS:  # å¦‚æœæœ‰æ³¡ç‚¹æ¸©åº¦æ•°æ®
            self.q = (self.cpm * (self.tS - self.tF) + self.rm) / self.rm
        else:  # ç¼ºçœå€¼å¤„ç†
            self.q = 1.5  # å‡è®¾ä¸ºè¿‡çƒ­è’¸æ°”è¿›æ–™

    def calculate_x_ethanol(self, s):
        """
        å°†ä½“ç§¯åˆ†æ•°è½¬æ¢ä¸ºæ‘©å°”åˆ†æ•°

        å‚æ•°:
        s : float
            ä¹™é†‡ä½“ç§¯åˆ†æ•°(%)

        è¿”å›:
        float
            ä¹™é†‡æ‘©å°”åˆ†æ•°
        """
        # å°†ä½“ç§¯ç™¾åˆ†æ¯”è½¬æ¢ä¸ºå°æ•°
        s /= 100

        # è®¡ç®—å„ç»„åˆ†çš„æ‘©å°”æ•°
        moles_A = s * self.ÏA / self.MA  # ä¹™é†‡æ‘©å°”æ•°
        moles_B = (1 - s) * self.ÏB / self.MB  # æ°´æ‘©å°”æ•°

        # è®¡ç®—æ‘©å°”åˆ†æ•°
        return moles_A / (moles_A + moles_B)

    def calculate_compositions(self):
        """ä»å®éªŒæ•°æ®è®¡ç®—å„å…³é”®ç»„åˆ†ç»„æˆ"""
        # å…¨å›æµæ¡ä»¶(R=âˆ)ä¸‹çš„ç»„æˆ
        self.xD_inf = self.calculate_x_ethanol(self.df.loc[0, "20Â°Cé…’ç²¾åº¦(æŸ¥è¡¨)/Â°"])
        self.xW_inf = self.calculate_x_ethanol(self.df.loc[1, "20Â°Cé…’ç²¾åº¦(æŸ¥è¡¨)/Â°"])

        # æ­£å¸¸å›æµæ¡ä»¶(R=4)ä¸‹çš„ç»„æˆ
        self.xD = self.calculate_x_ethanol(self.df.loc[2, "20Â°Cé…’ç²¾åº¦(æŸ¥è¡¨)/Â°"])
        self.xW = self.calculate_x_ethanol(self.df.loc[3, "20Â°Cé…’ç²¾åº¦(æŸ¥è¡¨)/Â°"])

        # è¿›æ–™æ¶²ç»„æˆ
        self.xF = self.calculate_x_ethanol(self.df.loc[4, "20Â°Cé…’ç²¾åº¦(æŸ¥è¡¨)/Â°"])

    def solve_material_balance(self):
        """æ±‚è§£å…¨å¡”ç‰©æ–™å¹³è¡¡æ–¹ç¨‹"""
        if self.R >= 10000:  # å…¨å›æµæƒ…å†µå¤„ç†
            self.D = 0.0  # é¦å‡ºæ¶²é‡ä¸º0
            self.W = self.F  # é‡œæ®‹æ¶²é‡ç­‰äºè¿›æ–™é‡
            self.L = self.R * self.D  # å®é™…æ­¤æ—¶Lè¶‹è¿‘æ— ç©·å¤§
        else:  # æ­£å¸¸æƒ…å†µæ±‚è§£
            # å»ºç«‹çŸ©é˜µæ–¹ç¨‹ï¼š
            # [1    1  ] [D]   [F]
            # [xD  xW  ] [W] = [F * xF]
            A = sympy.Matrix([[1, 1], [self.xD, self.xW]])
            b = sympy.Matrix([self.F, self.xF * self.F])

            # è§£çº¿æ€§æ–¹ç¨‹ç»„
            solution = A.solve(b)
            self.D, self.W = solution[0], solution[1]

            # è®¡ç®—å›æµæ¶²é‡
            self.L = self.R * self.D

    def y_e(self, x):
        """
        æ°”æ¶²å¹³è¡¡æ–¹ç¨‹(yä¸xçš„å…³ç³»)

        å‚æ•°:
        x : float
            æ¶²ç›¸ä¸­ä¹™é†‡çš„æ‘©å°”åˆ†æ•°

        è¿”å›:
        float
            æ°”ç›¸ä¸­ä¹™é†‡çš„æ‘©å°”åˆ†æ•°
        """
        return self.Î±m * x / (1 + (self.Î±m - 1) * x)

    def x_e(self, y):
        """
        åå¹³è¡¡æ–¹ç¨‹(xä¸yçš„å…³ç³»)

        å‚æ•°:
        y : float
            æ°”ç›¸ä¸­ä¹™é†‡çš„æ‘©å°”åˆ†æ•°

        è¿”å›:
        float
            æ¶²ç›¸ä¸­ä¹™é†‡çš„æ‘©å°”åˆ†æ•°
        """
        return y / (self.Î±m - (self.Î±m - 1) * y)

    def y_np1(self, x):
        """
        ç²¾é¦æ®µæ“ä½œçº¿æ–¹ç¨‹

        å‚æ•°:
        x : float
            ç¬¬nå—æ¿æ¶²ç›¸ç»„æˆ

        è¿”å›:
        float
            ç¬¬n+1å—æ¿æ°”ç›¸ç»„æˆ
        """
        return (self.R / (self.R + 1)) * x + self.xD / (self.R + 1)

    def y_mp1(self, x):
        """
        æé¦æ®µæ“ä½œçº¿æ–¹ç¨‹

        å‚æ•°:
        x : float
            ç¬¬må—æ¿æ¶²ç›¸ç»„æˆ

        è¿”å›:
        float
            ç¬¬m+1å—æ¿æ°”ç›¸ç»„æˆ
        """
        numerator = self.L + self.q * self.F
        denominator = numerator - self.W
        return (numerator / denominator) * x - (self.W * self.xW) / denominator

    def y_q(self, x):
        """
        qçº¿æ–¹ç¨‹(è¿›æ–™æ–¹ç¨‹)

        å‚æ•°:
        x : float
            æ¶²ç›¸ç»„æˆ

        è¿”å›:
        float
            å¯¹åº”çš„æ°”ç›¸ç»„æˆ
        """
        if self.q == 1:  # æ³¡ç‚¹è¿›æ–™
            return x
        else:
            return (self.q / (self.q - 1)) * x - (self.xF / (self.q - 1))

    def calculate_stages(self):
        """é€šè¿‡é€æ¿è®¡ç®—æ³•ç¡®å®šç†è®ºå¡”æ¿æ•°"""
        # æ ¹æ®å›æµæ¯”é€‰æ‹©è®¡ç®—æ¨¡å¼
        if self.R >= 10000:  # å…¨å›æµæ¨¡å¼
            xD = self.xD_inf
            xW = self.xW_inf
        else:  # æ­£å¸¸æ“ä½œæ¨¡å¼
            xD = self.xD
            xW = self.xW

        # è®¡ç®—ä¸¤æ“ä½œçº¿äº¤ç‚¹Qçš„åæ ‡
        self.xQ = ((self.R + 1) * self.xF + (self.q - 1) * xD) / (self.R + self.q)
        self.yQ = (self.R * self.xF + self.q * xD) / (self.R + self.q)

        # åˆå§‹åŒ–è¿­ä»£å˜é‡
        yn = np.array([xD])  # ä»å¡”é¡¶å¼€å§‹è®¡ç®—
        xn = np.array([])  # å­˜å‚¨å„æ¿æ¶²ç›¸ç»„æˆ
        max_iterations = 20  # é˜²æ­¢æ— é™å¾ªç¯
        iteration = 0

        # é€æ¿è®¡ç®—å¾ªç¯
        while self.x_e(yn[-1]) > xW and iteration < max_iterations:
            iteration += 1

            # è®¡ç®—å½“å‰æ¿çš„æ¶²ç›¸ç»„æˆ
            xn = np.append(xn, self.x_e(yn[-1]))

            # åˆ¤æ–­ä½¿ç”¨å“ªæ¡æ“ä½œçº¿
            if xn[-1] > self.xQ:  # åœ¨ç²¾é¦æ®µ
                new_y = self.y_np1(xn[-1])
            else:  # è¿›å…¥æé¦æ®µ
                new_y = self.y_mp1(xn[-1])

            yn = np.append(yn, new_y)

        # è®°å½•æœ€ç»ˆæ¶²ç›¸ç»„æˆ
        xn = np.append(xn, self.x_e(yn[-1]))

        # è®¡ç®—ç»“æœæ•´ç†
        self.NT = len(xn)  # æ€»ç†è®ºæ¿æ•°(åŒ…æ‹¬å†æ²¸å™¨)
        self.xn, self.yn = xn, yn  # ä¿å­˜å„æ¿ç»„æˆ

    def save_results(self, filename):
        """å°†å…³é”®ç»“æœä¿å­˜è‡³æ–‡æœ¬æ–‡ä»¶"""
        results = []
        results.append("--- Qç‚¹åæ ‡ ---")
        results.append(f"xQ: {self.xQ:.4f}")
        results.append(f"yQ: {self.yQ:.4f}")

        results.append("\n--- å„ç†è®ºæ¿ç»„æˆ ---")
        for i, (x, y) in enumerate(zip(self.xn, self.yn)):
            results.append(f"ç¬¬{i}å—æ¿: xn = {x:.4f}, yn = {y:.4f}")

        results.append(f"\næ€»ç†è®ºæ¿æ•°(åŒ…æ‹¬å†æ²¸å™¨): {self.NT}")

        # ç¡®ä¿ç›®å½•å­˜åœ¨
        os.makedirs(os.path.dirname(filename), exist_ok=True)

        with open(filename, "w", encoding="utf-8") as f:  # ç›´æ¥ä½¿ç”¨å®Œæ•´è·¯å¾„
            f.write("\n".join(results))


def process_and_save(file_path, R, Î±m, F, tS, tF, filename):
    """å¤„ç†å¹¶ä¿å­˜ç»“æœçš„è¾…åŠ©å‡½æ•°"""
    try:
        # åˆ›å»ºè®¡ç®—å™¨å®ä¾‹
        calculator = Distillation_Calculator(file_path=file_path, R=R, Î±m=Î±m, F=F, tS=tS, tF=tF)

        # æ‰“å°å…³é”®ç»“æœ
        print("\nç²¾é¦å¡”è®¡ç®—ç»“æœ:")
        print(f"å›æµæ¯” R: {R}")
        print(f"è¿›æ–™çƒ­çŠ¶æ€å‚æ•° q: {calculator.q:.3f}")
        print(f"é¦å‡ºæ¶²ç»„æˆ xD: {calculator.xD:.4f}")
        print(f"é‡œæ®‹æ¶²ç»„æˆ xW: {calculator.xW:.4f}")
        print(f"é¦å‡ºæ¶²æµé‡ D: {calculator.D:.2f} mol/h")
        print(f"é‡œæ®‹æ¶²æµé‡ W: {calculator.W:.2f} mol/h")
        print(f"ç†è®ºå¡”æ¿æ•° NT: {calculator.NT}")

        # ä¿å­˜è¯¦ç»†ç»“æœ
        results_dir = "./è®¡ç®—ç»“æœ"
        os.makedirs(results_dir, exist_ok=True)
        results_path = f"{results_dir}/{filename}.txt"
        calculator.save_results(results_path)
        print(f"è¯¦ç»†ç»“æœå·²ä¿å­˜è‡³: {results_path}")

        return calculator

    except Exception as e:
        print(f"è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {str(e)}")
        return None


if __name__ == "__main__":
    # è®¾ç½®æ–‡ä»¶è·¯å¾„ - ç›¸å¯¹è·¯å¾„
    file_path = "./csv_data/ç²¾é¦/ç²¾é¦åŸå§‹è®°å½•è¡¨(é)/Sheet1.csv"

    # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
    os.makedirs("./è®¡ç®—ç»“æœ", exist_ok=True)

    print("=" * 50)
    print("å¼€å§‹ç²¾é¦å¡”è®¡ç®— (ä¸¤ç»„ä¸åŒå‚æ•°)")
    print("=" * 50)

    # ç¬¬ä¸€ç»„è®¡ç®—: R = 4 æ—¶
    print("\n>>> è®¡ç®—æ¡ä»¶: R = 4 <<<")
    calc1 = process_and_save(file_path=file_path, R=4, Î±m=2.0, F=80, tS=30, tF=26, filename="R_4_ç»“æœ")

    # ç¬¬äºŒç»„è®¡ç®—: R --> âˆæ—¶
    print("\n>>> è®¡ç®—æ¡ä»¶: R --> âˆ <<<")
    calc2 = process_and_save(file_path=file_path, R=10000, Î±m=2.0, F=80, tS=30, tF=26, filename="R_+âˆ_ç»“æœ")

    print("\nè®¡ç®—å®Œæˆï¼Œä¸¤ç»„ç»“æœå·²åˆ†åˆ«ä¿å­˜è‡³è®¡ç®—ç»“æœç›®å½•")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\drying_calculator.py çš„å†…å®¹:
================================================================================
# drying_calculator.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import pandas as pd
import numpy as np


class Drying_Calculator:
    def __init__(self, csv_file_paths):
        """åˆå§‹åŒ–è®¡ç®—å™¨ï¼Œç›´æ¥ä¼ å…¥CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨"""
        self.csv_file_paths = csv_file_paths
        self.results = {}  # å­˜å‚¨è®¡ç®—ç»“æœçš„å­—å…¸

        # æ ¸å¿ƒè®¡ç®—å‚æ•°ï¼ˆé€šè¿‡load_data()åˆå§‹åŒ–ï¼‰
        self.m_1 = None  # æ¯›æ¯¡æ¶¦æ¹¿å‰è´¨é‡ (kg)
        self.m_2 = None  # æ¯›æ¯¡æ¶¦æ¹¿åè´¨é‡ (kg)
        self.W2 = None  # æ‰˜æ¶è´¨é‡ (kg)
        self.G_prime = None  # ç»å¹²è´¨é‡ (kg)
        self.Î”P = None  # å‹å·® (Pa)
        self.Ï„ = None  # æ—¶é—´åºåˆ—ï¼ˆå°æ—¶ï¼‰
        self.W1 = None  # æ€»è´¨é‡åºåˆ— (kg)
        self.t = None  # å¹²çƒæ¸©åº¦åºåˆ— (â„ƒ)
        self.tw = None  # æ¹¿çƒæ¸©åº¦åºåˆ— (â„ƒ)

        # ä¸­é—´è®¡ç®—ç»“æœï¼ˆé€šè¿‡preprocess_data()ç”Ÿæˆï¼‰
        self.G = None  # æ¹¿ç‰©æ–™æ€»è´¨é‡ (kg)
        self.X = None  # å¹²åŸºå«æ°´é‡ (kg/kg)
        self.Ï„_bar = None  # å¹³å‡æ—¶é—´ç‚¹ (å°æ—¶)
        self.X_bar = None  # å¹³å‡å¹²åŸºå«æ°´é‡ (kg/kg)
        self.U = None  # å¹²ç‡¥é€Ÿç‡ (kg/mÂ²Â·h)
        self.U_c = None  # æ’å®šå¹²ç‡¥é€Ÿç‡ (kg/mÂ²Â·h)

        # é«˜çº§è®¡ç®—ç»“æœï¼ˆé€šè¿‡further_calculations()ç”Ÿæˆï¼‰
        self.Î± = None  # ä¼ çƒ­ç³»æ•° (kW/mÂ²Â·K)
        self.V_t0 = None  # åˆå§‹ä½“ç§¯æµé‡ (mÂ³/s)
        self.V_t = None  # æ¸©åº¦ä¿®æ­£åçš„ä½“ç§¯æµé‡ (mÂ³/s)

        # å¸¸æ•°å®šä¹‰
        self.r_tw = 2490  # æ°´çš„æ±½åŒ–æ½œçƒ­ (kJ/kg)
        self.S = 2.64e-2  # å¹²ç‡¥é¢ç§¯ (mÂ²)

    def load_data(self):
        """ä»æ–‡ä»¶è·¯å¾„åˆ—è¡¨åŠ è½½CSVæ•°æ®"""
        # æ ¹æ®æ–‡ä»¶åè¯†åˆ«æ•°æ®æ–‡ä»¶
        data1_path, data2_path = None, None
        for path in self.csv_file_paths:
            filename = os.path.basename(path).lower()  # ç»Ÿä¸€å°å†™æ¯”è¾ƒ
            if "åŸå§‹æ•°æ®1" in filename:
                data1_path = path
            elif "åŸå§‹æ•°æ®2" in filename:
                data2_path = path

        if not all([data1_path, data2_path]):
            raise ValueError("æœªæ‰¾åˆ°åŸå§‹æ•°æ®1å’ŒåŸå§‹æ•°æ®2æ–‡ä»¶")

        # è¯»å–åŸå§‹æ•°æ®1.csv
        df1 = pd.read_csv(data1_path, header=None, skiprows=0)
        data1 = df1.iloc[:, 1].values.astype(float)

        # æå–é™æ€å‚æ•°
        self.m_1 = data1[0] * 1e-3  # è½¬æ¢ä¸ºkg
        self.m_2 = data1[1] * 1e-3
        self.W2 = data1[2] * 1e-3
        self.G_prime = data1[3] * 1e-3
        self.Î”P = data1[4]

        # è¯»å–åŸå§‹æ•°æ®2.csv
        df2 = pd.read_csv(data2_path, header=0, skiprows=[1])

        # æå–æ—¶é—´åºåˆ—æ•°æ®
        self.Ï„ = df2["ç´¯è®¡æ—¶é—´Ï„/min"].values.astype(float) / 60  # è½¬æ¢ä¸ºå°æ—¶
        self.W1 = df2["æ€»è´¨é‡W1/g"].values.astype(float) * 1e-3  # è½¬æ¢ä¸ºkg
        self.t = df2["å¹²çƒæ¸©åº¦t_dry/â„ƒ"].values.astype(float)
        self.tw = df2["æ¹¿çƒæ¸©åº¦t_wet/â„ƒ"].values.astype(float)

    def preprocess_data(self):
        """æ‰§è¡Œæ ¸å¿ƒé¢„å¤„ç†è®¡ç®—"""
        # è®¡ç®—ä¸­é—´æ—¶é—´ç‚¹
        self.Ï„_bar = (self.Ï„[:-1] + self.Ï„[1:]) / 2

        # è®¡ç®—æ¹¿ç‰©æ–™æ€»è´¨é‡å’Œå¹²åŸºå«æ°´é‡
        self.G = self.W1 - self.W2
        self.X = (self.G - self.G_prime) / self.G_prime

        # è®¡ç®—å¹³å‡å«æ°´é‡å’Œå¹²ç‡¥é€Ÿç‡
        self.X_bar = (self.X[:-1] + self.X[1:]) / 2
        self.U = -(self.G_prime / self.S) * (np.diff(self.X) / np.diff(self.Ï„))
        self.U_c = np.mean(self.U[15:])  # å–å15ä¸ªç‚¹çš„å¹³å‡å€¼ä½œä¸ºæ’å®šé€Ÿç‡

        # å­˜å‚¨ä¸­é—´ç»“æœ
        self.results.update(
            {
                "ans1": np.array([self.G * 1000, self.X]).T.tolist(),
                "ans2": np.array([self.X_bar, self.U]).T.tolist(),
                "Ï„_bar": self.Ï„_bar.tolist(),
                "X_bar": self.X_bar.tolist(),
                "U": self.U.tolist(),
                "U_c": float(self.U_c),
            }
        )

    def further_calculations(self):
        """æ‰§è¡Œé«˜çº§è®¡ç®—"""
        # è®¡ç®—ä¼ çƒ­ç³»æ•°
        self.Î± = (self.U_c * self.r_tw) / (self.t - self.tw)

        # æµé‡è®¡ç®—å‚æ•°
        C_0 = 0.65  # æµé‡ç³»æ•°
        A_0 = (np.pi * 0.040**2) / 4  # æµé€šé¢ç§¯ (mÂ²)
        Ï_air = 1.29  # ç©ºæ°”å¯†åº¦ (kg/mÂ³)
        t0 = 25  # åˆå§‹æ¸©åº¦ (â„ƒ)

        # ä½“ç§¯æµé‡è®¡ç®—
        self.V_t0 = C_0 * A_0 * np.sqrt(2 * self.Î”P / Ï_air)
        self.V_t = self.V_t0 * (273 + self.t) / (273 + t0)

        # å­˜å‚¨é«˜çº§ç»“æœ
        self.results.update({"Î±": self.Î±.tolist(), "V_t0": float(self.V_t0), "V_t": self.V_t.tolist()})

    def run_full_calculation(self):
        """æ‰§è¡Œå®Œæ•´è®¡ç®—æµç¨‹"""
        self.load_data()
        self.preprocess_data()
        self.further_calculations()


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆå§‹åŒ–è®¡ç®—å™¨æ—¶ç›´æ¥ä¼ å…¥æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    csv_files = [
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®1.csv",
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®2.csv",
    ]

    calculator = Drying_Calculator(csv_files)
    calculator.run_full_calculation()

    # å°è¯•è®¿é—®æŸäº›è®¡ç®—ç»“æœ
    print("æ’å®šå¹²ç‡¥é€Ÿç‡ U_c:", calculator.U_c)
    print("ä¼ çƒ­ç³»æ•° Î±:", calculator.Î±)
    print("åˆå§‹ä½“ç§¯æµé‡ V_t0:", calculator.V_t0)

    # è·å–å®Œæ•´è®¡ç®—ç»“æœå­—å…¸
    full_results = calculator.results
    # print(full_results)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\extraction_calculator.py çš„å†…å®¹:
================================================================================
# extraction_calculator.py

import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import logging
import pandas as pd
import numpy as np
from scipy.integrate import trapezoid
from scipy.interpolate import interp1d

# é…ç½®æ—¥å¿—è®¾ç½®
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")


class Extraction_Calculator:
    def __init__(self, main_file, distribution_file):
        self.main_file = main_file  # ä¸»æ•°æ®CSVæ–‡ä»¶è·¯å¾„
        self.distribution_file = distribution_file  # åˆ†é…æ›²çº¿æ•°æ®CSVæ–‡ä»¶è·¯å¾„
        self.results = {}  # å­˜å‚¨å¤„ç†ç»“æœ

    def load_data(self):
        """
        åŠ è½½ä¸»æ•°æ®CSVæ–‡ä»¶ï¼Œå¹¶è¿›è¡Œåˆæ­¥å¤„ç†ã€‚
        """
        # è¯»å–ä¸»æ•°æ®CSVæ–‡ä»¶
        df1 = pd.read_csv(self.main_file, header=None)
        self.data1 = df1.iloc[1:, 1:].values.astype(float)  # æå–æ•°æ®éƒ¨åˆ†å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°

        # æå–å„åˆ—æ•°æ®
        self.n = self.data1[0]  # å®éªŒç¼–å·
        self.Vs_S = self.data1[1]  # æº¶å‰‚æµé‡ (L/h)
        self.Vs_B = self.data1[2]  # èƒå–å‰‚æµé‡ (L/h)
        self.t = self.data1[3]  # æ—¶é—´
        self.c_NaOH = 0.01  # NaOHæµ“åº¦
        self.V_to_be_titrated = self.data1[[4, 6, 8], :]  # å¾…æ»´å®šä½“ç§¯
        self.V_NaOH_used = self.data1[[5, 7, 9], :]  # NaOHä½¿ç”¨ä½“ç§¯

        # åˆ†å­é‡å’Œå¯†åº¦
        self.M_A, self.M_B, self.M_S = 78, 122, 18  # åˆ†å­é‡ (kg/kmol)
        self.Ï_A, self.Ï_B, self.Ï_S = 876.7, 800, 1000  # å¯†åº¦ (kg/m^3)

    def preprocess_data(self):
        """
        æ•°æ®é¢„å¤„ç†ï¼Œè®¡ç®—ç›¸å…³å‚æ•°ã€‚
        """
        self.Vs_B_rect = self.Vs_S * np.sqrt(self.Ï_S * (7900 - self.Ï_B) / (self.Ï_B * (7900 - self.Ï_S)))

        self.ans1 = (self.c_NaOH * self.V_NaOH_used * 1e-6 * self.M_B) / (self.Ï_B * self.V_to_be_titrated * 1e-6)
        self.X_Rb, self.X_Rt, self.Y_Eb = self.ans1[0], self.ans1[1], self.ans1[2]

        self.B = self.Ï_B * self.Vs_B * 1e-3  # èƒå–å‰‚ä½“ç§¯ (m^3)
        self.S = self.Ï_S * self.Vs_S * 1e-3  # æº¶å‰‚ä½“ç§¯ (m^3)
        self.B_rect = self.Ï_B * self.Vs_B_rect * 1e-3  # æ ¡æ­£åçš„èƒå–å‰‚ä½“ç§¯ (m^3)

        self.ans2 = np.array([self.B, self.S, self.B_rect])
        self.results.update(
            {
                "ans1": self.ans1.tolist(),
                "ans2": self.ans2.tolist(),
                "X_Rb": self.X_Rb.tolist(),
                "X_Rt": self.X_Rt.tolist(),
                "Y_Eb": self.Y_Eb.tolist(),
            }
        )

    def load_distribution_curve_data(self):
        """
        åŠ è½½åˆ†é…æ›²çº¿æ•°æ®CSVæ–‡ä»¶ã€‚
        """
        df3 = pd.read_csv(self.distribution_file, header=None)
        data3 = df3.iloc[2:, :].values  # è·³è¿‡å‰ä¸¤è¡Œ
        self.X3_data = data3[:, 0].astype(float)
        self.Y3_data = data3[:, 1].astype(float)

    def fit_distribution_curve(self):
        """
        æ‹Ÿåˆåˆ†é…æ›²çº¿ã€‚
        """
        order = 3  # å¤šé¡¹å¼é˜¶æ•°
        self.coefficients = np.polyfit(self.X3_data, self.Y3_data, order)
        self.X3_to_fit = np.linspace(min(self.X3_data), max(self.X3_data), 100)
        self.Y_fitted = np.polyval(self.coefficients, self.X3_to_fit)

        self.results.update(
            {
                "X3_data": self.X3_data.tolist(),
                "Y3_data": self.Y3_data.tolist(),
                "coefficients": self.coefficients.tolist(),
                "X3_to_fit": self.X3_to_fit.tolist(),
                "Y_fitted": self.Y_fitted.tolist(),
            }
        )

    def calculate_operating_lines(self):
        """
        è®¡ç®—æ“ä½œçº¿æ–¹ç¨‹ã€‚
        """
        self.k1 = (0 - self.Y_Eb[0]) / (self.X_Rt[0] - self.X_Rb[0])
        self.b1 = self.Y_Eb[0] - self.k1 * self.X_Rb[0]

        self.k2 = (0 - self.Y_Eb[1]) / (self.X_Rt[1] - self.X_Rb[1])
        self.b2 = self.Y_Eb[1] - self.k2 * self.X_Rb[1]

        self.results.update(
            {
                "k1": float(self.k1),
                "b1": float(self.b1),
                "k2": float(self.k2),
                "b2": float(self.b2),
            }
        )

    def perform_graphical_integration(self):
        """
        æ‰§è¡Œå›¾è§£ç§¯åˆ†ã€‚
        """
        self.integral_values = []  # ç”¨äºå­˜å‚¨æ¯ä¸ªå®éªŒç»„çš„ç§¯åˆ†ç»“æœ
        self.data5_for_graph_integral = []  # ç”¨äºå­˜å‚¨æ¯ç»„ç»˜å›¾æ•°æ®

        k = np.array([self.k1, self.k2])
        b = np.array([self.b1, self.b2])

        for i in range(len(self.Y_Eb)):
            Y5_Eb_data = np.linspace(0, self.Y_Eb[i], 20)
            X_Rb_data = (Y5_Eb_data - b[i]) / k[i]
            Y5star_data = np.polyval(self.coefficients, X_Rb_data)
            one_over_Y5star_minus_Y5 = 1 / (Y5star_data - Y5_Eb_data)

            # å°†å½“å‰å®éªŒç»„çš„æ•°æ®å­˜å…¥åˆ—è¡¨
            self.data5_for_graph_integral.append([Y5_Eb_data, X_Rb_data, Y5star_data, one_over_Y5star_minus_Y5])

            # æ’å€¼å¹³æ»‘æ›²çº¿
            interp_func = interp1d(Y5_Eb_data, one_over_Y5star_minus_Y5, kind="cubic")
            Y5_Eb_data_smooth = np.linspace(Y5_Eb_data.min(), Y5_Eb_data.max(), 40)
            one_over_Y5star_minus_Y5_smooth = interp_func(Y5_Eb_data_smooth)

            # è®¡ç®—ç§¯åˆ†å¹¶ä¿å­˜
            integral_value = trapezoid(one_over_Y5star_minus_Y5_smooth, Y5_Eb_data_smooth)
            self.integral_values.append(integral_value)

        # ä¿å­˜ç§¯åˆ†ç»“æœåˆ°ans3
        self.ans3 = np.array(self.integral_values)
        self.results["ans3"] = self.ans3.tolist()

    def print_results(self):
        """
        æ‰“å°è®¡ç®—ç»“æœã€‚
        """
        print("\n========== èƒå–è®¡ç®—ç»“æœ ==========")
        print(f"\n1. æµ“åº¦è®¡ç®—ç»“æœ (ans1):")
        print(f"X_Rb (èƒä½™ç›¸è‹¯ç”²é…¸æµ“åº¦): {self.X_Rb}")
        print(f"X_Rt (èƒä½™ç›¸è‹¯ç”²é…¸æµ“åº¦): {self.X_Rt}")
        print(f"Y_Eb (èƒå–ç›¸è‹¯ç”²é…¸æµ“åº¦): {self.Y_Eb}")

        print(f"\n2. ä½“ç§¯è®¡ç®—ç»“æœ (ans2):")
        print(f"èƒå–å‰‚ä½“ç§¯ B (mÂ³): {self.B}")
        print(f"æº¶å‰‚ä½“ç§¯ S (mÂ³): {self.S}")
        print(f"æ ¡æ­£åçš„èƒå–å‰‚ä½“ç§¯ B_rect (mÂ³): {self.B_rect}")

        print(f"\n3. åˆ†é…æ›²çº¿æ‹Ÿåˆç³»æ•°:")
        print(f"å¤šé¡¹å¼ç³»æ•°: {self.coefficients}")

        print(f"\n4. æ“ä½œçº¿å‚æ•°:")
        print(f"æ“ä½œçº¿1 - æ–œç‡ k1: {self.k1:.4f}, æˆªè· b1: {self.b1:.4f}")
        print(f"æ“ä½œçº¿2 - æ–œç‡ k2: {self.k2:.4f}, æˆªè· b2: {self.b2:.4f}")

        print(f"\n5. å›¾è§£ç§¯åˆ†ç»“æœ (ans3)å·²è®¡ç®—å®Œæˆ")
        print("\n=================================")

    def run_calculations(self):
        """
        è¿è¡Œå®Œæ•´è®¡ç®—æµç¨‹ã€‚
        """
        self.load_data()
        self.preprocess_data()
        self.load_distribution_curve_data()
        self.fit_distribution_curve()
        self.calculate_operating_lines()
        self.perform_graphical_integration()
        self.print_results()


if __name__ == "__main__":
    main_csv = "./1_åŸå§‹æ•°æ®è®°å½•.csv"
    distribution_csv = "./3_åˆ†é…æ›²çº¿æ•°æ®é›†.csv"

    print("å¼€å§‹èƒå–è®¡ç®—...")
    calculator = Extraction_Calculator(main_csv, distribution_csv)
    calculator.run_calculations()

    # è·å–ç»“æœç¤ºä¾‹
    results = calculator.results
    ans1 = calculator.ans1
    ans2 = calculator.ans2
    ans3 = calculator.ans3


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\filteration_calculator.py çš„å†…å®¹:
================================================================================
import sys
import os
import numpy as np
import pandas as pd
from sklearn.linear_model import LinearRegression


class Filteration_Calculator:
    """
    è´Ÿè´£è¿‡æ»¤å®éªŒæ•°æ®çš„è®¡ç®—éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ‹Ÿåˆã€å¼‚å¸¸å€¼æ£€æµ‹ç­‰
    """

    def __init__(self, csv_file_path):
        """
        åˆå§‹åŒ–ç±»ï¼Œæ¥æ”¶CSVæ–‡ä»¶è·¯å¾„ï¼Œå¹¶åŠ è½½æ•°æ®
        :param csv_file_path: CSVæ–‡ä»¶è·¯å¾„
        """
        self.csv_file_path = csv_file_path
        self.data = self.load_csv_data(self.csv_file_path)  # è‡ªåŠ¨åŠ è½½æ•°æ®

        # åˆå§‹åŒ–ç”¨äºå­˜å‚¨å¤„ç†åçš„æ•°æ®çš„åˆ—è¡¨
        self.q_to_refit_lists = []
        self.delta_theta_over_delta_q_to_refit_lists = []
        self.refit_slopes = []
        self.refit_intercepts = []

        # å­˜å‚¨é¢å¤–çš„ä¸­é—´å˜é‡ï¼Œç”¨äºè°ƒè¯•/æ£€æŸ¥
        self.selected_data = None
        self.data_array = None
        self.deltaV = 9.446e-4
        self.S = 0.0475
        self.deltaQ = self.deltaV / self.S
        self.delta_theta_list = None
        self.delta_q_list = None
        self.delta_theta_over_delta_q_list = None
        self.q_list = None
        self.q_to_fit = None
        self.delta_theta_over_delta_q_to_fit = None
        self.fit_model = None
        self.fit_data = None
        self.fit_slope = None
        self.fit_intercept = None
        self.outliers = None
        self.refit_model = None
        self.filtered_data = None

    def load_csv_data(self, csv_file_path):
        """
        åŠ è½½CSVæ–‡ä»¶å¹¶è¿›è¡Œæ•°æ®é¢„å¤„ç†
        :param csv_file_path: CSVæ–‡ä»¶è·¯å¾„
        :return: å¤„ç†åçš„æ•°æ®
        """
        data = pd.read_csv(csv_file_path, header=0)
        for col in data.columns:
            data[col] = pd.to_numeric(data[col], errors="coerce")
        data = data.dropna()  # åˆ é™¤ä»»ä½•å«æœ‰NaNå€¼çš„è¡Œ
        return data

    def perform_linear_fit(self, x, y):
        """
        å¯¹æ•°æ®è¿›è¡Œçº¿æ€§æ‹Ÿåˆ
        :param x: è‡ªå˜é‡
        :param y: å› å˜é‡
        :return: æ‹Ÿåˆæ¨¡å‹å’Œæ‹Ÿåˆæ•°æ®
        """
        fit_data = np.column_stack((x, y))
        model = LinearRegression()
        model.fit(fit_data[:, 0].reshape(-1, 1), fit_data[:, 1])
        return model, fit_data

    def detect_outliers(self, fit_data, threshold=2):
        """
        æ£€æµ‹å¼‚å¸¸å€¼
        :param fit_data: æ‹Ÿåˆæ•°æ®
        :param threshold: å¼‚å¸¸å€¼é˜ˆå€¼
        :return: å¼‚å¸¸å€¼ç´¢å¼•
        """
        z_scores = np.abs((fit_data[:, 1] - np.mean(fit_data[:, 1])) / np.std(fit_data[:, 1]))
        outliers = np.where(z_scores > threshold)[0]
        return outliers

    def refit_data_after_outlier_removal(self, fit_data, outliers):
        """
        ç§»é™¤å¼‚å¸¸å€¼åé‡æ–°æ‹Ÿåˆæ•°æ®
        :param fit_data: æ‹Ÿåˆæ•°æ® (should be 2D array)
        :param outliers: å¼‚å¸¸å€¼ç´¢å¼•
        :return: æ–°çš„æ‹Ÿåˆæ¨¡å‹å’Œæ¸…æ´—åçš„æ•°æ®
        """
        if len(outliers) > 0:
            # ç¡®ä¿å¼‚å¸¸å€¼ä¸æ˜¯ç©ºçš„
            filtered_data = np.delete(fit_data, outliers, axis=0)
        else:
            # å¦‚æœæ²¡æœ‰å¼‚å¸¸å€¼ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹æ•°æ®
            filtered_data = fit_data

        if filtered_data.shape[0] == 0:
            raise ValueError("å»é™¤å¼‚å¸¸å€¼åæ•°æ®ä¸ºç©º")

        x = filtered_data[:, 0].reshape(-1, 1)
        y = filtered_data[:, 1]
        model = LinearRegression()
        model.fit(x, y)
        return model, filtered_data

    def process_single_group_data(self, group_index):
        """
        å¤„ç†å•ç»„æ•°æ®
        :param group_index: ç»„ç´¢å¼•
        :return: æ‹Ÿåˆæ‰€éœ€çš„æ•°æ®
        """
        self.selected_data = self.data.iloc[0:11, 1 + 3 * group_index : 4 + 3 * group_index]
        self.data_array = self.selected_data.values
        self.data_array[:, 0] = self.data_array[:, 0] / 100  # è½¬æ¢ä¸ºæ ‡å‡†å•ä½

        self.delta_theta_list = np.diff(self.data_array[:, 1])
        self.delta_q_list = np.full(len(self.delta_theta_list), self.deltaQ)
        self.delta_theta_over_delta_q_list = self.delta_theta_list / self.delta_q_list

        self.q_list = np.linspace(0, len(self.delta_theta_list) * self.deltaQ, len(self.delta_theta_list) + 1)
        self.q_to_fit = (self.q_list[:-1] + self.q_list[1:]) / 2
        self.delta_theta_over_delta_q_to_fit = self.delta_theta_over_delta_q_list

        return (
            self.q_to_fit,
            self.delta_theta_over_delta_q_to_fit,
            self.delta_theta_over_delta_q_list,
            self.q_list,
        )

    def process_all_groups(self):
        """
        å¤„ç†æ‰€æœ‰ç»„æ•°æ®å¹¶ç”Ÿæˆæ‹Ÿåˆæ•°æ®
        :return: è¿”å›æ‹Ÿåˆå›¾çš„qå€¼å’ŒÎ”Î¸/Î”qå€¼
        """
        # é‡ç½®åˆ—è¡¨ä»¥ä¿å­˜æ•°æ®
        self.q_to_refit_lists = []
        self.delta_theta_over_delta_q_to_refit_lists = []
        self.refit_slopes = []
        self.refit_intercepts = []

        for group_index in range(3):
            (
                self.q_to_fit,
                self.delta_theta_over_delta_q_to_fit,
                self.delta_theta_over_delta_q_list,
                self.q_list,
            ) = self.process_single_group_data(group_index)

            self.fit_model, self.fit_data = self.perform_linear_fit(self.q_to_fit, self.delta_theta_over_delta_q_to_fit)
            self.fit_slope = self.fit_model.coef_[0]
            self.fit_intercept = self.fit_model.intercept_

            print(f"ç¬¬{group_index+1}ç»„æ•°æ®åˆæ‹Ÿåˆç»“æœ:")
            print("åˆæ‹Ÿåˆæ–œç‡:", self.fit_slope)
            print("åˆæ‹Ÿåˆæˆªè·:", self.fit_intercept)

            self.outliers = self.detect_outliers(self.fit_data)
            if len(self.outliers) > 0:
                self.refit_model, self.filtered_data = self.refit_data_after_outlier_removal(
                    self.fit_data, self.outliers
                )
                self.refit_slope = self.refit_model.coef_[0]
                self.refit_intercept = self.refit_model.intercept_

                print(f"ç¬¬{group_index+1}ç»„æ•°æ®æ’é™¤å¼‚å¸¸å€¼åé‡æ–°æ‹Ÿåˆç»“æœ:")
                print("æ’é™¤å¼‚å¸¸å€¼åæ–œç‡:", self.refit_slope)
                print("æ’é™¤å¼‚å¸¸å€¼åæˆªè·:", self.refit_intercept)

                self.q_to_refit_lists.append(self.filtered_data[:, 0])
                self.delta_theta_over_delta_q_to_refit_lists.append(self.filtered_data[:, 1])
                self.refit_slopes.append(self.refit_slope)
                self.refit_intercepts.append(self.refit_intercept)

        return (
            self.q_to_refit_lists,
            self.delta_theta_over_delta_q_to_refit_lists,
            self.refit_slopes,
            self.refit_intercepts,
        )


if __name__ == "__main__":
    # åˆå§‹åŒ–Filteration_Calculatorå®ä¾‹ï¼Œä¼ å…¥æ–‡ä»¶è·¯å¾„
    filteration_calculator = Filteration_Calculator(r"./è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨(é).csv")

    # å¤„ç†æ‰€æœ‰ç»„æ•°æ®å¹¶è·å–ç»“æœ
    (
        q_to_refit_lists,
        delta_theta_over_delta_q_to_refit_lists,
        refit_slopes,
        refit_intercepts,
    ) = filteration_calculator.process_all_groups()

    # è¾“å‡ºå¤„ç†åçš„æ•°æ®ä»¥ä¾›éªŒè¯
    print("q_to_refit_lists:", q_to_refit_lists)
    print(
        "delta_theta_over_delta_q_to_refit_lists:",
        delta_theta_over_delta_q_to_refit_lists,
    )
    print("refit_slopes:", refit_slopes)
    print("refit_intercepts:", refit_intercepts)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\fluid_flow_calculator.py çš„å†…å®¹:
================================================================================
# fluid_flow_calculator.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
import os


class Fluid_Flow_Calculator:
    def __init__(self, file_dir):
        self.file_dir = file_dir
        self.ans1 = None
        self.df = None
        self.p = None
        self.log_Re = None
        self.log_Î» = None
        self.valid_idx = None

    def process(self):
        """è¿›è¡Œæµä½“æµåŠ¨åˆ†æï¼ŒåŒ…æ‹¬è®¡ç®—é›·è¯ºæ•°å’Œæ‘©æ“¦ç³»æ•°ï¼Œå¹¶è¿›è¡ŒåŒå¯¹æ•°æ‹Ÿåˆ"""
        # å·²çŸ¥å‚æ•°
        d = 0.008  # ç®¡å¾„(m)
        l = 1.70  # ç®¡é•¿(m)
        Ï = 996.5  # æ°´çš„å¯†åº¦(kg/m^3)
        g = 9.81  # é‡åŠ›åŠ é€Ÿåº¦(m/s^2)
        Î¼ = 8.55e-4  # ç²˜æ€§ç³»æ•°(PaÂ·s)

        # ä»CSVè¯»å–æ•°æ®ï¼ˆè·³è¿‡å‰ä¸¤è¡Œæ ‡é¢˜å’Œå•ä½è¡Œï¼‰
        df = pd.read_csv(self.file_dir, skiprows=2, header=None)

        # å¤„ç†éæ•°å€¼æ•°æ®ï¼ˆå°†éæ•°å€¼è½¬ä¸ºNaNåå¡«å……0ï¼‰
        df[1] = pd.to_numeric(df[1], errors="coerce").fillna(0)  # Qåˆ—
        df[2] = pd.to_numeric(df[2], errors="coerce").fillna(0)  # ç›´ç®¡é˜»åŠ›å‹é™
        df[3] = pd.to_numeric(df[3], errors="coerce").fillna(0)  # mmH2Oåˆ—

        # æå–æ•°æ®
        Q = df.iloc[:, 1].values / 3600 / 1000  # è½¬æ¢L/h â†’ mÂ³/s

        # æ„é€ å‹é™æ•°ç»„ï¼ˆå‰9ä¸ªä¸ºkPaæ•°æ®ï¼Œå10ä¸ªä¸ºmmH2Oæ•°æ®ï¼‰
        Î”Pf = np.concatenate(
            [1000 * df.iloc[:9, 2].values, Ï * g * df.iloc[9:, 3].values / 1000]  # kPa â†’ Pa  # mmH2O â†’ Pa
        )

        # è®¡ç®—æµé€Ÿ(m/s)
        u = Q / (np.pi / 4 * d**2)

        # è®¡ç®—é›·è¯ºæ•°
        Re = (d * u * Ï) / Î¼

        # è®¡ç®—æ‘©æ“¦ç³»æ•°ï¼ˆé¿å…é™¤ä»¥é›¶ï¼‰
        valid_u = np.where(u != 0, u, 1e-10)  # æ›¿æ¢é›¶å€¼ä¸ºæå°å€¼
        Î» = (2 * d) / (Ï * l) * Î”Pf / valid_u**2

        # åŒå¯¹æ•°æ‹Ÿåˆï¼ˆè¿‡æ»¤æ— æ•ˆå€¼ï¼‰
        valid_idx = (Re > 0) & (Î» > 0)
        log_Re = np.log10(Re[valid_idx])
        log_Î» = np.log10(Î»[valid_idx])

        degree = 9
        coefficients = np.polyfit(log_Re, log_Î», degree)
        p = np.poly1d(coefficients)

        # ä¿å­˜ç»“æœåˆ°å®ä¾‹å˜é‡
        self.ans1 = np.column_stack((u, Re, Î»))
        self.df = df
        self.p = p
        self.log_Re = log_Re
        self.log_Î» = log_Î»
        self.valid_idx = valid_idx
        return self.ans1, self.df


class Centrifugal_Pump_Characteristics_Calculator:
    def __init__(self, file_dir):
        self.file_dir = file_dir
        self.ans2 = None
        self.df = None
        self.params_H = None
        self.params_N = None
        self.params_Î· = None

    @staticmethod
    def quadratic(x, a, b, c):
        return a * x**2 + b * x + c

    def process(self):
        """åˆ†æç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿ï¼ŒåŒ…æ‹¬æ‰¬ç¨‹ã€åŠŸç‡å’Œæ•ˆç‡çš„è®¡ç®—ä¸äºŒæ¬¡æ‹Ÿåˆ"""
        # ä»CSVè¯»å–æ•°æ®ï¼ˆè·³è¿‡æ ‡é¢˜è¡Œï¼‰
        df = pd.read_csv(self.file_dir, skiprows=1, header=None)

        # å¤„ç†éæ•°å€¼æ•°æ®
        for col in [1, 2, 3, 4]:
            df[col] = pd.to_numeric(df[col], errors="coerce").fillna(0)

        # æå–æ•°æ®
        Q = df.iloc[:, 1].values  # æµé‡(mÂ³/h)
        p_in = df.iloc[:, 2].values  # å…¥å£å‹åŠ›(MPa)
        p_out = df.iloc[:, 3].values  # å‡ºå£å‹åŠ›(MPa)
        N_elc = df.iloc[:, 4].values  # ç”µæœºåŠŸç‡(kW)

        # å·²çŸ¥å‚æ•°
        Ï = 995.7  # æ°´çš„å¯†åº¦(kg/m^3)
        g = 9.81  # é‡åŠ›åŠ é€Ÿåº¦(m/sÂ²)
        Î”z = 0.23  # é«˜åº¦å·®(m)
        Î·_elc = 0.6  # ç”µæœºæ•ˆç‡

        # è®¡ç®—æ‰¬ç¨‹ï¼ˆå‹åŠ›å•ä½MPa â†’ Paï¼‰
        H = Î”z + ((p_out - p_in) * 1e6) / (Ï * g)

        # è®¡ç®—æœ‰æ•ˆåŠŸç‡ï¼ˆkW â†’ Wï¼‰
        N_elc_e = N_elc * Î·_elc * 1000

        # è®¡ç®—æµä½“æœ‰æ•ˆåŠŸç‡ï¼ˆQå•ä½mÂ³/h â†’ mÂ³/sï¼‰
        N_e = H * Q / 3600 * Ï * g

        # è®¡ç®—æ•ˆç‡ï¼ˆé¿å…é™¤ä»¥é›¶ï¼‰
        valid_N = np.where(N_elc_e != 0, N_elc_e, 1e-10)
        Î· = N_e / valid_N

        # äºŒæ¬¡æ‹Ÿåˆ
        params_H, _ = curve_fit(self.quadratic, Q, H)
        params_N, _ = curve_fit(self.quadratic, Q, N_elc_e)
        params_Î·, _ = curve_fit(self.quadratic, Q, Î·)

        # ä¿å­˜ç»“æœåˆ°å®ä¾‹å˜é‡
        self.ans2 = np.column_stack((H, N_elc_e, Î·))
        self.df = df
        self.params_H = params_H
        self.params_N = params_N
        self.params_Î· = params_Î·
        return self.ans2, self.df, self.params_H, self.params_N, self.params_Î·


class Auxiliary:
    def __init__(self, file_paths):
        self.file_paths = file_paths
        self.results = {}

    def identify_file_type(self, file_path):
        """æ ¹æ®æ–‡ä»¶åè¯†åˆ«æ–‡ä»¶ç±»å‹"""
        file_name = os.path.basename(file_path)
        if "æµä½“é˜»åŠ›" in file_name:
            return "fluid"
        elif "ç¦»å¿ƒæ³µ" in file_name:
            return "pump"
        else:
            raise ValueError(f"æ— æ³•è¯†åˆ«æ–‡ä»¶ç±»å‹: {file_name}")

    def process_files(self):
        """å¤„ç†æ‰€æœ‰æ–‡ä»¶"""
        for file_path in self.file_paths:
            try:
                file_type = self.identify_file_type(file_path)
                if file_type == "fluid":
                    calculator = Fluid_Flow_Calculator(file_path)
                    ans, df = calculator.process()
                    self.results["fluid"] = {"ans": ans, "df": df}
                elif file_type == "pump":
                    calculator = Centrifugal_Pump_Characteristics_Calculator(file_path)
                    ans, df, params_H, params_N, params_Î· = calculator.process()
                    self.results["pump"] = {
                        "ans": ans,
                        "df": df,
                        "params_H": params_H,
                        "params_N": params_N,
                        "params_Î·": params_Î·,
                    }
            except Exception as e:
                print(f"å¤„ç†æ–‡ä»¶ {file_path} æ—¶å‡ºé”™: {str(e)}")

    def get_results(self):
        """è·å–å¤„ç†ç»“æœ"""
        return self.results


if __name__ == "__main__":
    # æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    file_paths = [
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/æµä½“é˜»åŠ›åŸå§‹æ•°æ®.csv",
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/ç¦»å¿ƒæ³µåŸå§‹æ•°æ®.csv",
    ]

    # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
    os.makedirs("./æ‹Ÿåˆå›¾ç»“æœ", exist_ok=True)

    # åˆ›å»ºAuxiliaryå®ä¾‹å¹¶å¤„ç†æ–‡ä»¶
    processor = Auxiliary(file_paths)
    processor.process_files()

    # è·å–ç»“æœ
    results = processor.get_results()

    # æ‰“å°ç»“æœå­—å…¸çš„é”®
    print("å¤„ç†å®Œæˆï¼Œç»“æœå­—å…¸åŒ…å«ä»¥ä¸‹é”®:", results.keys())


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\heat_transfer_calculator.py çš„å†…å®¹:
================================================================================
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import numpy as np
import pandas as pd
from scipy.optimize import curve_fit


class Heat_Transfer_Calculator:
    """
    ä¼ çƒ­è®¡ç®—å™¨ç±»ã€‚
    """

    def __init__(self, csv_file_paths):
        """
        åˆå§‹åŒ–å‡½æ•°ï¼ŒåŠ è½½CSVæ–‡ä»¶å¹¶è¯»å–æ•°æ®é›†ã€‚

        å‚æ•°:
        csv_file_paths (list): CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        """
        self.file_dict = self._categorize_files(csv_file_paths)  # CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        self.datasets = self.load_data()  # åŠ è½½æ•°æ®é›†
        self.results = []  # å­˜å‚¨å¤„ç†ç»“æœ

    def _categorize_files(self, paths):
        """æ ¹æ®æ–‡ä»¶ååˆ†ç±»æ–‡ä»¶"""
        file_dict = {"æ— å¼ºåŒ–å¥—ç®¡": None, "æœ‰å¼ºåŒ–å¥—ç®¡": None, "é¢„å¤„ç†_æ— ": None, "é¢„å¤„ç†_æœ‰": None}

        for path in paths:
            if "æ— å¼ºåŒ–å¥—ç®¡" in path and "é¢„å¤„ç†" not in path:
                file_dict["æ— å¼ºåŒ–å¥—ç®¡"] = path
            elif "æœ‰å¼ºåŒ–å¥—ç®¡" in path and "é¢„å¤„ç†" not in path:
                file_dict["æœ‰å¼ºåŒ–å¥—ç®¡"] = path
            elif "æ•°æ®é¢„å¤„ç†_æ— " in path:
                file_dict["é¢„å¤„ç†_æ— "] = path
            elif "æ•°æ®é¢„å¤„ç†_æœ‰" in path:
                file_dict["é¢„å¤„ç†_æœ‰"] = path

        missing = [k for k, v in file_dict.items() if v is None]
        if missing:
            raise ValueError(f"ç¼ºå°‘å¿…è¦æ–‡ä»¶: {missing}")
        return file_dict

    def load_data(self):
        datasets = []
        # æŒ‰ç±»å‹è¯»å–æ–‡ä»¶
        for file_type in ["æ— å¼ºåŒ–å¥—ç®¡", "æœ‰å¼ºåŒ–å¥—ç®¡"]:
            file_path = self.file_dict[file_type]
            df = pd.read_csv(file_path, header=None)
            data = np.array(df.iloc[1:7, 1:4].values, dtype=float)
            datasets.append(
                {
                    "Î”p_kb": data[:, 0],
                    "t_in": data[:, 1],
                    "t_out": data[:, 2],
                }
            )
        return datasets

    def preprocess_data(self, Î”p_kb, t_in, t_out):
        """
        ä¼ çƒ­æ•°æ®é¢„å¤„ç†ï¼Œè®¡ç®—ç›¸å…³å‚æ•°å¹¶ç”ŸæˆåŸå§‹æ•°æ®å’Œè®¡ç®—ç»“æœè¡¨æ ¼ã€‚

        å‚æ•°:
        Î”p_kb (numpy.ndarray): å­”æ¿å‹å·®æ•°æ®
        t_in (numpy.ndarray): å…¥å£æ¸©åº¦æ•°æ®
        t_out (numpy.ndarray): å‡ºå£æ¸©åº¦æ•°æ®

        è¿”å›:
        ans_original_data (pd.DataFrame): åŸå§‹æ•°æ®è¡¨æ ¼
        ans_calculated_data (pd.DataFrame): è®¡ç®—ç»“æœè¡¨æ ¼
        data_for_fit (numpy.ndarray): ç”¨äºæ‹Ÿåˆçš„æ•°æ®
        """
        # è®¡ç®—è¿‡ç¨‹
        t_w = 98.4  # å£é¢æ¸©åº¦
        d_o = 0.022  # å¤–å¾„
        d_i = d_o - 2 * 0.001  # å†…å¾„
        l = 1.2  # é•¿åº¦
        n = 1  # ç®¡æ•°
        C_0 = 0.65  # æµé‡ç³»æ•°
        S_i = np.pi * l * n * d_i  # å†…è¡¨é¢ç§¯
        S_o = np.pi * l * n * d_o  # å¤–è¡¨é¢ç§¯
        A_i = (np.pi * d_i**2) / 4  # å†…æˆªé¢ç§¯
        A_0 = 2.27 * 10**-4  # å­”æ¿é¢ç§¯
        t_avg = 0.5 * (t_in + t_out)  # å¹³å‡æ¸©åº¦
        Cp = 1005  # æ¯”çƒ­å®¹
        Ï = (t_avg**2) / 10**5 - (4.5 * t_avg) / 10**3 + 1.2916  # å¯†åº¦
        Î» = -(2 * t_avg**2) / 10**8 + (8 * t_avg) / 10**5 + 0.0244  # å¯¼çƒ­ç³»æ•°
        Î¼ = (-(2 * t_avg**2) / 10**6 + (5 * t_avg) / 10**3 + 1.7169) / 10**5  # åŠ¨åŠ›ç²˜åº¦
        Pr = (Cp * Î¼) / Î»  # æ™®æœ—ç‰¹æ•°
        PrZeroFour = Pr**0.4  # æ™®æœ—ç‰¹æ•°çš„0.4æ¬¡æ–¹
        V_t = 3600 * A_0 * C_0 * np.sqrt((2 * 10**3 * Î”p_kb) / Ï)  # ä½“ç§¯æµé‡
        V_xiu = ((t_avg + 273.15) * V_t) / (t_in + 273.15)  # ä¿®æ­£ä½“ç§¯æµé‡
        u_m = V_xiu / (3600 * A_i)  # å¹³å‡æµé€Ÿ
        W_c = (Ï * V_xiu) / 3600  # è´¨é‡æµé‡
        Q = Cp * W_c * (t_out - t_in)  # çƒ­æµé‡
        Î±_i = Q / (t_avg * S_i)  # å†…è¡¨é¢æ¢çƒ­ç³»æ•°
        Nu_i = (d_i * Î±_i) / Î»  # åŠªå¡å°”æ•°
        Re_i = (Ï * d_i * u_m) / Î¼  # é›·è¯ºæ•°
        NuOverPrZeroFour = Nu_i / Pr**0.4  # åŠªå¡å°”æ•°ä¸æ™®æœ—ç‰¹æ•°çš„0.4æ¬¡æ–¹ä¹‹æ¯”
        Î”t1 = t_w - t_in  # æ¸©å·®1
        Î”t2 = t_w - t_out  # æ¸©å·®2
        Î”t_m = (Î”t2 - Î”t1) / (np.log(Î”t2) - np.log(Î”t1))  # å¹³å‡æ¸©å·®
        K_o = Q / (Î”t_m * S_o)  # æ€»ä¼ çƒ­ç³»æ•°

        # åˆ›å»ºåŸå§‹æ•°æ®è¡¨æ ¼
        ans_original_data = pd.DataFrame(
            {
                "åºå·": np.arange(1, len(Î”p_kb) + 1),
                "Î”på­”æ¿/kPa": Î”p_kb,
                "tå…¥/Â°C": t_in,
                "tå‡º/Â°C": t_out,
            }
        )

        # åˆ›å»ºè®¡ç®—ç»“æœè¡¨æ ¼
        ans_calculated_data = pd.DataFrame(
            {
                "åºå·": np.arange(1, len(Î”p_kb) + 1),
                "Î”p": Î”p_kb,
                "tå…¥": t_in,
                "tå‡º": t_out,
                "tå¹³": t_avg,
                "Ï": Ï,
                "Î»": Î»,
                "Î¼": Î¼,
                "Pr": Pr,
                "Pr^0.4": PrZeroFour,
                "V_t": V_t,
                "Vä¿®": V_xiu,
                "u_m": u_m,
                "W_c": W_c,
                "Q": Q,
                "Î±_i": Î±_i,
                "Nu_i": Nu_i,
                "Re_i": Re_i,
                "Nu/Pr^0.4": NuOverPrZeroFour,
                "Î”t1": Î”t1,
                "Î”t2": Î”t2,
                "Î”t_m": Î”t_m,
                "K_o": K_o,
            }
        ).T

        # å‡†å¤‡ç”¨äºæ‹Ÿåˆçš„æ•°æ®
        data_for_fit = np.array([Re_i, NuOverPrZeroFour]).T

        return ans_original_data, ans_calculated_data, data_for_fit

    def fit_func(self, x, a, b):
        """
        æ‹Ÿåˆå‡½æ•°ï¼Œç”¨äºæ›²çº¿æ‹Ÿåˆã€‚

        å‚æ•°:
        x (numpy.ndarray): è‡ªå˜é‡
        a (float): æ‹Ÿåˆå‚æ•°
        b (float): æ‹Ÿåˆå‚æ•°

        è¿”å›:
        numpy.ndarray: æ‹Ÿåˆç»“æœ
        """
        return a + b * x

    def process_data(self):
        """
        å¤„ç†æ•°æ®é›†ï¼Œè¿›è¡Œæ•°æ®é¢„å¤„ç†å’Œæ›²çº¿æ‹Ÿåˆã€‚
        """
        for idx, dataset in enumerate(self.datasets):
            Î”p_kb = dataset["Î”p_kb"]
            t_in = dataset["t_in"]
            t_out = dataset["t_out"]

            ans_original_data, ans_calculated_data, data_for_fit = self.preprocess_data(Î”p_kb, t_in, t_out)

            # æ£€æŸ¥å¹¶è¿‡æ»¤æ‰éæ­£å€¼
            valid_indices = (data_for_fit[:, 0] > 0) & (data_for_fit[:, 1] > 0)
            valid_data = data_for_fit[valid_indices]

            if len(valid_data) > 0:
                ans_params, _ = curve_fit(
                    self.fit_func,
                    np.log10(valid_data[:, 0]),
                    np.log10(valid_data[:, 1]),
                )
            else:
                print(f"è­¦å‘Šï¼šæ•°æ®é›† {idx+1} æ²¡æœ‰æœ‰æ•ˆçš„æ­£å€¼ç”¨äºæ‹Ÿåˆã€‚")
                ans_params = None

            self.results.append(
                {
                    "original_data": ans_original_data,
                    "calculated_data": ans_calculated_data,
                    "data_for_fit": valid_data,
                    "params": ans_params,
                }
            )

    def print_results(self):
        """
        æ‰“å°è¾“å‡ºresultså­—å…¸çš„calculated_dataé”®å€¼ã€‚
        """
        # è®¾ç½®æ˜¾ç¤ºé€‰é¡¹
        pd.set_option("display.max_columns", None)
        pd.set_option("display.max_rows", None)

        for idx, result in enumerate(self.results):
            print(f"æ•°æ®é›† {idx+1} çš„è®¡ç®—ç»“æœ:")
            print(result["calculated_data"])


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # å®šä¹‰CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
    csv_file_paths = [
        "åŸå§‹æ•°æ®_æ— å¼ºåŒ–å¥—ç®¡.csv",
        "åŸå§‹æ•°æ®_æœ‰å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†_æ— å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†_æœ‰å¼ºåŒ–å¥—ç®¡.csv",
    ]

    # å®ä¾‹åŒ–ä¼ çƒ­è®¡ç®—å™¨
    heat_transfer_calculator = Heat_Transfer_Calculator(csv_file_paths)

    # åŠ è½½æ•°æ®
    datasets = heat_transfer_calculator.load_data()

    # æ•°æ®å¤„ç†
    heat_transfer_calculator.process_data()

    # æ‰“å°ç»“æœ
    heat_transfer_calculator.print_results()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\oxygen_desorption_calculator.py çš„å†…å®¹:
================================================================================
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
from scipy.stats import pearsonr
import warnings
from typing import Dict, List, Union
from pathlib import Path

warnings.filterwarnings("ignore")


class Experiment_Data_Loader:
    """æ•°æ®åŠ è½½å™¨ï¼Œè´Ÿè´£ç®¡ç†å®éªŒæ•°æ®æ–‡ä»¶"""

    def __init__(
        self,
        dry_packed: Union[str, Path],
        wet_packed: Union[str, Path],
        water_constant: Union[str, Path],
        air_constant: Union[str, Path],
    ):
        self.file_dict = {
            "å¹²å¡«æ–™.csv": Path(dry_packed),
            "æ¹¿å¡«æ–™.csv": Path(wet_packed),
            "æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv": Path(water_constant),
            "ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv": Path(air_constant),
        }

        # éªŒè¯æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        self._validate_files()

    def _validate_files(self):
        """éªŒè¯æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å­˜åœ¨"""
        missing_files = [name for name, path in self.file_dict.items() if not path.exists()]
        if missing_files:
            raise FileNotFoundError(f"ä»¥ä¸‹æ–‡ä»¶æœªæ‰¾åˆ°: {missing_files}")

    def get_file(self, filename: str) -> Path:
        """è·å–æŒ‡å®šæ–‡ä»¶åçš„è·¯å¾„"""
        return self.file_dict.get(filename)


# ====================== å¡«æ–™å¡”å®éªŒ ======================
class Packed_Tower_Calculator:
    def __init__(self, data_loader: Experiment_Data_Loader):
        self.data_loader = data_loader
        self.required_files = ["å¹²å¡«æ–™.csv", "æ¹¿å¡«æ–™.csv"]
        self.results = []
        self._init_parameters()
        self._validate_files()

    def _validate_files(self):
        """éªŒè¯æ‰€éœ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨"""
        missing_files = [f for f in self.required_files if not self.data_loader.get_file(f).exists()]
        if missing_files:
            raise FileNotFoundError(f"ç¼ºå°‘å¡«æ–™å¡”å®éªŒå¿…è¦æ–‡ä»¶: {missing_files}")

    def _init_parameters(self):
        self.D = 0.1  # å¡”å¾„ (m)
        self.Z = 0.75  # å¡”é«˜ (m)
        self.Ï_æ°´ = 1000  # ä¿®æ­£ä¸ºæ­£ç¡®çš„å¯†åº¦ (kg/mÂ³)
        self.g = 9.8  # é‡åŠ›åŠ é€Ÿåº¦ (m/sÂ²)

    @staticmethod
    def linear_fit(x, a, b):
        return a * x + b

    @staticmethod
    def taylor_fit(x, *coefficients):
        return sum(coeff * (x**i) for i, coeff in enumerate(coefficients))

    def analyze_fluid_dynamics(self, csv_file: str, threshold: float = 0.95) -> dict:
        file_path = self.data_loader.get_file(csv_file)
        df = pd.read_csv(file_path, header=None)
        data = df.iloc[2:, 1:].apply(pd.to_numeric, errors="coerce").values

        V_ç©º = data[:, 0]  # ç©ºå¡”æ°”é€Ÿ (mÂ³/h)
        t_ç©º = data[:, 1]  # ç©ºå¡”æ¸©åº¦ (Â°C)
        p_ç©ºæ°”å‹åŠ› = data[:, 2] * 1e3  # è½¬æ¢ä¸ºPa
        Î”p_å…¨å¡”_mmH2O = data[:, 4]

        # è®¡ç®—ä¿®æ­£æ°”é€Ÿ
        A = np.pi * (self.D / 2) ** 2
        V_ç©º_ä¿® = V_ç©º * np.sqrt((1.013e5 / (p_ç©ºæ°”å‹åŠ› + 1.013e5)) * ((t_ç©º + 273.15) / 298.15))
        u = V_ç©º_ä¿® / A / 3600  # è½¬æ¢ä¸ºm/s

        # è®¡ç®—å•ä½å‹é™ (kPa/m)
        Î”p_over_Z = (self.Ï_æ°´ * self.g * Î”p_å…¨å¡”_mmH2O * 1e-3) / (self.Z * 1000)

        # æ•°æ®æ‹Ÿåˆ
        corr, _ = pearsonr(u, Î”p_over_Z)
        if abs(corr) >= threshold:
            popt, _ = curve_fit(self.linear_fit, u, Î”p_over_Z)
            fit_type = "linear"
        else:
            popt, _ = curve_fit(self.taylor_fit, u, Î”p_over_Z, p0=[0] * 5)
            fit_type = "taylor"

        return {
            "u": u,
            "delta_p": Î”p_over_Z,
            "corr": corr,
            "popt": popt,
            "fit_type": fit_type,
            "csv_file": csv_file,
        }

    def analyze_all_files(self):
        for csv_file in self.required_files:
            try:
                self.results.append(self.analyze_fluid_dynamics(csv_file))
            except Exception as e:
                print(f"åˆ†ææ–‡ä»¶ {csv_file} æ—¶å‡ºé”™: {str(e)}")


# ====================== æ°§è§£å¸å®éªŒ ======================
class Oxygen_Desorption_Calculator:
    def __init__(self, data_loader: Experiment_Data_Loader):
        self.data_loader = data_loader
        self.required_files = [
            "æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv",
            "ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv",
        ]
        self.results = []
        self._init_parameters()
        self._validate_files()

    def _validate_files(self):
        """éªŒè¯æ‰€éœ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨"""
        missing_files = [f for f in self.required_files if not self.data_loader.get_file(f).exists()]
        if missing_files:
            raise FileNotFoundError(f"ç¼ºå°‘æ°§è§£å¸å®éªŒå¿…è¦æ–‡ä»¶: {missing_files}")

    def _init_parameters(self):
        self.Ï_æ°´ = 1000  # kg/mÂ³
        self.M_H2O = 18e-3  # kg/mol
        self.M_O2 = 32e-3  # kg/mol
        self.D = 0.1  # å¡”å¾„ (m)
        self.Z = 0.75  # å¡”é«˜ (m)

    @staticmethod
    def oxygen_solubility(t):
        return (-8.5694e-5 * t**2 + 0.07714 * t + 2.56) * 1e9

    def analyze_file(self, csv_file: str) -> dict:
        file_path = self.data_loader.get_file(csv_file)
        df = pd.read_csv(file_path, header=None)
        data = df.iloc[2:, 1:].apply(pd.to_numeric, errors="coerce").values

        V_æ°´ = data[:, 1]  # L/h
        V_ç©º = data[:, 2]  # mÂ³/h
        Î”P = data[:, 3]  # mmH2O
        c_in = data[:, 5]  # mg/L
        c_out = data[:, 6]  # mg/L
        temp = data[:, 7]  # â„ƒ

        # ä¿®æ­£Lçš„è®¡ç®—ï¼šè€ƒè™‘å‡åˆ°ç«‹æ–¹ç±³çš„è½¬æ¢
        L = (V_æ°´ * 0.001) * self.Ï_æ°´ / (self.M_H2O * 3600)  # mol/s
        G = V_ç©º * 1.29 / 29e-3 / 3600  # mol/s
        m = self.oxygen_solubility(temp) / (101325 + 0.5 * Î”P * 9.8)

        # ä¼ è´¨ç³»æ•°è®¡ç®—
        x_in = (c_in * 1e-3 / self.M_O2) / (self.Ï_æ°´ / self.M_H2O + c_in * 1e-3 / self.M_O2)
        x_out = (c_out * 1e-3 / self.M_O2) / (self.Ï_æ°´ / self.M_H2O + c_out * 1e-3 / self.M_O2)
        Kxa = L * (x_in - x_out) / (np.pi * (self.D / 2) ** 2 * self.Z * self._log_mean_delta(x_in, x_out, m))

        return {"L": L, "G": G, "Kxa": Kxa, "csv_file": csv_file}

    def _log_mean_delta(self, x1, x2, m):
        delta1 = x1 - 0.21 / m
        delta2 = x2 - 0.21 / m
        return (delta1 - delta2) / np.log(delta1 / delta2)

    def analyze_all_files(self):
        for csv_file in self.required_files:
            try:
                self.results.append(self.analyze_file(csv_file))
            except Exception as e:
                print(f"åˆ†ææ–‡ä»¶ {csv_file} æ—¶å‡ºé”™: {str(e)}")


# ====================== ä¸»ç¨‹åº ======================
if __name__ == "__main__":
    # ç¤ºä¾‹ç”¨æ³• - æ›¿æ¢ä¸ºæ‚¨çš„å®é™…æ–‡ä»¶è·¯å¾„
    try:
        # åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨ï¼Œç›´æ¥ä¼ å…¥å››ä¸ªæ–‡ä»¶çš„å…¨è·¯å¾„
        data_loader = Experiment_Data_Loader(
            dry_packed="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/å¹²å¡«æ–™.csv",
            wet_packed="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ¹¿å¡«æ–™.csv",
            water_constant="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv",
            air_constant="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv",
        )

        # å¡«æ–™å¡”å®éªŒåˆ†æ
        tower_calc = Packed_Tower_Calculator(data_loader)
        tower_calc.analyze_all_files()
        print("å¡«æ–™å¡”å®éªŒåˆ†æå®Œæˆ")

        # æ°§è§£å¸å®éªŒåˆ†æ
        oxygen_calc = Oxygen_Desorption_Calculator(data_loader)
        oxygen_calc.analyze_all_files()
        print("æ°§è§£å¸å®éªŒåˆ†æå®Œæˆ")

    except FileNotFoundError as e:
        print(f"é”™è¯¯: {str(e)}")
        print("è¯·ç¡®ä¿æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å­˜åœ¨")
    except Exception as e:
        print(f"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\calculators\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_screens\base_screen.py çš„å†…å®¹:
================================================================================
class Base_Screen:
    pass


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_screens\data_record_screen.py çš„å†…å®¹:
================================================================================
# å†…ç½®åº“
import sys
import os
import time
import csv

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from tkinter import ttk
from tkinter import *
import tkinter.filedialog as filedialog
from tkinter.messagebox import showinfo, showwarning

# from tkinter.scrolledtext import ScrolledText

# æ ¹æ®ä¸åŒçš„å®éªŒè¿™é‡Œä¸ºä¸åŒçš„æ–‡ä»¶ï¼Œæ ¹æ®ä¸åŒçš„å®éªŒè¿™é‡Œä¸ºä¸åŒçš„ç±»
# è¿™é‡Œä»¥è¿‡æ»¤å®éªŒä¸ºä¾‹ï¼Œå…·ä½“çš„ï¼Œåº”è¯¥è®©ç”¨æˆ·ä¸€å¼€å§‹é€‰æ‹©è¿›å…¥çš„å®éªŒç•Œé¢ï¼Œç”¨ifåˆ¤æ–­é€‰æ‹©
from gui.screens.filteration_screen import Filteration_Screen
from gui.screens.utils.config import (
    DATA_CONFIG,
    DEFAULT_DATA_VALUE,
    FLAT_SUBFRAME_CONFIG,
    MAIN_FRAME_CONFIG,
)
from gui.screens.utils.expserial import EasySerial, getComPorts

from gui.screens.common_widgets.string_entries_widget import StringEntriesWidget


class Data_Record_Screen:
    """
    é€šç”¨æ•°æ®è®°å½•ç•Œé¢åŸºç±»
    ç”¨äºè®°å½•ä»ä¸²å£æ¥æ”¶åˆ°çš„æ•°æ®å¹¶ä¿å­˜åˆ°CSVæ–‡ä»¶æˆ–è€…äººä¸ºå¯¼å…¥csvæ–‡ä»¶è·å–æ•°æ®ï¼ˆä¸è¿‡å¯¼å…¥csvæ–‡ä»¶è¿™ä¸€ç‚¹åœ¨å„ä¸ªå®éªŒæ•°æ®å¤„ç†ç•Œé¢å®ç°å³å¯ï¼Œ
    å› ä¸ºå®éªŒæ•°æ®ç»“æ„çš„ä¸åŒï¼Œè¿™é‡Œä¸å¿…å®ç°ï¼‰ã€‚

    ç›¸åº”çš„ç»„ä»¶ã€æŒ‰é’®ã€å¿«æ·é”®ã€åˆ†åŒºåº”è¯¥æœ‰ä¸€äº›åŸºæœ¬çš„ï¼Œä¸åƒç°åœ¨æ˜¯ä¸ªç™½æ¿ã€‚
    """

    def __init__(self):
        # é€šç”¨è®¾ç½®
        self.comport = None
        self.comport_name = None
        self.all_comports = []
        self.start_time = 0
        self.end_time = 0
        self.temp_Delta_t = []
        self.temp_Delta_T = []
        self.temp_file_name = "tempfile.tmp"
        self.temp_file = None
        self.during_measuring = False
        self.csv_data = []
        self.csv_path = ""
        self.t1 = "0.000"
        self.t2 = "0.000"

    def init_states(self):
        """
        åˆå§‹åŒ–çŠ¶æ€ï¼Œç¦ç”¨ä¸€äº›æŒ‰é’®
        """
        self.button_data_start.config(state="disabled")
        self.button_data_stop.config(state="disabled")
        self.button_save.config(state="disabled")

    def get_comports(self):
        """
        è·å–å¯ç”¨çš„ä¸²å£å¹¶é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ‰“å¼€ã€‚
        """
        self.all_comports = getComPorts(select=True, timeout=DATA_CONFIG["port_timeout"])

        # æ›´æ–°ä¸²å£é€‰æ‹©èœå•
        if self.all_comports:
            if self.comport_name.get() not in self.all_comports:
                self.comport_name.set(self.all_comports[0])
            self.change_port(self.comport_name.get())
        else:
            self.comport_name.set("è¯·åˆ·æ–°ä¸²å£")
            if self.comport:
                self.comport.close()
            self.comport = None

    def change_port(self, event):
        """
        åˆ‡æ¢ä¸²å£
        """
        self.comport.close() if self.comport else None
        self.comport = None
        self.comport_name.set(event)
        self.comport = EasySerial(event)

        try:
            # æ‰“å¼€ä¸²å£å¹¶å†™å…¥ä¸´æ—¶æ–‡ä»¶
            self.temp_file = open(
                os.path.join(DATA_CONFIG["py_path"], self.temp_file_name),
                "w",
                encoding="UTF-8",
            )
            self.temp_file.write("time(s),Delta_T(K)\n")
            self.temp_file.flush()
            self.start_time = time.time()
            self.comport.open()
        except Exception as e:
            showwarning("ä¸²å£é”™è¯¯", f"ä¸²å£æ‰“å¼€å¤±è´¥: {str(e)}")
            self.comport.close()

    def data_start(self):
        """
        å¼€å§‹è®°å½•æ•°æ®
        """
        self.temp_file.close()
        self.temp_file = open(
            os.path.join(DATA_CONFIG["py_path"], self.temp_file_name),
            "w",
            encoding="UTF-8",
        )
        self.temp_file.write("time(s),Delta_T(K)\n")
        self.temp_file.flush()

        self.start_time = time.time()

        # åˆå§‹åŒ–æ•°æ®
        self.csv_data = [
            ["time(s)", "Delta_T(K)"],
        ]

        self.during_measuring = True

        self.text_frame.append(f"{time.strftime('%Y.%m.%d %H:%M:%S', time.localtime())} å¼€å§‹è®°å½•\n")
        self.text_frame.see("end")

    def data_end(self):
        """
        åœæ­¢è®°å½•æ•°æ®
        """
        self.temp_file.write("stop recording\n")
        self.temp_file.flush()
        self.csv_state = False
        self.text_frame.append(f"{time.strftime('%Y.%m.%d %H:%M:%S', time.localtime())} åœæ­¢è®°å½•\n")
        self.text_frame.see("end")
        self.button_data_stop.config(state="disabled")
        self.button_save.config(state="normal")

    def data_save(self):
        """
        ä¿å­˜æ•°æ®åˆ°CSVæ–‡ä»¶
        """
        self.csv_path = filedialog.asksaveasfilename(
            title="ä¿å­˜æ•°æ®",
            initialfile=f"{time.strftime('%Y%m%d%H%M%S', time.localtime())}data.csv",
            filetypes=[("CSV", ".csv")],
        )

        if not self.csv_path:
            return

        with open(self.csv_path, "w", encoding="UTF-8", newline="") as f:
            csv.writer(f).writerows(self.csv_data)

        showinfo(title="æç¤º", message=f"æ•°æ®æˆåŠŸä¿å­˜è‡³{self.csv_path}")

        self.text_frame.append(f"{time.strftime('%Y.%m.%d %H:%M:%S', time.localtime())} æ•°æ®ä¿å­˜æˆåŠŸ\n")
        self.text_frame.see("end")

    def read_comport(self):
        """
        ä»ä¸²å£è¯»å–æ•°æ®
        """
        try:
            # è¯»å–ä¸²å£æ•°æ®
            Delta_T = self.comport.read()
            self.end_time = time.time()
            Delta_t = self.end_time - self.start_time

            # å°†æ•°æ®å†™å…¥ä¸´æ—¶æ–‡ä»¶å’Œcsvæ–‡ä»¶
            self.temp_file.write(f"{Delta_t:.3f},{Delta_T:.3f}\n")
            self.temp_file.flush()

            self.csv_data.append([f"{Delta_t:.3f}", f"{Delta_T:.3f}"])

            # æ›´æ–°UIè¡¨æ ¼
            self.table_frame.append((f"{Delta_t:.3f}", f"{Delta_T:.3f}"))

            # æ›´æ–°æ•°æ®å­˜å‚¨
            self.temp_Delta_t.append(Delta_t)
            self.temp_Delta_T.append(Delta_T)

            # ç»˜å›¾æ›´æ–°
            self.plot_frame.clear()
            self.plot_frame.plot(self.temp_Delta_t, self.temp_Delta_T, color="#1F77B4")
            self.plot_frame.show()

        except Exception as e:
            showwarning("ä¸²å£è¯»å–é”™è¯¯", f"ä¸²å£è¯»å–æ•°æ®å¤±è´¥: {str(e)}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_screens\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\plot_widget.py çš„å†…å®¹:
================================================================================
# plot_widget.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from tkinter import ttk
from PIL import Image as pilImage
from PIL import ImageTk
from matplotlib.figure import Figure
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
from gui.screens.utils.config import DATA_CONFIG


class PlotWidget(ttk.Frame):
    def __init__(self, master, xlabel, ylabel, **kwargs):
        """
        Initialize PlotWidget to display Matplotlib chart within the Tkinter GUI.
        :param master: Parent container
        :param xlabel: X-axis label
        :param ylabel: Y-axis label
        :param kwargs: Other Tkinter configuration
        """
        super().__init__(master, **kwargs)
        self.xlabel = xlabel
        self.ylabel = ylabel
        self.figure = Figure(dpi=DATA_CONFIG["window"].winfo_fpixels("1i"))
        self.figure.subplots_adjust(left=0.1, right=0.9, top=0.9, bottom=0.15)
        self.f = self.figure.add_subplot(111)
        self.f.set_xlabel(self.xlabel)
        self.f.set_ylabel(self.ylabel)
        self._set_plot_style()

        # Creating the Canvas for embedding Matplotlib figure in Tkinter
        self.canvas = FigureCanvasTkAgg(self.figure, master=self)
        self.canvas.get_tk_widget().pack(fill="both", expand=True)  # Ensuring canvas fills space
        self.canvas.draw()

        # Binding resize event to adjust the canvas size
        self.bind("<Configure>", self.resize_image)

    def _set_plot_style(self):
        """Set plot style such as axis, ticks, and spine visibility."""
        self.f.tick_params(direction="in")
        for spine in self.f.spines.values():
            spine.set_visible(True)
            spine.set_linewidth(0.5)
        self.f.xaxis.label.set_fontname("SimHei")
        self.f.yaxis.label.set_fontname("SimHei")

    def clear(self):
        """Clear the plot content."""
        self.f.clear()
        self.f.set_xlabel(self.xlabel)
        self.f.set_ylabel(self.ylabel)

    def plot(self, x, y, **kwargs):
        """Plot a line graph on the widget."""
        self.f.plot(x, y, **kwargs)

    def scatter(self, x, y, **kwargs):
        """Plot a scatter plot on the widget."""
        self.f.scatter(x, y, **kwargs)

    def legend(self):
        """Show the legend in the plot."""
        self.f.legend()

    def show(self):
        """Render the plot and display it on the canvas."""
        self.canvas.draw()  # Update the canvas to show the plot

    def fill_between(self, x, y1, y2, **kwargs):
        """Fill the area between two curves on the plot."""
        self.f.fill_between(x, y1, y2, **kwargs)

    def resize_image(self, event):
        """Resize the plot based on the window size."""
        frame_width, frame_height = event.width, event.height
        new_width, new_height = (
            frame_width / self.figure.dpi,
            frame_height / self.figure.dpi,
        )
        self.figure.set_size_inches(new_width, new_height, forward=True)
        self.canvas.draw()  # Redraw after resizing the figure

    def save_fig(self, name):
        """Save the figure as an image file."""
        self.figure.set_size_inches(DATA_CONFIG["width_height_inches"])
        self.figure.savefig(fname=name, dpi=DATA_CONFIG["dpi"])


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\spin_entries_widget.py çš„å†…å®¹:
================================================================================
# spin_entries_widget.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from tkinter import ttk, StringVar

# å¯¼å…¥é…ç½®å’Œè¿‡æ»¤å¤„ç†ç±»ï¼ˆä½†æ˜¯è¿™ä¸ªä¸åº”è¯¥åªåº”è¯¥æ˜¯è¿‡æ»¤çš„å¤„ç†ç±»ï¼‰
from gui.screens.utils.config import DATA_CONFIG, FLAT_SUBFRAME_CONFIG
from gui.screens.maths.common_maths import find_start_end_point


class SpinEntriesWidget(ttk.Frame):
    """
    èµ·ç»ˆç‚¹é›†åˆ
    """

    PAIRS = 0

    class SpinEntry(ttk.Frame):
        def __init__(self, master, name, default="0", **kwargs):
            """
            åˆå§‹åŒ– SpinEntry æ§ä»¶ã€‚
            :param master: çˆ¶å®¹å™¨
            :param name: è¾“å…¥æ¡†æ ‡ç­¾
            :param default: é»˜è®¤å€¼
            :param kwargs: å…¶ä»–å‚æ•°
            """
            super().__init__(master, **kwargs)
            self.name = name
            self.label = ttk.Label(self, text=name)
            self.label.place(relx=0, rely=0, relwidth=0.5, relheight=1)
            self.cached = StringVar()
            self.cached.set(default)
            self.var = StringVar()
            self.var.set(default)

            # è®¾ç½®Spinboxæ§ä»¶
            self.entry = ttk.Spinbox(
                self,
                textvariable=self.var,
                from_=0,
                to=0,
                increment=1,
                command=self.check_memory,
            )
            self.entry.place(relx=0.5, rely=0, relwidth=0.5, relheight=1)
            self._bind_entry_events()

        def _bind_entry_events(self):
            """ç»‘å®šç„¦ç‚¹äº‹ä»¶"""
            self.entry.bind("<FocusIn>", lambda *args: self._bind_return())
            self.entry.bind("<FocusOut>", lambda *args: self._unbind_return())

        def _bind_return(self):
            """ç»‘å®šå›è½¦äº‹ä»¶"""
            self.bind("<Return>", self.check_memory)

        def _unbind_return(self):
            """è§£ç»‘å›è½¦äº‹ä»¶"""
            self.unbind("<Return>")
            self.check_memory()

        def check_memory(self):
            """æ£€æŸ¥å†…å­˜ä¸­çš„å€¼æ˜¯å¦æœ‰æ•ˆå¹¶æ›´æ–°"""
            if not self.var.get().isdigit():
                self.var.set(self.cached.get())
            elif hasattr(DATA_CONFIG["screen"], "spinEntries") and not DATA_CONFIG["screen"].spinEntries.check_memory():
                self.var.set(self.cached.get())
            else:
                self.cached.set(self.var.get())
                DATA_CONFIG["screen"].change_entry()
                DATA_CONFIG["screen"].calc_regression()
                DATA_CONFIG["screen"].plot_regression()
                DATA_CONFIG["screen"].plot_frame.show()

        def set_state(self, state):
            """è®¾ç½®æ§ä»¶çŠ¶æ€"""
            self.entry.config(state=state)

        def set_var(self, val):
            """è®¾ç½®å˜é‡çš„å€¼"""
            self.var.set(val)
            self.cached.set(val)

        def set_from_to(self, from_, to):
            """è®¾ç½®Spinboxçš„ä¸Šä¸‹é™"""
            self.entry.config(from_=from_, to=to)

    def __init__(self, master, pairs, **kwargs):
        """
        åˆå§‹åŒ– SpinEntriesWidget æ§ä»¶ã€‚
        :param master: çˆ¶å®¹å™¨
        :param pairs: é…å¯¹æ•°
        :param kwargs: å…¶ä»–å‚æ•°
        """
        super().__init__(master, **kwargs)
        self.entries = []
        self.entries_table = {}
        self._create_spin_entries(pairs)
        self._create_buttons(pairs)

    def _create_spin_entries(self, pairs):
        """åˆ›å»ºèµ·å§‹å’Œç»ˆæ­¢ç‚¹è¾“å…¥æ¡†"""
        for i in range(pairs):
            row_frame = ttk.Frame(self)
            row_frame.place(relx=0, rely=i * 0.25, relwidth=1, relheight=0.25)
            self.entries.append(self.SpinEntry(row_frame, f"Start {i + 1}"))
            self.entries[-1].place(relx=0, rely=0, relwidth=0.5, relheight=1)
            self.entries.append(self.SpinEntry(row_frame, f"End {i + 1}"))
            self.entries[-1].place(relx=0.5, rely=0, relwidth=0.5, relheight=1)

        # å°†entriesæ·»åŠ åˆ°å­—å…¸
        for entry in self.entries:
            self.entries_table[entry.name] = entry

    def _create_buttons(self, pairs):
        """åˆ›å»ºé‡ç½®å’Œè®¡ç®—æŒ‰é’®"""
        buttons = ttk.Frame(self)
        buttons.place(relx=0, rely=pairs * 0.25, relwidth=1, relheight=0.25)
        button_left = ttk.Frame(buttons, **FLAT_SUBFRAME_CONFIG)
        button_left.place(relx=0, rely=0, relwidth=0.5, relheight=1)
        button_right = ttk.Frame(buttons, **FLAT_SUBFRAME_CONFIG)
        button_right.place(relx=0.5, rely=0, relwidth=0.5, relheight=1)

        self.button_remake = ttk.Button(button_left, text="é‡ç½®(Ctrl-Z)", command=self.remake_file)
        self.button_integrate = ttk.Button(button_right, text="è®¡ç®—(Ctrl-D)", command=self.calc)
        self.button_remake.place(relx=0, rely=0, relwidth=1, relheight=1)
        self.button_integrate.place(relx=0, rely=0, relwidth=1, relheight=1)

    def gbl_buttons(self):
        """è®¾ç½®å…¨å±€æŒ‰é’®"""
        DATA_CONFIG["screen"].button_remake = self.button_remake
        DATA_CONFIG["screen"].button_integrate = self.button_integrate

    def check_memory(self):
        """æ£€æŸ¥è¾“å…¥å€¼æ˜¯å¦åˆæ³•"""
        if int(self.entries[0].var.get()) < 0:
            return False
        if "csv_len" in DATA_CONFIG and DATA_CONFIG["csv_len"] != -1:
            if DATA_CONFIG["csv_len"] <= int(self.entries[-1].var.get()):
                return False
        for i in range(1, len(self.entries)):
            if int(self.entries[i - 1].var.get()) >= int(self.entries[i].var.get()):
                return False
        return True

    def dump(self):
        """è¿”å›æ‰€æœ‰æ¡ç›®çš„å€¼"""
        return {entry.name: int(entry.cached.get()) for entry in self.entries}

    def set_var(self, key, value):
        """è®¾ç½®ç‰¹å®šæ¡ç›®çš„å€¼"""
        self.entries_table[key].set_var(value)

    def set_states(self, state):
        """è®¾ç½®æ‰€æœ‰æ¡ç›®çš„çŠ¶æ€"""
        for entry in self.entries:
            entry.set_state(state)

    def set_from_to(self, name, from_, to):
        """è®¾ç½®æ¡ç›®çš„ä¸Šä¸‹é™"""
        self.entries_table[name].set_from_to(from_, to)

    def remake_file(self):
        """é‡ç½®æ–‡ä»¶æ•°æ®å¹¶è¿›è¡Œè®¡ç®—"""

        # è°ƒç”¨maths_filterationä¸­çš„å‡½æ•°ï¼Œè·å–èµ·ç‚¹å’Œç»ˆç‚¹åˆ—è¡¨
        # è¯¥å‡½æ•°åŸºäºä¼ å…¥çš„CSVæ•°æ®ã€æ¨¡å¼ã€æ—¶é—´èŒƒå›´å’Œæ ‡å‡†é™åˆ¶è®¡ç®—æ•°æ®çš„èµ·ç‚¹å’Œç»ˆç‚¹ä½ç½®
        self.start_end_points_list = find_start_end_point(
            DATA_CONFIG["csv"],  # CSVæ•°æ®
            DATA_CONFIG["mode"].get(),  # è·å–å½“å‰æ¨¡å¼
            DATA_CONFIG["time_lower_limit"],  # æ—¶é—´ä¸‹é™
            DATA_CONFIG["time_upper_limit"],  # æ—¶é—´ä¸Šé™
            DATA_CONFIG["std_limit"],  # æ ‡å‡†å·®é™åˆ¶
        )

        # å¦‚æœæœªæ‰¾åˆ°æœ‰æ•ˆçš„èµ·ç‚¹å’Œç»ˆç‚¹æ•°æ®ï¼Œåˆ™è¿”å›
        if self.start_end_points_list is None:
            return

        # åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸ï¼Œç”¨äºå­˜å‚¨èµ·ç‚¹å’Œç»ˆç‚¹çš„æ˜ å°„å…³ç³»
        self.start_end_points_dict = {}

        # å°†è¯¥å­—å…¸å­˜å‚¨åˆ°å…¨å±€é…ç½®ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–åœ°æ–¹è®¿é—®
        DATA_CONFIG["screen"].start_end_points_dict = self.start_end_points_dict

        # éå†èµ·ç‚¹å’Œç»ˆç‚¹çš„åˆ—è¡¨ï¼Œå°†å®ƒä»¬å­˜å‚¨åˆ°å­—å…¸ä¸­
        # å¦‚æœç´¢å¼•æ˜¯å¶æ•°åˆ™æ˜¯â€œStartâ€ï¼Œå¥‡æ•°æ˜¯â€œEndâ€
        for i, point in enumerate(self.start_end_points_list):
            self.start_end_points_dict[f"{'End' if i & 1 else 'Start'} {(i >> 1) + 1}"] = (  # ä½¿ç”¨ä½è¿ç®—è®¡ç®—æ¯ç»„çš„ç¼–å·
                point
            )

        # æ›´æ–°èµ·ç‚¹å’Œç»ˆç‚¹çš„æ•°æ®
        self._update_start_end_points()

        # çº¿æ€§å›å½’è®¡ç®—
        # è§¦å‘ç•Œé¢æ›´æ–°ï¼Œè¿›è¡Œå›å½’åˆ†æ
        DATA_CONFIG["screen"].change_entry()  # æ›´æ–°è¾“å…¥æ¡†å†…å®¹
        DATA_CONFIG["screen"].calc_regression()  # è¿›è¡Œå›å½’è®¡ç®—
        DATA_CONFIG["screen"].plot_regression()  # ç»˜åˆ¶å›å½’ç»“æœ
        DATA_CONFIG["screen"].plot_frame.show()  # æ˜¾ç¤ºå›¾è¡¨

    def _update_start_end_points(self):
        """æ›´æ–°èµ·ç»ˆç‚¹å­—å…¸"""
        for i in range(self.PAIRS + 1):
            if f"End {i}" not in self.start_end_points_dict:
                self.start_end_points_dict[f"End {i}"] = self._calculate_end(i)
            if f"Start {i + 1}" not in self.start_end_points_dict:
                self.start_end_points_dict[f"Start {i + 1}"] = self._calculate_start(i)

        for i in range(1, self.PAIRS + 1):
            self.set_var(f"Start {i}", str(self.start_end_points_dict[f"Start {i}"]))
            self.set_var(f"End {i}", str(self.start_end_points_dict[f"End {i}"]))
            self.set_from_to(
                f"Start {i}",
                self.start_end_points_dict[f"End {i-1}"] + 1,
                self.start_end_points_dict[f"End {i}"] - 1,
            )
            self.set_from_to(
                f"End {i}",
                self.start_end_points_dict[f"Start {i}"] + 1,
                self.start_end_points_dict[f"Start {i + 1}"] - 1,
            )

        # è§£é”æŒ‰é’®
        self.button_remake.config(state="normal")
        self.button_integrate.config(state="normal")

    def _calculate_end(self, i):
        """è®¡ç®—ç»ˆç‚¹"""
        if i == 0:
            return -1
        elif i == self.PAIRS:
            return DATA_CONFIG["csv_len"] - 1
        else:
            return int(DATA_CONFIG["csv_len"] * (i * 2 - 1) / (self.PAIRS * 2 - 1))

    def _calculate_start(self, i):
        """è®¡ç®—èµ·ç‚¹"""
        if i == self.PAIRS:
            return DATA_CONFIG["csv_len"]
        else:
            return int(DATA_CONFIG["csv_len"] * (i * 2) / (self.PAIRS * 2 - 1))

    def calc(self):
        """ç§¯åˆ†ä¸å…¶ä»–å€¼è®¡ç®—"""
        DATA_CONFIG["screen"].calc_integration()
        DATA_CONFIG["screen"].plot_regression()
        DATA_CONFIG["screen"].plot_integration()
        DATA_CONFIG["screen"].plot_frame.show()
        DATA_CONFIG["screen"].calc_result()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\string_entries_widget.py çš„å†…å®¹:
================================================================================
# string_entries_widget.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import re

from tkinter import ttk, StringVar

# å¯¼å…¥é…ç½®
from gui.screens.utils.config import ENTRY_LABEL_CONFIG, DATA_CONFIG


class StringEntriesWidget(ttk.Frame):
    """
    å‚æ•°é›†åˆ
    """

    class CachedStringEntryWidget(ttk.Frame):
        def __init__(self, master, name, default="", text=None, **kwargs):
            super().__init__(master, **kwargs)
            self.name = name
            self.text = name if text is None else text
            self.label = ttk.Label(self, text=self.text, **ENTRY_LABEL_CONFIG)
            self.label.place(relx=0, rely=0, relwidth=0.5, relheight=1)

            default = "0" if default is None else default
            self.cached = StringVar(value=default)
            self.var = StringVar(value=default)

            self.entry = ttk.Entry(self, textvariable=self.var)
            self._bind_focus_events()

            self.entry.place(relx=0.5, rely=0, relwidth=0.5, relheight=1)

        def _bind_focus_events(self):
            """ç»‘å®šè¾“å…¥æ¡†çš„ç„¦ç‚¹äº‹ä»¶"""
            self.entry.bind("<FocusIn>", lambda *args: self._bind_return())
            self.entry.bind("<FocusOut>", lambda *args: self._unbind_return())

        def _bind_return(self):
            """å›è½¦äº‹ä»¶ç»‘å®š"""
            self.bind("<Return>", self.check_memory)

        def _unbind_return(self):
            """è§£ç»‘å›è½¦äº‹ä»¶"""
            self.unbind("<Return>")
            self.check_memory()

        def check_memory(self):
            """æ£€æŸ¥è¾“å…¥æ¡†çš„å€¼æ˜¯å¦åˆæ³•"""

            def is_number(s):
                try:
                    float(s)
                    return True
                except ValueError:
                    return False

            def format_input(memory: StringVar, realtime: StringVar):
                """æ ¼å¼åŒ–è¾“å…¥æ¡†çš„å†…å®¹ï¼Œä¿ç•™æ•°å­—å’Œç®—å¼"""
                # ä¿ç•™æ•°å­—ã€å°æ•°ç‚¹å’Œå››åˆ™è¿ç®—ç¬¦
                realtime.set(re.sub(r"[^\d+*/().-]+", "", realtime.get()))

                # å¦‚æœè¾“å…¥ä¸åŸå…ˆä¸åŒ
                if realtime.get() != memory.get():
                    # å¦‚æœä¸æ˜¯æ•°å­—ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ä¸ºåˆæ³•çš„æ•°å­¦ç®—å¼
                    if not is_number(realtime.get()):
                        try:
                            realtime.set(str(eval(realtime.get())))
                            if float(realtime.get()) == float(memory.get()):
                                realtime.set(memory.get())
                            else:
                                memory.set(realtime.get())
                                self.master.change()
                        except:
                            realtime.set(memory.get())
                    else:
                        memory.set(realtime.get())
                        if self.name not in (
                            "dissolution_heat(kJ)",
                            "constant(J/K)",
                            "combustion_heat(J/g)",
                        ):
                            DATA_CONFIG["screen"].change_entry()

            # è°ƒç”¨æ ¼å¼åŒ–å‡½æ•°
            format_input(self.cached, self.var)

        def set_state(self, state):
            """è®¾ç½®è¾“å…¥æ¡†çš„çŠ¶æ€"""
            self.entry.config(state=state)

        def set_var(self, value):
            """è®¾ç½®å˜é‡çš„å€¼"""
            self.var.set(value)
            self.cached.set(value)

    def __init__(
        self, master, names: list, defaults: dict = {}, dependences=[], texts: dict = {}, cols: int = 2, **kwargs
    ):
        super().__init__(master, **kwargs)
        self.entries = [
            self.CachedStringEntryWidget(self, name, default=defaults.get(name, ""), text=texts.get(name, None))
            for name in names
        ]
        self.entries_table = {entry.name: entry for entry in self.entries}

        # è®¾ç½®ä¾èµ–å…³ç³»
        self._setup_dependencies(dependences)

        # è®¡ç®—è¡Œåˆ—æ•°
        self._layout_entries(cols)

    def _setup_dependencies(self, dependences):
        """è®¾ç½®ä¾èµ–å…³ç³»ï¼šæ›´æ–°ä¸€ä¸ªæ¡ç›®æ—¶è§¦å‘å¦ä¸€ä¸ªæ¡ç›®çš„å˜åŒ–"""

        def trace_factory(affected, func, args):
            def trace_template(*_):
                res = func(*[self.entries_table[arg].cached.get() for arg in args])
                self.entries_table[affected].var.set(res)
                self.entries_table[affected].cached.set(res)

            return trace_template

        for traced, affected, func, args in dependences:
            self.entries_table[traced].cached.trace_add("write", trace_factory(affected, func, args))

    def _layout_entries(self, cols):
        """å¸ƒå±€è¾“å…¥æ¡†ç»„ä»¶"""
        rows = len(self.entries) // cols + (1 if len(self.entries) % cols != 0 else 0)
        for i, entry in enumerate(self.entries):
            entry.place(
                relx=(i % cols) / cols,
                rely=(i // cols) / rows,
                relwidth=1 / cols,
                relheight=1 / rows,
            )

    def clear(self):
        """æ¸…ç©ºæ‰€æœ‰æ¡ç›®çš„å€¼"""
        for entry in self.entries:
            entry.set_var("")

    def dump(self):
        """è¿”å›æ‰€æœ‰æ¡ç›®çš„å€¼"""
        return {entry.name: entry.cached.get() for entry in self.entries}

    def set_states(self, state, names):
        """è®¾ç½®ç‰¹å®šæ¡ç›®çš„çŠ¶æ€"""
        for name in names:
            self.entries_table[name].set_state(state)

    def set_all_states(self, state):
        """è®¾ç½®æ‰€æœ‰æ¡ç›®çš„çŠ¶æ€"""
        for entry in self.entries:
            entry.set_state(state)

    def set_value(self, key, value):
        """è®¾ç½®ç‰¹å®šæ¡ç›®çš„å€¼"""
        if key in self.entries_table:
            self.entries_table[key].set_var(value)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\table_widget.py çš„å†…å®¹:
================================================================================
# table_widget.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from tkinter import ttk


class TableWidget(ttk.Frame):
    """
    è¡¨æ ¼å®ç°
    """

    def __init__(self, master, cols, widths, **kwargs):
        super().__init__(master, **kwargs)
        self.table = self._create_table(cols, widths)
        self.scrollbar = self._create_scrollbar()

    def _create_table(self, cols, widths):
        """åˆ›å»ºè¡¨æ ¼å¹¶è®¾ç½®åˆ—å’Œå®½åº¦"""
        table = ttk.Treeview(self, show="headings", columns=cols)
        for col, width in zip(cols, widths):
            table.column(col, width=width, anchor="center")
            table.heading(col, text=col)
        table.place(relx=0, rely=0, relwidth=0.95, relheight=1)
        return table

    def _create_scrollbar(self):
        """åˆ›å»ºå¹¶é…ç½®å‚ç›´æ»šåŠ¨æ¡"""
        scrollbar = ttk.Scrollbar(self, orient="vertical", command=self.table.yview)
        scrollbar.place(relx=0.95, rely=0, relwidth=0.05, relheight=1)
        self.table.configure(yscrollcommand=scrollbar.set)
        return scrollbar

    def append(self, args):
        """å‘è¡¨æ ¼ä¸­æ·»åŠ ä¸€è¡Œ"""
        self.table.insert("", "end", values=args)
        self.table.yview_moveto(1)  # æ»šåŠ¨åˆ°åº•éƒ¨

    def clear(self):
        """æ¸…ç©ºè¡¨æ ¼å†…å®¹"""
        self.table.delete(*self.table.get_children())


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\text_widget.py çš„å†…å®¹:
================================================================================
# text_widget.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from tkinter import ttk
from tkinter.scrolledtext import ScrolledText


class TextWidget(ttk.Frame):
    """
    ä¿¡æ¯æ–‡æœ¬æ¡†
    """

    def __init__(self, master, **kwargs):
        super().__init__(master, **kwargs)
        self.textbox = self._create_textbox()

    def _create_textbox(self):
        """åˆ›å»ºå¹¶é…ç½®æ»šåŠ¨æ–‡æœ¬æ¡†"""
        textbox = ScrolledText(self)
        textbox.place(relx=0, rely=0, relwidth=1, relheight=1)
        textbox.config(state="disabled")
        return textbox

    def _enable_textbox(self):
        """å¯ç”¨æ–‡æœ¬æ¡†ï¼Œä»¥ä¾¿å¯ä»¥ä¿®æ”¹å†…å®¹"""
        self.textbox.config(state="normal")

    def _disable_textbox(self):
        """ç¦ç”¨æ–‡æœ¬æ¡†ï¼Œé˜²æ­¢ä¿®æ”¹å†…å®¹"""
        self.textbox.config(state="disabled")

    def append(self, s):
        """å°†æ–‡æœ¬è¿½åŠ åˆ°æ–‡æœ¬æ¡†"""
        self._enable_textbox()
        self.textbox.insert("end", s)
        self._disable_textbox()

    def clear(self):
        """æ¸…ç©ºæ–‡æœ¬æ¡†å†…å®¹"""
        self._enable_textbox()
        self.textbox.delete(1.0, "end")
        self._disable_textbox()

    def see(self, pos):
        """æ»šåŠ¨åˆ°æ–‡æœ¬æ¡†ä¸­çš„æŒ‡å®šä½ç½®"""
        self.textbox.see(pos)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\common_widgets\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\maths\common_maths.py çš„å†…å®¹:
================================================================================
# common_maths.py

import numpy as np
from scipy import optimize
from scipy.integrate import simps


# å¯»æ‰¾åˆå§‹èµ·æ­¢ç‚¹
def find_start_end_point(csv, code: str, time_lower_limit: int or float, time_upper_limit: int or float, std_limit: float):  # type: ignore # å»ºè®®æ—¶é—´ä¸‹é™30sï¼Œæ—¶é—´ä¸Šé™40sï¼Œæ ‡å‡†å·®ä¸Šé™0.01
    # ç¬¬ä¸€åˆ—ä¸ºindexï¼Œç¬¬äºŒåˆ—ä¸ºæ ‡å‡†å·®
    standard_deviation = []
    points = []
    count = 4 if code == "ç‡ƒçƒ§çƒ­" else 6
    platform = True
    start_index = 0
    end_index = 1
    if csv is None:
        return
    while end_index < len(csv):
        time_range = csv[end_index][0] - csv[start_index][0]
        if time_range > time_upper_limit:
            start_index += 1
        elif time_range < time_lower_limit:
            end_index += 1
        else:
            standard_deviation.append([end_index, np.std(csv[start_index:end_index, 1])])
            end_index += 1
    # å¯»æ‰¾èµ·æ­¢ç‚¹
    points.append(0)
    for i in standard_deviation:
        index, std = i
        if std <= std_limit and platform == False:
            points.append(index)
            platform = True
            count -= 1
        elif std > std_limit and platform == True:
            """
            # ä¼šå¯¼è‡´éæ­£å¸¸æ•°æ®æ— æ³•æ˜¾ç¤ºå›¾è±¡ï¼Œæš‚æ—¶åˆ é™¤
            # æ’é™¤å»¶åæ•ˆåº”çš„å½±å“
            time_now = csv[index][0]
            while time_now - csv[index][0] < time_lower_limit / 1.0:    # 1.0å¯è°ƒèŠ‚ï¼Œè¶Šå¤§å¯¹å»¶åçš„æ ¡æ­£è¶Šå¼±
                index -= 1
            """
            points.append(index)
            platform = False
            count -= 1
        if count == 2:
            break
    points.append(len(csv) - 1)
    return points


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\maths\__init__.py çš„å†…å®¹:
================================================================================



================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\distillation_plotter.py çš„å†…å®¹:
================================================================================
# distillation_plotter.py

import os
import sys
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.ticker import AutoMinorLocator

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

# from gui.screens.calculators.distillation_calculator import Distillation_Calculator
from gui.screens.calculators.distillation_calculator import process_and_save


class Distillation_Plotter:
    """
    ç²¾é¦å¡”å¯è§†åŒ–ç»˜å›¾ç±»

    åŠŸèƒ½ï¼š
    - ç”ŸæˆMcCabe-Thieleå›¾
    - å¯è§†åŒ–ç†è®ºå¡”æ¿è®¡ç®—ç»“æœ
    - ä¿å­˜å¯è§†åŒ–ç»“æœ

    ä½¿ç”¨æ–¹å¼ï¼š
    ä¼ å…¥å·²è®¡ç®—çš„Distillation_Calculatorå®ä¾‹
    """

    def __init__(self, calculator):
        """
        åˆå§‹åŒ–ç»˜å›¾å™¨

        å‚æ•°:
        calculator : Distillation_Calculator
            å·²å®Œæˆè®¡ç®—çš„ç²¾é¦è®¡ç®—å™¨å®ä¾‹
        """
        self.calc = calculator

        # ç»˜å›¾å‚æ•°é…ç½®
        self.figure_size = (10, 8)
        self.dpi = 150
        self.line_styles = {
            "equilibrium": {"linestyle": "--", "color": "blue", "linewidth": 2},
            "operating": {"linestyle": "-", "color": "green", "linewidth": 2},
            "stages": {"linestyle": ":", "color": "purple", "linewidth": 2},
            "q_line": {"linestyle": "-.", "color": "brown", "linewidth": 1.5},
        }

        # å­—ä½“é…ç½®
        plt.rcParams.update(
            {
                "font.sans-serif": ["SimHei"],  # è®¾ç½®ä¸­æ–‡å­—ä½“
                "axes.unicode_minus": False,  # æ­£å¸¸æ˜¾ç¤ºè´Ÿå·
                "font.size": 12,
            }
        )

    def _generate_plot_data(self):
        """ç”Ÿæˆç»˜å›¾æ‰€éœ€æ•°æ®"""
        x = np.linspace(0, 1, 100)

        # å„æ›²çº¿æ•°æ®
        data = {
            "x": x,
            "y_eq": self.calc.y_e(x),  # å¹³è¡¡çº¿
            "y_rect": self.calc.y_np1(x),  # ç²¾é¦æ®µæ“ä½œçº¿
            "y_strip": self.calc.y_mp1(x),  # æé¦æ®µæ“ä½œçº¿
            "y_q": self.calc.y_q(x),  # qçº¿
        }

        # é˜¶æ¢¯å›¾æ•°æ®
        x_stages = np.array([self.calc.xD])
        y_stages = np.array([self.calc.xD])

        for n, xi in enumerate(self.calc.xn):
            # å‚ç›´çº¿æ®µ
            x_stages = np.append(x_stages, xi)
            y_stages = np.append(y_stages, self.calc.yn[n])

            # æ°´å¹³çº¿æ®µ
            x_stages = np.append(x_stages, xi)
            if xi >= self.calc.xQ:
                y_next = self.calc.y_np1(xi)
            else:
                y_next = self.calc.y_mp1(xi)
            y_stages = np.append(y_stages, y_next)

        data.update({"x_stages": x_stages, "y_stages": y_stages})

        return data

    def plot_mccabe_thiele(self, save_path=None, show=True):
        """
        ç»˜åˆ¶McCabe-Thieleå›¾

        å‚æ•°:
        save_path : str, optional
            å›¾ç‰‡ä¿å­˜è·¯å¾„ï¼Œå¦‚æœä¸æä¾›åˆ™ä¸ä¿å­˜
        show : bool, optional
            æ˜¯å¦æ˜¾ç¤ºå›¾è¡¨ (é»˜è®¤ä¸ºTrue)
        """
        # å‡†å¤‡æ•°æ®
        data = self._generate_plot_data()

        # åˆ›å»ºå›¾å½¢
        fig, ax = plt.subplots(figsize=self.figure_size, dpi=self.dpi)

        # ç»˜åˆ¶ä¸»è¦æ›²çº¿
        ax.plot(data["x"], data["x"], linestyle="-", color="gray", alpha=0.5, label="å¯¹è§’çº¿")
        ax.plot(data["x"], data["y_eq"], **self.line_styles["equilibrium"], label="å¹³è¡¡çº¿")
        ax.plot(data["x"], data["y_rect"], **self.line_styles["operating"], label="ç²¾é¦æ®µæ“ä½œçº¿")
        ax.plot(data["x"], data["y_strip"], **self.line_styles["operating"], label="æé¦æ®µæ“ä½œçº¿")
        ax.plot(data["x"], data["y_q"], **self.line_styles["q_line"], label="qçº¿")

        # ç»˜åˆ¶é˜¶æ¢¯å›¾
        ax.plot(self.calc.xn, self.calc.yn, marker="+", markersize=10, linestyle="", color="red", label="ç†è®ºå¡”æ¿ç‚¹")
        ax.plot(data["x_stages"], data["y_stages"], **self.line_styles["stages"], label=f"ç†è®ºå¡”æ¿ ({self.calc.NT}å—)")

        # æ ‡è®°å…³é”®ç‚¹
        key_points = [
            (self.calc.xD, self.calc.xD, "D (é¦å‡ºæ¶²)", (0.02, -0.05)),
            (self.calc.xW, self.calc.xW, "W (é‡œæ®‹æ¶²)", (0.02, 0.02)),
            (self.calc.xQ, self.calc.yQ, "Q (è¿›æ–™ç‚¹)", (-0.05, 0.02)),
        ]

        for x, y, label, offset in key_points:
            ax.plot(x, y, "ko", markersize=6)
            ax.annotate(
                label,
                xy=(x, y),
                xytext=(x + offset[0], y + offset[1]),
                arrowprops=dict(arrowstyle="->", color="black", linewidth=1),
                bbox=dict(boxstyle="round", alpha=0.2, facecolor="white"),
            )

        # è®¾ç½®å›¾å½¢å±æ€§
        ax.set_xlim(0, 1)
        ax.set_ylim(0, 1)
        ax.set_xlabel("æ¶²ç›¸æ‘©å°”åˆ†æ•° (x)", fontsize=12)
        ax.set_ylabel("æ°”ç›¸æ‘©å°”åˆ†æ•° (y)", fontsize=12)
        ax.set_title(f"McCabe-Thieleæ³•å›¾è§£ç†è®ºæ¿æ•°\n(å›æµæ¯” R={self.calc.R}, q={self.calc.q:.2f})", fontsize=14, pad=20)

        # æ·»åŠ ç½‘æ ¼å’Œåˆ»åº¦
        ax.grid(True, linestyle=":", alpha=0.6)
        ax.xaxis.set_minor_locator(AutoMinorLocator())
        ax.yaxis.set_minor_locator(AutoMinorLocator())

        # æ·»åŠ ç†è®ºæ¿æ•°æ ‡æ³¨
        ax.text(
            0.65,
            0.25,
            f"ç†è®ºæ¿æ•°: {self.calc.NT}\n"
            f"å®é™…æ¿æ•°: {self.calc.NT - 1}\n"
            f"è¿›æ–™ä½ç½®: ç¬¬{len(self.calc.xn[self.calc.xn > self.calc.xQ])}å—",
            bbox=dict(boxstyle="round", alpha=0.2, facecolor="white"),
        )

        # å›¾ä¾‹
        ax.legend(loc="upper left", framealpha=0.8)

        # è°ƒæ•´å¸ƒå±€
        fig.tight_layout()

        # ä¿å­˜æˆ–æ˜¾ç¤º
        if save_path:
            os.makedirs(os.path.dirname(save_path), exist_ok=True)
            fig.savefig(save_path, dpi=300, bbox_inches="tight")
            print(f"å›¾è¡¨å·²ä¿å­˜è‡³: {save_path}")

        if show:
            plt.show()
        else:
            plt.close(fig)


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":

    # 1. R -> 4
    calculator = process_and_save(
        file_path="./csv_data/ç²¾é¦/ç²¾é¦åŸå§‹è®°å½•è¡¨(é)/Sheet1.csv", R=4, Î±m=2.0, F=80, tS=30, tF=26, filename="R_4_ç»“æœ"
    )

    if calculator:  # å¦‚æœè®¡ç®—æˆåŠŸ
        # åˆ›å»ºç»˜å›¾å™¨å¹¶ç»˜å›¾
        plotter = Distillation_Plotter(calculator)
        plotter.plot_mccabe_thiele(save_path="./æ‹Ÿåˆå›¾ç»“æœ/R_4_plot.png", show=False)

    # 2. R -> +âˆ
    calculator = process_and_save(
        file_path="./csv_data/ç²¾é¦/ç²¾é¦åŸå§‹è®°å½•è¡¨(é)/Sheet1.csv",
        R=10000,
        Î±m=2.0,
        F=80,
        tS=30,
        tF=26,
        filename="R_+âˆ_ç»“æœ",
    )

    if calculator:  # å¦‚æœè®¡ç®—æˆåŠŸ
        # åˆ›å»ºç»˜å›¾å™¨å¹¶ç»˜å›¾
        plotter = Distillation_Plotter(calculator)
        plotter.plot_mccabe_thiele(save_path="./æ‹Ÿåˆå›¾ç»“æœ/R_+âˆ_plot.png", show=False)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\drying_plotter.py çš„å†…å®¹:
================================================================================
# drying_plotter.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import zipfile
import pickle

import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.image as mpimg

from pathlib import Path

from gui.screens.calculators.drying_calculator import Drying_Calculator


class Drying_Plotter:
    def __init__(self, calculator):
        """åˆå§‹åŒ–ç»˜å›¾å™¨ï¼Œéœ€è¦ä¼ å…¥å·²è®¡ç®—å®Œæˆçš„Drying_Calculatorå®ä¾‹"""
        if not isinstance(calculator, Drying_Calculator):
            raise TypeError("å¿…é¡»ä¼ å…¥Drying_Calculatorå®ä¾‹")

        if not calculator.results:
            raise ValueError("è®¡ç®—å™¨å°šæœªæ‰§è¡Œè®¡ç®—ï¼Œè¯·å…ˆè°ƒç”¨run_full_calculation()")

        self.calculator = calculator
        self.setup_plot_style()

    def setup_plot_style(self):
        """ç»˜å›¾æ ·å¼é…ç½®"""
        # plt.style.use("seaborn-v0_8")
        plt.rcParams.update(
            {
                "font.family": ["Microsoft YaHei", "DejaVu Sans"],  # ä¸»å­—ä½“+å›é€€å­—ä½“
                "axes.unicode_minus": False,
                "figure.dpi": 150,
                "axes.titlesize": 12,
                "axes.labelsize": 10,
                "xtick.labelsize": 8,
                "ytick.labelsize": 8,
                "mathtext.fontset": "cm",  # ä½¿ç”¨Computer Modernæ•°å­¦å­—ä½“
                "mathtext.default": "regular",
            }
        )

    def _validate_data(self):
        """éªŒè¯å¿…è¦ç»˜å›¾æ•°æ®æ˜¯å¦å­˜åœ¨"""
        required_attrs = ["Ï„_bar", "X_bar", "U"]
        missing = [attr for attr in required_attrs if not hasattr(self.calculator, attr)]
        if missing:
            raise AttributeError(f"ç¼ºå°‘å¿…è¦æ•°æ®: {', '.join(missing)}")

    def plot_drying_curve(self, save_dir="./æ‹Ÿåˆå›¾ç»“æœ"):
        """ç»˜åˆ¶å¹²ç‡¥æ›²çº¿"""
        self._validate_data()
        save_path = Path(save_dir)
        save_path.mkdir(parents=True, exist_ok=True)

        fig, ax = plt.subplots(figsize=(8, 6))
        ax.scatter(
            self.calculator.Ï„_bar,
            self.calculator.X_bar,
            marker="o",
            color="#FF6B6B",
            edgecolor="w",
            label="å®éªŒæ•°æ®ç‚¹",
        )
        ax.plot(
            self.calculator.Ï„_bar,
            self.calculator.X_bar,
            linestyle="--",
            color="#4ECDC4",
            linewidth=2,
            label="æ‹Ÿåˆæ›²çº¿",
        )

        ax.set_title("ç‰©æ–™å¹²åŸºå«æ°´é‡éšæ—¶é—´å˜åŒ–æ›²çº¿", pad=20)
        ax.set_xlabel(r"å¹²ç‡¥æ—¶é—´ $\tau$ (h)", labelpad=10)
        ax.set_ylabel(r"å¹²ç‡¥é€Ÿç‡ $U\ (\mathrm{kg/m^2 \cdot h})$", labelpad=10)
        ax.grid(True, alpha=0.3)
        ax.legend(frameon=True)

        curve_path = save_path / "drying_curve.png"
        fig.savefig(curve_path, dpi=300, bbox_inches="tight")
        plt.close(fig)
        return str(curve_path)

    def plot_drying_rate_curve(self, save_dir="./æ‹Ÿåˆå›¾ç»“æœ"):
        """ç»˜åˆ¶å¹²ç‡¥é€Ÿç‡æ›²çº¿"""
        self._validate_data()
        save_path = Path(save_dir)
        save_path.mkdir(parents=True, exist_ok=True)

        fig, ax = plt.subplots(figsize=(8, 6))
        ax.scatter(
            self.calculator.X_bar,
            self.calculator.U,
            marker="s",
            color="#45B7D1",
            edgecolor="w",
            label="é€Ÿç‡æ•°æ®ç‚¹",
        )

        # æ·»åŠ æ’å®šé€Ÿç‡å‚è€ƒçº¿
        if self.calculator.U_c is not None:
            ax.axhline(
                y=self.calculator.U_c,
                color="#FF9F43",
                linestyle="--",
                label=f"æ’å®šé€Ÿç‡ {self.calculator.U_c:.3f} kg/mÂ²Â·h",
            )

        ax.set_title("å¹²ç‡¥é€Ÿç‡æ›²çº¿", pad=20)
        ax.set_xlabel(r"å¹²åŸºå«æ°´é‡ $X$ (kg/kg å¹²åŸº)", labelpad=10)
        ax.set_ylabel(r"å¹²ç‡¥é€Ÿç‡ $U$ (kg/mÂ²Â·h)", labelpad=10)
        ax.grid(True, alpha=0.3)
        ax.legend(frameon=True)

        rate_path = save_path / "drying_rate_curve.png"
        fig.savefig(rate_path, dpi=300, bbox_inches="tight")
        plt.close(fig)
        return str(rate_path)

    def integrate_images(self, save_dir="./æ‹Ÿåˆå›¾ç»“æœ"):
        """
        ç”Ÿæˆç»„åˆå¯¹æ¯”å›¾ï¼ˆæ¨ªå‘æ’åˆ—ï¼‰
        """
        save_path = Path(save_dir)
        save_path.mkdir(parents=True, exist_ok=True)

        # ç”Ÿæˆå­å›¾
        fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 6))

        # å¹²ç‡¥æ›²çº¿
        ax1.scatter(self.calculator.Ï„_bar, self.calculator.X_bar, color="#FF6B6B")
        ax1.plot(self.calculator.Ï„_bar, self.calculator.X_bar, "#4ECDC4")
        ax1.set_title("å¹²ç‡¥æ›²çº¿")

        # å¹²ç‡¥é€Ÿç‡æ›²çº¿
        ax2.scatter(self.calculator.X_bar, self.calculator.U, color="#45B7D1")
        if self.calculator.U_c:
            ax2.axhline(self.calculator.U_c, color="#FF9F43", linestyle="--")
        ax2.set_title("å¹²ç‡¥é€Ÿç‡æ›²çº¿")

        # ç»Ÿä¸€æ ·å¼
        for ax in (ax1, ax2):
            ax.grid(True, alpha=0.3)
            ax.tick_params(axis="both", which="major", labelsize=8)

        combined_path = save_path / "combined_plots.png"
        plt.tight_layout()
        fig.savefig(combined_path, dpi=300, bbox_inches="tight")
        plt.close(fig)
        return str(combined_path)

    def compress_results(self, source_dir="./æ‹Ÿåˆå›¾ç»“æœ", output_name="æ‹Ÿåˆç»“æœ"):
        """
        ç”Ÿæˆå‹ç¼©åŒ…
        """
        source_path = Path(source_dir)
        if not source_path.exists():
            raise FileNotFoundError(f"ç›®å½•ä¸å­˜åœ¨: {source_dir}")

        # ç›´æ¥ä½¿ç”¨æŒ‡å®šçš„è¾“å‡ºåç§°ï¼Œä¸åŠ æ—¶é—´æˆ³
        output_path = Path(f"{output_name}.zip")

        with zipfile.ZipFile(output_path, "w") as zipf:
            for file in source_path.glob("*.png"):
                zipf.write(file, arcname=file.name)

        return str(output_path)

    def serialize_results(self, output_path="å¹²ç‡¥å®éªŒç»“æœ.pkl"):
        """
        å¸¦ç‰ˆæœ¬æ§åˆ¶çš„åºåˆ—åŒ–
        """
        data = {
            "metadata": {
                "version": "1.1",
                "create_time": pd.Timestamp.now().isoformat(),
                "calculator_type": type(self.calculator).__name__,
            },
            "results": self.calculator.results,
        }

        with open(output_path, "wb") as f:
            pickle.dump(data, f, protocol=pickle.HIGHEST_PROTOCOL)

        return output_path

    def run_full_plotting(self, output_dir="./æ‹Ÿåˆç»“æœ"):
        """å®Œæ•´çš„ç»˜å›¾æµç¨‹"""
        results_dir = Path(output_dir)
        results_dir.mkdir(parents=True, exist_ok=True)

        # ç”Ÿæˆå›¾è¡¨
        self.plot_drying_curve(results_dir)
        self.plot_drying_rate_curve(results_dir)
        combined_path = self.integrate_images(results_dir)

        # æ‰“åŒ…ç»“æœ
        zip_path = self.compress_results(results_dir)
        pkl_path = self.serialize_results(results_dir / "å®éªŒæ•°æ®.pkl")

        return {
            "combined_plot": combined_path,
            "zip_archive": zip_path,
            "serialized_data": pkl_path,
        }


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    csv_files = [
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®1.csv",
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®2.csv",
    ]
    # æ‰§è¡Œè®¡ç®—
    calculator = Drying_Calculator(csv_files)
    calculator.run_full_calculation()

    # åˆå§‹åŒ–ç»˜å›¾å™¨
    plotter = Drying_Plotter(calculator)

    # è¿è¡Œå®Œæ•´æµç¨‹
    outputs = plotter.run_full_plotting()

    print("ç”Ÿæˆç»“æœï¼š")
    print(f"- ç»„åˆå›¾è¡¨: {outputs['combined_plot']}")
    print(f"- å‹ç¼©åŒ…: {outputs['zip_archive']}")
    print(f"- åºåˆ—åŒ–æ•°æ®: {outputs['serialized_data']}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\extraction_plotter.py çš„å†…å®¹:
================================================================================
# extraction_plotter.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import logging
import zipfile
import numpy as np
from scipy.integrate import trapezoid
from scipy.interpolate import interp1d

from gui.screens.calculators.extraction_calculator import Extraction_Calculator

# é…ç½®æ—¥å¿—è®¾ç½®
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")

import matplotlib.pyplot as plt


class Extraction_Plotter:
    def __init__(self, calculator):
        self.calculator = calculator
        self._setup_plot_style()
        self.output_dir = "./æ‹Ÿåˆå›¾ç»“æœ"

    def _setup_plot_style(self):
        """ç»Ÿä¸€è®¾ç½®ä¸“ä¸šç§‘ç ”ç»˜å›¾æ ·å¼"""
        plt.rcParams.update(
            {
                "font.family": [
                    "SimHei",
                    "Microsoft YaHei",
                    "Arial Unicode MS",
                ],  # å­—ä½“å›é€€é“¾
                "axes.unicode_minus": False,
                "figure.dpi": 300,  # å°åˆ·çº§åˆ†è¾¨ç‡
                "axes.linewidth": 2,  # åæ ‡è½´çº¿å®½
                "grid.alpha": 0.3,  # ç½‘æ ¼é€æ˜åº¦
                "legend.frameon": False,  # å›¾ä¾‹æ— è¾¹æ¡†
                "legend.fontsize": 10,  # å›¾ä¾‹å­—å·
                "xtick.major.width": 2,  # Xè½´åˆ»åº¦çº¿å®½
                "ytick.major.width": 2,  # Yè½´åˆ»åº¦çº¿å®½
                "xtick.minor.visible": True,  # æ˜¾ç¤ºæ¬¡è¦åˆ»åº¦
                "ytick.minor.visible": True,  # æ˜¾ç¤ºæ¬¡è¦åˆ»åº¦
                "figure.facecolor": "white",  # å›¾è¡¨èƒŒæ™¯è‰²
                "savefig.bbox": "tight",  # ä¿å­˜æ—¶è‡ªåŠ¨è£å‰ª
            }
        )  # åœ¨ Extraction_Plotter ç±»ä¸­ä¿®æ”¹å­—ä½“è®¾ç½®æ–¹æ³•

    def _setup_plot_style(self):
        """æ™ºèƒ½é…ç½®ä¸­æ–‡å­—ä½“ï¼Œæ”¯æŒè·¨å¹³å°"""
        import matplotlib.font_manager as fm

        # ä¸­æ–‡å­—ä½“ä¼˜å…ˆçº§åˆ—è¡¨
        chinese_fonts = [
            "Microsoft YaHei",  # Windows å¾®è½¯é›…é»‘
            "SimHei",  # Windows ä¸­æ˜“é»‘ä½“
            "WenQuanYi Zen Hei",  # Linux æ–‡æ³‰é©¿
            "PingFang SC",  # macOS è‹¹æ–¹
            "Source Han Sans SC",  # æ€æºé»‘ä½“
        ]

        # æ‰«æç³»ç»Ÿæ‰€æœ‰å­—ä½“
        system_fonts = {f.name for f in fm.fontManager.ttflist}

        # é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„ä¸­æ–‡å­—ä½“
        selected_font = None
        for font in chinese_fonts:
            if font in system_fonts:
                selected_font = font
                break

        # é…ç½®å­—ä½“å‚æ•°
        plt.rcParams.update(
            {
                "font.family": "sans-serif",
                "font.sans-serif": [selected_font] if selected_font else [],
                "axes.unicode_minus": False,
                "figure.dpi": 300,
                "axes.linewidth": 2,
                "grid.alpha": 0.3,
                "legend.frameon": False,
                "legend.fontsize": 10,
            }
        )

        # å¦‚æœæœªæ‰¾åˆ°ä¸­æ–‡å­—ä½“ï¼Œæ˜¾ç¤ºè­¦å‘Š
        if not selected_font:
            import warnings

            warnings.warn(
                "\n\nâš ï¸ æœªæ£€æµ‹åˆ°ç³»ç»Ÿä¸­æ–‡å­—ä½“ï¼è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n"
                "Windowsç”¨æˆ·ï¼šå®‰è£…'å¾®è½¯é›…é»‘'å­—ä½“\n"
                "Macç”¨æˆ·ï¼šç»ˆç«¯æ‰§è¡Œ `brew tap homebrew/cask-fonts && brew install font-wqy-microhei`\n"
                "Linuxç”¨æˆ·ï¼šæ‰§è¡Œ `sudo apt install fonts-wqy-microhei`"
            )

    def create_output_dir(self):
        """åˆ›å»ºè¾“å‡ºç›®å½•"""
        if not os.path.exists(self.output_dir):
            os.makedirs(self.output_dir)

    def plot_main_curves(self):
        """ç»˜åˆ¶ä¸»åˆ†ææ›²çº¿å›¾"""
        plt.figure(figsize=(10, 8), facecolor="white")

        # ç»˜åˆ¶åˆ†é…æ›²çº¿
        self._plot_distribution_curve()

        # ç»˜åˆ¶æ“ä½œçº¿
        self._plot_operating_line(0, "æ“ä½œçº¿1", "#2ca02c")  # ç»¿è‰²
        self._plot_operating_line(1, "æ“ä½œçº¿2", "#ff7f0e")  # æ©™è‰²

        # ä¸“ä¸šå›¾è¡¨è£…é¥°
        plt.title("åˆ†é…æ›²çº¿ä¸æ“ä½œçº¿åˆ†æå›¾", fontsize=14, pad=15)
        plt.xlabel("èƒä½™ç›¸æµ“åº¦ X (kg/kg)", fontsize=12, labelpad=10)
        plt.ylabel("èƒå–ç›¸æµ“åº¦ Y (kg/kg)", fontsize=12, labelpad=10)
        plt.legend(loc="upper left", fontsize=10)
        plt.grid(True, which="both", linestyle=":", alpha=0.5)
        plt.xlim(0, max(self.calculator.X3_data) * 1.1)
        plt.ylim(0, max(self.calculator.Y3_data) * 1.1)

        # è¾¹æ¡†å¼ºåŒ–
        for spine in plt.gca().spines.values():
            spine.set_linewidth(2)

        self._save_figure("ä¸»åˆ†ææ›²çº¿å›¾")

    def _plot_distribution_curve(self):
        """ç»˜åˆ¶åˆ†é…æ›²çº¿å…ƒç´ """
        plt.scatter(
            self.calculator.X3_data,
            self.calculator.Y3_data,
            c="#9467bd",  # ç´«è‰²
            marker="^",
            s=80,
            edgecolor="k",
            linewidth=1,
            label="å®éªŒæ•°æ®ç‚¹",
            zorder=3,
        )
        plt.plot(
            self.calculator.X3_to_fit,
            self.calculator.Y_fitted,
            color="#1f77b4",  # è“è‰²
            lw=2.5,
            label=f"ä¸‰æ¬¡å¤šé¡¹å¼æ‹Ÿåˆ (RÂ²={self._calculate_r_squared():.3f})",
        )

    def _plot_operating_line(self, idx, label, color):
        """ä¸“ä¸šæ“ä½œçº¿ç»˜åˆ¶"""
        X_points = [self.calculator.X_Rb[idx], self.calculator.X_Rt[idx]]
        Y_points = [self.calculator.Y_Eb[idx], 0]

        # ç”Ÿæˆç›´çº¿æ•°æ®
        X_line = np.linspace(0, X_points[0], 100)
        Y_line = eval(f"self.calculator.k{idx+1}") * X_line + eval(f"self.calculator.b{idx+1}")

        # ç»˜åˆ¶å…ƒç´ 
        plt.scatter(
            X_points,
            Y_points,
            c=color,
            s=100,
            edgecolors="k",
            linewidth=1,
            zorder=4,
            label=f"{label}ç«¯ç‚¹",
        )
        plt.plot(
            X_line,
            Y_line,
            color=color,
            ls="--",
            lw=2,
            alpha=0.8,
            label=f'{label} ($Y={eval(f"self.calculator.k{idx+1}"):.4f}X+{eval(f"self.calculator.b{idx+1}"):.4f}$)',
        )

    def _calculate_r_squared(self):
        """è®¡ç®—å†³å®šç³»æ•°"""
        y_pred = np.polyval(self.calculator.coefficients, self.calculator.X3_data)
        ss_res = np.sum((self.calculator.Y3_data - y_pred) ** 2)
        ss_tot = np.sum((self.calculator.Y3_data - np.mean(self.calculator.Y3_data)) ** 2)
        return 1 - (ss_res / ss_tot)

    def plot_integration_curves(self):
        """ç»˜åˆ¶ä¸“ä¸šçº§ç§¯åˆ†æ›²çº¿"""
        # ç›´æ¥ä½¿ç”¨å·²åˆ†ç»„çš„æ•°æ®
        grouped_data = self.calculator.data5_for_graph_integral

        for idx, group in enumerate(grouped_data):
            plt.figure(figsize=(10, 6), facecolor="white")

            # æ„å»ºæ•°æ®å­—å…¸
            data_dict = {
                "Y5_Eb": group[0],
                "X_Rb": group[1],
                "Y5star": group[2],
                "integrand": group[3],
            }

            self._plot_single_integration(data_dict, idx)

            # ä¸“ä¸šæ ‡æ³¨
            plt.title(f"å›¾è§£ç§¯åˆ†æ›²çº¿ - å®éªŒç»„ {idx+1}", fontsize=12, pad=15)
            plt.xlabel("èƒå–ç›¸æµ“åº¦ $Y_5$", fontsize=10, labelpad=8)
            plt.ylabel("ç§¯åˆ†é¡¹ $\\frac{1}{Y_5^* - Y_5}$", fontsize=10, labelpad=8)
            plt.grid(True, which="both", linestyle=":", alpha=0.3)

            # è¾¹æ¡†å¼ºåŒ–
            for spine in plt.gca().spines.values():
                spine.set_linewidth(2)

            self._save_figure(f"ç§¯åˆ†æ›²çº¿_{idx+1}")

    def _plot_single_integration(self, data, idx):
        """ç»˜åˆ¶å•ç»„ç§¯åˆ†æ›²çº¿ï¼ˆç§‘ç ”çº§æ ·å¼ï¼‰"""
        # æ’å€¼å¹³æ»‘
        interp_func = interp1d(data["Y5_Eb"], data["integrand"], "cubic")
        Y_smooth = np.linspace(data["Y5_Eb"].min(), data["Y5_Eb"].max(), 100)
        integrand_smooth = interp_func(Y_smooth)

        # è®¡ç®—ç§¯åˆ†å€¼
        integral = trapezoid(integrand_smooth, Y_smooth)

        # ä¸“ä¸šç»˜å›¾å…ƒç´ 
        plt.fill_between(
            Y_smooth,
            integrand_smooth,
            alpha=0.3,
            color="#8c564b",  # æ£•è‰²
            label="ç§¯åˆ†åŒºåŸŸ",
        )
        plt.plot(Y_smooth, integrand_smooth, color="#1f77b4", lw=2, label="æ‹Ÿåˆæ›²çº¿")  # è“è‰²
        plt.scatter(
            data["Y5_Eb"],
            data["integrand"],
            c="#d62728",  # çº¢è‰²
            s=50,
            edgecolor="k",
            linewidth=0.8,
            label="ç¦»æ•£æ•°æ®ç‚¹",
            zorder=3,
        )

        # ç§‘ç ”çº§æ ‡æ³¨
        plt.text(
            0.95,
            0.85,
            f"ç§¯åˆ†é¢ç§¯ = {integral:.5f}",
            transform=plt.gca().transAxes,
            ha="right",
            va="top",
            bbox=dict(
                facecolor="white",
                edgecolor="#2f2f2f",
                boxstyle="round,pad=0.3",
                alpha=0.9,
            ),
            fontsize=10,
        )
        plt.legend(loc="upper right", fontsize=9)

    def _save_figure(self, name):
        """ä¿å­˜ç§‘ç ”çº§å›¾è¡¨"""
        plt.tight_layout()
        plt.savefig(
            f"{self.output_dir}/{name}.png",
            dpi=300,
            bbox_inches="tight",
            pad_inches=0.1,
        )
        plt.close()

    def package_results(self, zip_file="èƒå–åˆ†æç»“æœ.zip"):
        """ä¸“ä¸šæ‰“åŒ…æ–¹æ³•"""
        with zipfile.ZipFile(zip_file, "w", zipfile.ZIP_DEFLATED) as zipf:
            for root, _, files in os.walk(self.output_dir):
                for file in files:
                    file_path = os.path.join(root, file)
                    zipf.write(file_path, arcname=os.path.relpath(file_path, self.output_dir))


if __name__ == "__main__":
    # æ–‡ä»¶è·¯å¾„
    main_csv = "./1_åŸå§‹æ•°æ®è®°å½•.csv"
    distribution_csv = "./3_åˆ†é…æ›²çº¿æ•°æ®é›†.csv"

    # åˆå§‹åŒ–è®¡ç®—å™¨
    calculator = Extraction_Calculator(main_csv, distribution_csv)
    calculator.run_calculations()

    # åˆå§‹åŒ–ç»˜å›¾å™¨
    plotter = Extraction_Plotter(calculator)
    plotter.create_output_dir()

    # ç”Ÿæˆå›¾è¡¨
    plotter.plot_main_curves()
    plotter.plot_integration_curves()

    # æ‰“åŒ…ç»“æœ
    plotter.package_results()
    print("å¤„ç†å®Œæˆï¼ç»“æœå·²ä¿å­˜è‡³å½“å‰ç›®å½•")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\filteration_plotter.py çš„å†…å®¹:
================================================================================
# filteration_plotter.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import numpy as np
import matplotlib.pyplot as plt
import matplotlib.image as mpimg
from gui.screens.calculators.filteration_calculator import Filteration_Calculator

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams["font.family"] = "SimHei"
plt.rcParams["axes.unicode_minus"] = False
plt.rcParams["figure.dpi"] = 50
plt.rcParams["savefig.dpi"] = 300


class Filteration_Plotter:
    """
    è´Ÿè´£ç”Ÿæˆç¬¦åˆæŒ‡å®šé£æ ¼çš„å›¾è¡¨ï¼Œä¿æŒä¸€è‡´çš„ç»˜å›¾é£æ ¼è®¾ç½®
    """

    def __init__(self, csv_file_path):
        """
        åˆå§‹åŒ–ç»˜å›¾ç±»ï¼Œè®¾ç½®å›¾è¡¨çš„é»˜è®¤æ ·å¼ï¼Œå¹¶è°ƒç”¨è®¡ç®—ç±»è¿›è¡Œæ•°æ®å¤„ç†
        :param csv_file_path: CSVæ–‡ä»¶è·¯å¾„
        """
        self.csv_file_path = csv_file_path
        self.calculator = Filteration_Calculator(self.csv_file_path)

        # è·å–è®¡ç®—å™¨ç”Ÿæˆçš„æ•°æ®
        (
            self.q_to_refit_lists,
            self.delta_theta_over_delta_q_to_refit_lists,
            self.refit_slopes,
            self.refit_intercepts,
        ) = self.calculator.process_all_groups()

        # å­˜å‚¨æ¥è‡ªè®¡ç®—å™¨çš„æ‰€æœ‰æ•°æ®å’Œå˜é‡
        self.calculator_data = {
            "data": self.calculator.data,  # å­˜å‚¨åŠ è½½çš„CSVæ•°æ®
            "q_to_refit_lists": self.calculator.q_to_refit_lists,
            "delta_theta_over_delta_q_to_refit_lists": self.calculator.delta_theta_over_delta_q_to_refit_lists,
            "refit_slopes": self.calculator.refit_slopes,
            "refit_intercepts": self.calculator.refit_intercepts,
            "selected_data": self.calculator.selected_data,
            "data_array": self.calculator.data_array,
            "deltaV": self.calculator.deltaV,
            "S": self.calculator.S,
            "deltaQ": self.calculator.deltaQ,
            "delta_theta_list": self.calculator.delta_theta_list,
            "delta_q_list": self.calculator.delta_q_list,
            "delta_theta_over_delta_q_list": self.calculator.delta_theta_over_delta_q_list,
            "q_list": self.calculator.q_list,
            "q_to_fit": self.calculator.q_to_fit,
            "delta_theta_over_delta_q_to_fit": self.calculator.delta_theta_over_delta_q_to_fit,
            "fit_model": self.calculator.fit_model,
            "fit_data": self.calculator.fit_data,
            "fit_slope": self.calculator.fit_slope,
            "fit_intercept": self.calculator.fit_intercept,
            "outliers": self.calculator.outliers,
            "refit_model": self.calculator.refit_model,
            "filtered_data": self.calculator.filtered_data,
        }

        # å›¾åƒè·¯å¾„å­˜å‚¨å˜é‡
        self.images_paths = []

        # è®¾ç½®å›¾è¡¨é£æ ¼
        plt.rcParams["font.family"] = "SimHei"
        plt.rcParams["axes.unicode_minus"] = False
        plt.rcParams["figure.dpi"] = 50
        plt.rcParams["savefig.dpi"] = 300

        # å­˜å‚¨å›¾è¡¨çš„æ˜¾ç¤ºèŒƒå›´é…ç½®
        self.plot_ranges_initial = [
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 140000},
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 25000},
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 8000},
        ]
        self.plot_ranges_refit = [
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 15000},
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 5000},
            {"x_min": 0, "x_max": 0.200, "y_min": 0, "y_max": 4000},
        ]

    def set_axes_style(self):
        """
        è®¾ç½®ç»Ÿä¸€çš„åæ ‡è½´æ ·å¼
        """
        plt.gca().spines["top"].set_linewidth(2)
        plt.gca().spines["bottom"].set_linewidth(2)
        plt.gca().spines["left"].set_linewidth(2)
        plt.gca().spines["right"].set_linewidth(2)
        plt.minorticks_on()

    def save_image(self, filename):
        """
        ä¿å­˜ç”Ÿæˆçš„å›¾åƒå¹¶è®°å½•è·¯å¾„
        :param filename: å›¾åƒä¿å­˜çš„æ–‡ä»¶å
        """
        # å®šä¹‰ä¿å­˜è·¯å¾„
        directory = "./æ‹Ÿåˆå›¾ç»“æœ"

        # æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
        if not os.path.exists(directory):
            os.makedirs(directory)

        # å›¾åƒä¿å­˜çš„å®Œæ•´è·¯å¾„
        image_path = os.path.join(directory, f"{filename}.png")

        # è®°å½•å›¾åƒè·¯å¾„
        self.images_paths.append(image_path)

        # ä¿å­˜å›¾åƒ
        plt.savefig(image_path)
        plt.close()

    def add_auxiliary_lines(self, q_list, delta_theta_over_delta_q_list):
        """
        åœ¨å›¾è¡¨ä¸­æ·»åŠ è¾…åŠ©çº¿
        :param q_list: qå€¼åˆ—è¡¨
        :param delta_theta_over_delta_q_list: Î”Î¸/Î”qå€¼åˆ—è¡¨
        """
        for i in range(len(delta_theta_over_delta_q_list) - 1):
            plt.axvline(x=q_list[i], color="black", linestyle="dashed")
            plt.hlines(
                y=delta_theta_over_delta_q_list[i],
                xmin=q_list[i],
                xmax=q_list[i + 1],
                color="black",
            )
            plt.axvline(x=q_list[i + 1], color="black", linestyle="dashed")

        i = len(delta_theta_over_delta_q_list) - 1
        plt.axvline(x=q_list[i], color="black", linestyle="dashed")
        plt.hlines(
            y=delta_theta_over_delta_q_list[i],
            xmin=q_list[i],
            xmax=q_list[i],
            color="black",
        )
        plt.axvline(x=q_list[i], color="black", linestyle="dashed")

    def create_initial_fit_figure(
        self,
        group_index,
        q_to_fit,
        delta_theta_over_delta_q_to_fit,
        fit_slope,
        fit_intercept,
        q_list,
        delta_theta_over_delta_q_list,
        plot_range,
    ):
        """
        åˆ›å»ºåˆæ‹Ÿåˆå›¾è¡¨
        """
        plt.figure(figsize=(8, 6))
        plt.scatter(q_to_fit, delta_theta_over_delta_q_to_fit, color="red", label="æ‹Ÿåˆæ•°æ®")
        plt.plot(q_to_fit, fit_slope * q_to_fit + fit_intercept, color="blue", label="æ‹Ÿåˆçº¿")

        center_x = np.mean(q_to_fit)
        center_y = np.mean(delta_theta_over_delta_q_to_fit)
        equation_text = f"y = {fit_slope:.2f} * x + {fit_intercept:.2f}"
        plt.text(
            center_x,
            center_y,
            equation_text,
            color="black",
            fontsize=15,
            verticalalignment="top",
            weight="bold",
        )

        self.add_auxiliary_lines(q_list, delta_theta_over_delta_q_list)
        plt.xlim(plot_range["x_min"], plot_range["x_max"])
        plt.ylim(plot_range["y_min"], plot_range["y_max"])

        plt.xlabel("q å€¼")
        plt.ylabel("Î”Î¸/Î”q")
        plt.legend(loc="upper left")
        plt.figtext(0.5, 0.01, f"ç¬¬{group_index+1}ç»„æ•°æ®åˆæ‹Ÿåˆ", ha="center", fontsize=15)

        # è®¾ç½®è½´æ ·å¼
        self.set_axes_style()

        # è°ƒç”¨è‡ªå®šä¹‰çš„ save_image å‡½æ•°
        self.save_image(f"{2 * group_index + 1}")
        # plt.show()

    def create_refit_figure(
        self,
        group_index,
        filtered_data,
        refit_slope,
        refit_intercept,
        q_list,
        delta_theta_over_delta_q_list,
        plot_range,
    ):
        """
        åˆ›å»ºé‡æ–°æ‹Ÿåˆå›¾è¡¨
        """
        plt.figure(figsize=(8, 6))
        plt.scatter(filtered_data[:, 0], filtered_data[:, 1], color="red", label="æ‹Ÿåˆæ•°æ®")
        plt.plot(
            filtered_data[:, 0],
            refit_slope * filtered_data[:, 0] + refit_intercept,
            color="blue",
            label="æ‹Ÿåˆçº¿",
        )

        center_x = np.mean(filtered_data[:, 0])
        center_y = np.mean(filtered_data[:, 1])
        equation_text = f"y = {refit_slope:.2f} * x + {refit_intercept:.2f}"
        plt.text(
            center_x,
            center_y,
            equation_text,
            color="black",
            fontsize=15,
            verticalalignment="top",
            weight="bold",
        )

        self.add_auxiliary_lines(q_list, delta_theta_over_delta_q_list)
        plt.xlim(plot_range["x_min"], plot_range["x_max"])
        plt.ylim(plot_range["y_min"], plot_range["y_max"])

        plt.xlabel("q å€¼")
        plt.ylabel("Î”Î¸/Î”q")
        plt.legend(loc="upper left")
        plt.figtext(
            0.5,
            0.01,
            f"ç¬¬{group_index+1}ç»„æ•°æ®æ’é™¤å¼‚å¸¸å€¼åé‡æ–°æ‹Ÿåˆ",
            ha="center",
            fontsize=15,
        )

        self.set_axes_style()
        self.save_image(f"{2 * group_index + 2}")
        # plt.show()

    def generate_comparison_figures(self):
        """
        ç”Ÿæˆå¯¹æ¯”å›¾
        """
        # åˆå§‹æ‹Ÿåˆå¯¹æ¯”å›¾
        plt.figure(figsize=(8, 6))
        for group_index in range(3):
            (
                q_to_fit,
                delta_theta_over_delta_q_to_fit,
                delta_theta_over_delta_q_list,
                q_list,
            ) = self.calculator.process_single_group_data(group_index)
            model, _ = self.calculator.perform_linear_fit(q_to_fit, delta_theta_over_delta_q_to_fit)
            fit_slope = model.coef_[0]
            fit_intercept = model.intercept_

            plt.scatter(
                q_to_fit,
                delta_theta_over_delta_q_to_fit,
                label=f"ç¬¬{group_index+1}ç»„æ•°æ®",
            )
            plt.plot(
                q_to_fit,
                fit_slope * q_to_fit + fit_intercept,
                label=f"æ‹Ÿåˆçº¿{group_index+1}",
            )
            self.add_auxiliary_lines(q_list, delta_theta_over_delta_q_list)

        plt.xlim(0, 0.200)
        plt.xlabel("q å€¼")
        plt.ylabel("Î”Î¸/Î”q")
        plt.legend(loc="upper left")
        plt.figtext(0.5, 0.01, "ä¸‰ç»„æ•°æ®ä¿ç•™æ‰€æœ‰æ•°æ®ç‚¹åˆæ‹Ÿåˆå¯¹æ¯”", ha="center", fontsize=15)

        self.set_axes_style()
        self.save_image("7")
        # plt.show()

        # é‡æ–°æ‹Ÿåˆå¯¹æ¯”å›¾
        plt.figure(figsize=(8, 6))
        for i in range(3):
            plt.scatter(
                self.q_to_refit_lists[i],
                self.delta_theta_over_delta_q_to_refit_lists[i],
                label=f"ç¬¬{i+1}ç»„æ•°æ®",
            )
            plt.plot(
                self.q_to_refit_lists[i],
                self.refit_slopes[i] * self.q_to_refit_lists[i] + self.refit_intercepts[i],
                label=f"æ‹Ÿåˆçº¿{i+1}",
            )
            self.add_auxiliary_lines(
                self.q_to_refit_lists[i],
                self.delta_theta_over_delta_q_to_refit_lists[i],
            )

        plt.xlim(0, 0.200)
        plt.xlabel("q å€¼")
        plt.ylabel("Î”Î¸/Î”q")
        plt.legend(loc="upper left")
        plt.figtext(0.5, 0.01, "ä¸‰ç»„æ•°æ®æ’é™¤å¼‚å¸¸å€¼åå†æ‹Ÿåˆå¯¹æ¯”", ha="center", fontsize=15)

        self.set_axes_style()
        self.save_image("8")
        # plt.show()

    def integrate_figures(self):
        """
        åˆå¹¶æ‰€æœ‰ç»˜å›¾ç”Ÿæˆçš„å›¾ç‰‡å¹¶ä¿å­˜æˆä¸€å¼ å›¾ç‰‡
        """
        images = []
        for i in range(1, 9):
            img = mpimg.imread(f"./æ‹Ÿåˆå›¾ç»“æœ/{i}.png")
            images.append(img)

        fig, axes = plt.subplots(4, 2, figsize=(10, 12))
        for ax, img in zip(axes.flatten(), images):
            ax.imshow(img)
            ax.axis("off")

        plt.subplots_adjust(wspace=0.01, hspace=0.01)
        plt.savefig(r"./æ‹Ÿåˆå›¾ç»“æœ/æ‹Ÿåˆå›¾æ•´åˆå›¾.png", bbox_inches="tight")
        # plt.show()

    def generate_all_figures(self):
        """
        ç”Ÿæˆæ‰€æœ‰å¿…è¦çš„å›¾å½¢ã€‚
        """
        # 1. ç”»ä¸‰å¼ åˆæ‹Ÿåˆå›¾
        for i in range(3):
            # æ­£ç¡®æ‹†è§£æ•°æ®
            (
                q_to_fit,
                delta_theta_over_delta_q_to_fit,
                delta_theta_over_delta_q_list,
                q_list,
            ) = self.calculator.process_single_group_data(i)

            # æ‰§è¡Œçº¿æ€§æ‹Ÿåˆ
            model, _ = self.calculator.perform_linear_fit(q_to_fit, delta_theta_over_delta_q_to_fit)
            fit_slope = model.coef_[0]
            fit_intercept = model.intercept_

            # åˆ›å»ºåˆæ‹Ÿåˆå›¾
            self.create_initial_fit_figure(
                i,
                q_to_fit,
                delta_theta_over_delta_q_to_fit,
                fit_slope,
                fit_intercept,
                q_list,
                delta_theta_over_delta_q_list,
                self.plot_ranges_initial[i],
            )

        # 2. ç”»ä¸‰å¼ å†æ‹Ÿåˆå›¾
        for i in range(3):
            # å¤„ç†æ•°æ®å¹¶è·å¾—å›å½’çº¿åçš„æ•°æ®
            (
                q_to_fit,
                delta_theta_over_delta_q_to_fit,
                delta_theta_over_delta_q_list,
                q_list,
            ) = self.calculator.process_single_group_data(i)

            # æ‰§è¡Œçº¿æ€§æ‹Ÿåˆ
            model, fit_data = self.calculator.perform_linear_fit(q_to_fit, delta_theta_over_delta_q_to_fit)

            # è·å–å¼‚å¸¸å€¼
            outliers = self.calculator.detect_outliers(fit_data)

            # é‡æ–°æ‹Ÿåˆæ•°æ®å¹¶ç§»é™¤å¼‚å¸¸å€¼
            refit_model, filtered_data = self.calculator.refit_data_after_outlier_removal(fit_data, outliers)

            refit_slope = refit_model.coef_[0]
            refit_intercept = refit_model.intercept_

            # åˆ›å»ºé‡æ–°æ‹Ÿåˆå›¾
            self.create_refit_figure(
                i,
                filtered_data,
                refit_slope,
                refit_intercept,
                q_list,
                delta_theta_over_delta_q_list,
                self.plot_ranges_refit[i],
            )

        # 3. ç”Ÿæˆå¯¹æ¯”å›¾
        self.generate_comparison_figures()

        # 4. ç”Ÿæˆæ•´åˆå›¾
        self.integrate_figures()


if __name__ == "__main__":
    plotter = Filteration_Plotter(r"./è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨(é).csv")

    plotter.generate_all_figures()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\fluid_flow_plotter.py çš„å†…å®¹:
================================================================================
# fluid_flow_plotter.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)


import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

from gui.screens.calculators.fluid_flow_calculator import Fluid_Flow_Calculator
from gui.screens.calculators.fluid_flow_calculator import Centrifugal_Pump_Characteristics_Calculator
from gui.screens.calculators.fluid_flow_calculator import Auxiliary


class Fluid_Flow_Plotter:
    def __init__(self, calculator):
        self.calculator = calculator
        self.ans1 = calculator.ans1
        self.df = calculator.df
        self.p = calculator.p
        self.log_Re = calculator.log_Re
        self.log_Î» = calculator.log_Î»
        self.valid_idx = calculator.valid_idx
        self.Re = self.ans1[:, 1]
        self.Î» = self.ans1[:, 2]

    def plot(self):
        """ç»˜åˆ¶æµä½“é˜»åŠ›åˆ†æç»“æœ"""
        # è®¾ç½®å­—ä½“
        plt.rcParams["font.sans-serif"] = ["SimHei"]
        plt.rcParams["axes.unicode_minus"] = False

        # æœ‰æ•ˆæ•°æ®
        Re_valid = self.Re[self.valid_idx]
        Î»_valid = self.Î»[self.valid_idx]
        log_Re = np.log10(Re_valid)
        log_Î» = np.log10(Î»_valid)

        # ç”Ÿæˆæ’å€¼ç‚¹
        log_Re_interp = np.linspace(log_Re.min(), log_Re.max(), 100)
        log_lambda_interp = self.p(log_Re_interp)

        # ç»˜åˆ¶æ— æ’å€¼å›¾
        plt.figure(figsize=(8, 6), dpi=125)
        plt.scatter(log_Re, log_Î», color="b", label="æ•°æ®ç‚¹")
        plt.plot(log_Re, self.p(log_Re), color="red", label="æ‹Ÿåˆæ›²çº¿")
        plt.xlabel("lg(Re)")
        plt.ylabel("lg(Î»)")
        plt.title("é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æ— æ’å€¼)")
        plt.grid(True)
        plt.legend()
        plt.savefig("./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æ— æ’å€¼).png", dpi=300)
        plt.close()

        # plt.show()

        # ç»˜åˆ¶æœ‰æ’å€¼å›¾
        plt.figure(figsize=(8, 6), dpi=125)
        plt.scatter(log_Re, log_Î», color="b", label="æ•°æ®ç‚¹")
        plt.plot(log_Re_interp, log_lambda_interp, color="r", label="æ’å€¼æ›²çº¿")
        plt.xlabel("lg(Re)")
        plt.ylabel("lg(Î»)")
        plt.title("é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æœ‰æ’å€¼)")
        plt.grid(True)
        plt.legend()
        plt.savefig("./æ‹Ÿåˆå›¾ç»“æœ/é›·è¯ºæ•°ä¸é˜»åŠ›ç³»æ•°åŒå¯¹æ•°æ‹Ÿåˆ(æœ‰æ’å€¼).png", dpi=300)
        plt.close()

        # plt.show()


class Centrifugal_Pump_Characteristics_Plotter:
    def __init__(self, calculator):
        self.calculator = calculator
        self.ans2 = calculator.ans2
        self.df = calculator.df
        self.params_H = calculator.params_H
        self.params_N = calculator.params_N
        self.params_Î· = calculator.params_Î·

    @staticmethod
    def quadratic(x, a, b, c):
        return a * x**2 + b * x + c

    def plot(self):
        """ç»˜åˆ¶ç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿"""
        # è®¾ç½®å­—ä½“
        plt.rcParams["font.sans-serif"] = ["SimHei"]
        plt.rcParams["axes.unicode_minus"] = False

        # è·å–æ•°æ®
        Q = self.df.iloc[:, 1].values  # æµé‡(mÂ³/h)
        H = self.ans2[:, 0]  # æ‰¬ç¨‹(m)
        N_elc_e = self.ans2[:, 1]  # æœ‰æ•ˆåŠŸç‡(W)
        Î· = self.ans2[:, 2]  # æ•ˆç‡

        # å•ä½è½¬æ¢
        N_elc_e_kW = N_elc_e / 1000  # W â†’ kW
        Î·_percent = Î· * 100  # å°æ•° â†’ ç™¾åˆ†æ¯”

        # ç”Ÿæˆæ‹Ÿåˆæ•°æ®
        Q_fit = np.linspace(Q.min(), Q.max(), 100)
        H_fit = self.quadratic(Q_fit, *self.params_H)
        N_fit = self.quadratic(Q_fit, *self.params_N) / 1000  # kW
        Î·_fit = self.quadratic(Q_fit, *self.params_Î·) * 100  # %

        # åˆ›å»ºå›¾å½¢
        fig, ax1 = plt.subplots(figsize=(7.85, 6), dpi=125)
        ax1.scatter(Q, H, color="blue", label="æ‰¬ç¨‹æ•°æ®")
        ax1.plot(Q_fit, H_fit, "b-", label="æ‰¬ç¨‹æ‹Ÿåˆ")
        ax1.set_xlabel("$Q/(m^3/h)$")
        ax1.set_ylabel("$H/m$", color="blue")
        ax1.tick_params(axis="y", labelcolor="blue")

        ax2 = ax1.twinx()
        ax2.scatter(Q, N_elc_e_kW, color="red", label="åŠŸç‡æ•°æ®")
        ax2.plot(Q_fit, N_fit, "r--", label="åŠŸç‡æ‹Ÿåˆ")
        ax2.set_ylabel("$N/kW$", color="red")
        ax2.tick_params(axis="y", labelcolor="red")

        ax3 = ax1.twinx()
        ax3.spines["right"].set_position(("outward", 60))
        ax3.scatter(Q, Î·_percent, color="green", label="æ•ˆç‡æ•°æ®")
        ax3.plot(Q_fit, Î·_fit, "g-.", label="æ•ˆç‡æ‹Ÿåˆ")
        ax3.set_ylabel("$\eta/\%$", color="green")
        ax3.tick_params(axis="y", labelcolor="green")

        fig.legend(loc="upper center", bbox_to_anchor=(0.5, 1.08), ncol=3)
        plt.title("ç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿åŠäºŒæ¬¡æ‹Ÿåˆ")
        plt.tight_layout(rect=[0.05, 0.03, 0.95, 0.93])
        plt.savefig("./æ‹Ÿåˆå›¾ç»“æœ/ç¦»å¿ƒæ³µç‰¹æ€§æ›²çº¿åŠäºŒæ¬¡æ‹Ÿåˆ.png", dpi=300)
        # plt.show()


class PlotManager:
    def __init__(self, auxiliary):
        self.auxiliary = auxiliary
        self.results = auxiliary.get_results()

    def plot_all(self):
        """ç»˜åˆ¶æ‰€æœ‰ç»“æœ"""
        if "fluid" in self.results:
            fluid_calculator = Fluid_Flow_Calculator(self.auxiliary.file_paths[0])
            fluid_calculator.process()
            fluid_plotter = Fluid_Flow_Plotter(fluid_calculator)
            fluid_plotter.plot()

        if "pump" in self.results:
            pump_calculator = Centrifugal_Pump_Characteristics_Calculator(self.auxiliary.file_paths[1])
            pump_calculator.process()
            pump_plotter = Centrifugal_Pump_Characteristics_Plotter(pump_calculator)
            pump_plotter.plot()


if __name__ == "__main__":
    os.makedirs("./æ‹Ÿåˆå›¾ç»“æœ", exist_ok=True)

    # æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    file_paths = [
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/æµä½“é˜»åŠ›åŸå§‹æ•°æ®.csv",
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/ç¦»å¿ƒæ³µåŸå§‹æ•°æ®.csv",
    ]

    # åˆ›å»ºAuxiliaryå®ä¾‹å¹¶å¤„ç†æ–‡ä»¶
    auxiliary = Auxiliary(file_paths)
    auxiliary.process_files()

    # åˆ›å»ºPlotManagerå®ä¾‹å¹¶ç»˜åˆ¶æ‰€æœ‰ç»“æœ
    plot_manager = PlotManager(auxiliary)
    plot_manager.plot_all()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\heat_transfer_plotter.py çš„å†…å®¹:
================================================================================
# heat_transfer_plotter.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import matplotlib.pyplot as plt

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams["font.family"] = "SimHei"
plt.rcParams["axes.unicode_minus"] = False
plt.rcParams["figure.dpi"] = 50
plt.rcParams["savefig.dpi"] = 300

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

from gui.screens.calculators.heat_transfer_calculator import Heat_Transfer_Calculator


class Heat_Transfer_Plotter:
    def __init__(self, calculator_results):
        """
        åˆå§‹åŒ–ç”»å›¾ç±»

        å‚æ•°:
        calculator_results: ä»Heat_Transfer_Calculatorè·å–çš„ç»“æœæ•°æ®
        """
        self.results = calculator_results
        self.setup_plot_style()  # åˆå§‹åŒ–æ—¶è®¾ç½®å…¨å±€æ ·å¼

    def fit_func(self, x, a, b):
        """
        æ‹Ÿåˆå‡½æ•°ï¼Œç”¨äºæ›²çº¿æ‹Ÿåˆã€‚

        å‚æ•°:
        x (numpy.ndarray): è‡ªå˜é‡
        a (float): æ‹Ÿåˆå‚æ•°
        b (float): æ‹Ÿåˆå‚æ•°

        è¿”å›:
        numpy.ndarray: æ‹Ÿåˆç»“æœ
        """
        return a + b * x

    def setup_plot_style(self):
        """ç»Ÿä¸€é…ç½®ç»˜å›¾æ ·å¼"""
        plt.rcParams.update(
            {
                "font.family": "Microsoft YaHei",
                "font.size": 12,
                "axes.unicode_minus": False,
                "figure.dpi": 50,
                "savefig.dpi": 300,
                "axes.linewidth": 2,
                "grid.linestyle": "-",
                "grid.linewidth": 1,
                "mathtext.default": "regular",
                "font.sans-serif": ["Microsoft YaHei", "SimHei", "DejaVu Sans"],  # å­—ä½“å›é€€åˆ—è¡¨
                "text.usetex": False,
                "mathtext.fontset": "dejavusans",  # ä½¿ç”¨ä¸ä¸­æ–‡å­—ä½“å…¼å®¹çš„æ•°å­¦å­—ä½“
            }
        )

    def create_directory(self, filepath):
        """ç¡®ä¿æ–‡ä»¶ä¿å­˜è·¯å¾„å­˜åœ¨"""
        directory = os.path.dirname(filepath)
        if not os.path.exists(directory):
            os.makedirs(directory, exist_ok=True)

    def configure_plot(self, title):
        """é…ç½®é€šç”¨ç»˜å›¾å‚æ•°"""
        plt.xscale("log")
        plt.yscale("log")
        plt.xlabel(r"$\mathrm{Re}$", fontsize=14, fontweight="bold")
        plt.ylabel(r"$\mathrm{Nu/Pr^{0.4}}$", fontsize=14, fontweight="bold")
        plt.title(title, fontsize=10, fontweight="bold")
        plt.grid(True, which="both")
        plt.minorticks_on()
        ax = plt.gca()
        for spine in ax.spines.values():
            spine.set_linewidth(2)

    def plot_fit(self, data_for_fit, filename, title):
        """ä¼˜åŒ–åçš„æ‹Ÿåˆç»˜å›¾æ–¹æ³•"""
        if len(data_for_fit) == 0:
            print(f"è­¦å‘Šï¼šè·³è¿‡ {title} çš„ç»˜å›¾ï¼Œæ•°æ®ä¸ºç©º")
            return

        try:
            # æ›²çº¿æ‹Ÿåˆ
            ans_params, _ = curve_fit(
                self.fit_func,
                np.log10(data_for_fit[:, 0]),
                np.log10(data_for_fit[:, 1]),
            )
        except Exception as e:
            print(f"æ›²çº¿æ‹Ÿåˆå¤±è´¥ï¼š{str(e)}")
            return

        # é…ç½®å›¾å½¢
        plt.figure(figsize=(8, 6), dpi=125)
        self.configure_plot(title)

        # ç»˜åˆ¶æ•°æ®ç‚¹åŠæ‹Ÿåˆæ›²çº¿
        plt.scatter(data_for_fit[:, 0], data_for_fit[:, 1], color="r", label="å®éªŒæ•°æ®")
        plt.plot(
            data_for_fit[:, 0],
            10 ** self.fit_func(np.log10(data_for_fit[:, 0]), *ans_params),
            color="k",
            label="æ‹Ÿåˆæ›²çº¿",
        )

        # æ·»åŠ æ‹Ÿåˆæ–¹ç¨‹æ–‡æœ¬
        equation_text = f"æ‹Ÿåˆæ–¹ç¨‹: y = {10**ans_params[0]:.10f} * x^{ans_params[1]:.2f}"
        plt.text(
            0.05,
            0.95,
            equation_text,
            transform=plt.gca().transAxes,
            fontsize=12,
            verticalalignment="top",
            bbox=dict(boxstyle="round", facecolor="white", alpha=0.8),
        )

        # ä¿å­˜è¾“å‡º
        self.create_directory(filename)
        plt.legend()
        plt.savefig(filename, bbox_inches="tight")
        plt.close()

    def generate_plots(self):
        """ç”Ÿæˆæ‰€æœ‰åˆ†æå›¾è¡¨"""
        # å¤„ç†ç¬¬ä¸€ç»„æ•°æ®ï¼ˆæ— å¼ºåŒ–å¥—ç®¡ï¼‰
        if len(self.results) > 0 and self.results[0]["params"] is not None:
            self.plot_fit(
                self.results[0]["data_for_fit"],
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æ— å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "æ— å¼ºåŒ–å¥—ç®¡ä¼ çƒ­æ€§èƒ½åˆ†æ",
            )

        # å¤„ç†ç¬¬äºŒç»„æ•°æ®ï¼ˆæœ‰å¼ºåŒ–å¥—ç®¡ï¼‰
        if len(self.results) > 1 and self.results[1]["params"] is not None:
            self.plot_fit(
                self.results[1]["data_for_fit"],
                "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/æœ‰å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆ.png",
                "æœ‰å¼ºåŒ–å¥—ç®¡ä¼ çƒ­æ€§èƒ½åˆ†æ",
            )

        # ç”Ÿæˆå¯¹æ¯”å›¾
        self.generate_comparison_plot()

    def generate_comparison_plot(self):
        """ç”Ÿæˆå¯¹æ¯”åˆ†æå›¾"""
        has_valid_data = False
        plt.figure(figsize=(10, 8), dpi=125)
        self.configure_plot("ä¼ çƒ­æ€§èƒ½å¯¹æ¯”åˆ†æ")

        # ç»˜åˆ¶ç¬¬ä¸€ç»„æ•°æ®ï¼ˆæ— å¼ºåŒ–å¥—ç®¡ï¼‰
        if len(self.results) > 0 and self.results[0]["params"] is not None:
            data = self.results[0]["data_for_fit"]
            plt.scatter(
                data[:, 0],
                data[:, 1],
                color="r",
                marker="o",
                s=80,
                label="æ— å¼ºåŒ–å¥—ç®¡å®éªŒæ•°æ®",
            )
            plt.plot(
                data[:, 0],
                10 ** self.fit_func(np.log10(data[:, 0]), *self.results[0]["params"]),
                color="r",
                linestyle="--",
                linewidth=2,
                label="æ— å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆæ›²çº¿",
            )
            has_valid_data = True

        # ç»˜åˆ¶ç¬¬äºŒç»„æ•°æ®ï¼ˆæœ‰å¼ºåŒ–å¥—ç®¡ï¼‰
        if len(self.results) > 1 and self.results[1]["params"] is not None:
            data = self.results[1]["data_for_fit"]
            plt.scatter(
                data[:, 0],
                data[:, 1],
                color="b",
                marker="s",
                s=80,
                label="æœ‰å¼ºåŒ–å¥—ç®¡å®éªŒæ•°æ®",
            )
            plt.plot(
                data[:, 0],
                10 ** self.fit_func(np.log10(data[:, 0]), *self.results[1]["params"]),
                color="b",
                linestyle="-.",
                linewidth=2,
                label="æœ‰å¼ºåŒ–å¥—ç®¡æ‹Ÿåˆæ›²çº¿",
            )
            has_valid_data = True

        if has_valid_data:
            self.create_directory("./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/ä¼ çƒ­æ€§èƒ½å¯¹æ¯”.png")
            plt.legend(fontsize=12, loc="upper left")
            plt.savefig("./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/ä¼ çƒ­æ€§èƒ½å¯¹æ¯”.png", bbox_inches="tight")
            plt.close()
        else:
            print("è­¦å‘Šï¼šæ— æœ‰æ•ˆæ•°æ®ç”Ÿæˆå¯¹æ¯”å›¾")


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # å®šä¹‰CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
    csv_file_paths = [
        "åŸå§‹æ•°æ®_æ— å¼ºåŒ–å¥—ç®¡.csv",
        "åŸå§‹æ•°æ®_æœ‰å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†_æ— å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†_æœ‰å¼ºåŒ–å¥—ç®¡.csv",
    ]

    # å®ä¾‹åŒ–ä¼ çƒ­è®¡ç®—å™¨ï¼ˆéœ€è¦ç¡®ä¿Heat_Transfer_Calculatorå·²ä¿®æ”¹ä¸ºæ¥å—CSVæ–‡ä»¶ï¼‰
    heat_transfer_calculator = Heat_Transfer_Calculator(csv_file_paths)

    # æ•°æ®å¤„ç†
    heat_transfer_calculator.process_data()

    # åˆ›å»ºä½œå›¾å™¨å¹¶ä¼ é€’è®¡ç®—ç»“æœ
    plotter = Heat_Transfer_Plotter(heat_transfer_calculator.results)

    # ç”Ÿæˆå¹¶ä¿å­˜å›¾è¡¨
    plotter.generate_plots()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\oxygen_desorption_plotter.py çš„å†…å®¹:
================================================================================
# oxygen_desorption_plotter.py

# å†…ç½®åº“
import sys
import os


# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from pathlib import Path
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit
from scipy.stats import pearsonr
import warnings

warnings.filterwarnings("ignore")


from gui.screens.calculators.oxygen_desorption_calculator import Oxygen_Desorption_Calculator
from gui.screens.calculators.oxygen_desorption_calculator import Packed_Tower_Calculator


class Packed_Tower_Plotter:
    def __init__(self, calculator):
        self.calculator = calculator
        self._init_plot_style()

    def _init_plot_style(self):
        plt.rcParams["font.family"] = "SimHei"
        plt.rcParams["axes.unicode_minus"] = False

    def plot_comparison(self, save_path=None):
        plt.figure(figsize=(10, 6))

        # ç¡®ä¿æœ‰åˆ†æç»“æœ
        if not self.calculator.results:
            raise ValueError("æ²¡æœ‰å¯ç”¨çš„åˆ†æç»“æœï¼Œè¯·å…ˆè¿è¡Œanalyze_all_files()")

        # ç»˜åˆ¶å¹²å¡«æ–™æ•°æ®
        dry_data = next((r for r in self.calculator.results if "å¹²å¡«æ–™" in r["csv_file"]), None)
        if dry_data:
            self._plot_single(dry_data, "å¹²å¡«æ–™", "red")

        # ç»˜åˆ¶æ¹¿å¡«æ–™æ•°æ®
        wet_data = next((r for r in self.calculator.results if "æ¹¿å¡«æ–™" in r["csv_file"]), None)
        if wet_data:
            self._plot_single(wet_data, "æ¹¿å¡«æ–™", "blue")

        plt.xlabel("ç©ºå¡”æ°”é€Ÿ u (m/s)")
        plt.ylabel("å•ä½é«˜åº¦å‹é™ Î”p/Z (kPa/m)")
        plt.title("å¡«æ–™å¡”æµä½“åŠ›å­¦æ€§èƒ½å¯¹æ¯”")
        plt.legend()
        plt.grid(True)
        plt.xlim(0, 1.3)
        plt.ylim(0, 40)
        ExperimentUtils.set_spine_width(plt.gca())

        # å¤„ç†ä¿å­˜è·¯å¾„
        output_path = save_path if save_path else "./æ‹Ÿåˆå›¾ç»“æœ/å¡«æ–™å¡”æ€§èƒ½å¯¹æ¯”.png"
        Path(output_path).parent.mkdir(parents=True, exist_ok=True)
        plt.savefig(output_path, dpi=300, bbox_inches="tight")
        # plt.show()

    def _plot_single(self, data, label, color):
        u = data["u"]
        delta_p = data["delta_p"]
        popt = data["popt"]

        plt.scatter(u, delta_p, color=color, label=label)
        x_fit = np.linspace(min(u), max(u), 100)

        if data["fit_type"] == "linear":
            y_fit = self.calculator.linear_fit(x_fit, *popt)
            eq = f"$Î”p/Z = {popt[0]:.1f}u + {popt[1]:.1f}$"
        else:
            y_fit = self.calculator.taylor_fit(x_fit, *popt)
            eq = self._format_taylor_eq(popt)

        plt.plot(x_fit, y_fit, "k--", label=eq)

    @staticmethod
    def _format_taylor_eq(coefficients):
        terms = []
        for i, coeff in enumerate(coefficients):
            if abs(coeff) > 1e-6:  # å¿½ç•¥æ¥è¿‘é›¶çš„ç³»æ•°
                term = f"{coeff:.1f}u^{i}" if i > 0 else f"{coeff:.1f}"
                terms.append(term)
        return "$Î”p/Z = " + "+".join(terms) + "$" if terms else ""


class Oxygen_Desorption_Plotter:
    def __init__(self, calculator):
        self.calculator = calculator
        self._init_plot_style()

    def _init_plot_style(self):
        plt.rcParams["font.family"] = "SimHei"
        plt.rcParams["axes.unicode_minus"] = False

    def plot_correlation(self, save_path=None):
        plt.figure(figsize=(8, 8))

        # ç¡®ä¿æœ‰åˆ†æç»“æœ
        if not self.calculator.results:
            raise ValueError("æ²¡æœ‰å¯ç”¨çš„åˆ†æç»“æœï¼Œè¯·å…ˆè¿è¡Œanalyze_all_files()")

        for result in self.calculator.results:
            csv_file = result["csv_file"]
            label = Path(csv_file).stem.replace("_", " ")
            plt.scatter(result["L"], result["Kxa"], label=label)

        plt.xlabel("æ¶²ç›¸æµé‡ L (mol/s)")
        plt.ylabel("ä¼ è´¨ç³»æ•° Kxa")
        plt.title("æ°§è§£å¸ä¼ è´¨ç³»æ•°å…³è”")
        plt.legend()
        plt.grid(True)
        ExperimentUtils.set_spine_width(plt.gca())

        # å¤„ç†ä¿å­˜è·¯å¾„
        output_path = save_path if save_path else "./æ‹Ÿåˆå›¾ç»“æœ/æ°§è§£å¸ä¼ è´¨å…³è”.png"
        Path(output_path).parent.mkdir(parents=True, exist_ok=True)
        plt.savefig(output_path, dpi=300, bbox_inches="tight")
        # plt.show()


class ExperimentUtils:
    @staticmethod
    def set_spine_width(ax, width=2):
        """è®¾ç½®å›¾è¡¨è¾¹æ¡†ç²—ç»†"""
        for spine in ax.spines.values():
            spine.set_linewidth(width)


# ====================== ä¸»ç¨‹åº ======================
if __name__ == "__main__":
    from gui.screens.calculators.oxygen_desorption_calculator import (
        ExperimentDataLoader,
        Packed_Tower_Calculator,
        Oxygen_Desorption_Calculator,
    )

    try:
        # åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨ï¼Œç›´æ¥ä¼ å…¥å››ä¸ªæ–‡ä»¶çš„å…¨è·¯å¾„
        data_loader = ExperimentDataLoader(
            dry_packed="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/å¹²å¡«æ–™.csv",
            wet_packed="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ¹¿å¡«æ–™.csv",
            water_constant="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv",
            air_constant="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv",
        )

        # å¡«æ–™å¡”åˆ†æ
        tower_calculator = Packed_Tower_Calculator(data_loader)
        tower_calculator.analyze_all_files()
        tower_plotter = Packed_Tower_Plotter(tower_calculator)
        tower_plotter.plot_comparison()

        # æ°§è§£å¸åˆ†æ
        oxygen_calculator = Oxygen_Desorption_Calculator(data_loader)
        oxygen_calculator.analyze_all_files()
        oxygen_plotter = Oxygen_Desorption_Plotter(oxygen_calculator)
        oxygen_plotter.plot_correlation()

    except FileNotFoundError as e:
        print(f"é”™è¯¯: {str(e)}")
        print("è¯·ç¡®ä¿æ‰€æœ‰å¿…éœ€æ–‡ä»¶éƒ½å­˜åœ¨")
    except Exception as e:
        print(f"å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\plotters\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\distillation_experiment_processor.py çš„å†…å®¹:
================================================================================
# distillation_experiment_processor.py

import os
import sys
import zipfile
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = Path(current_script_path).parents[3]
sys.path.insert(0, str(project_root))

from gui.screens.calculators.distillation_calculator import Distillation_Calculator
from gui.screens.plotters.distillation_plotter import Distillation_Plotter


class Distillation_Experiment_Processor:
    """
    ç²¾é¦å®éªŒæµç¨‹å¤„ç†å™¨

    åŠŸèƒ½æ‰©å±•ï¼š
    - è‡ªåŠ¨åŒ–æ‰§è¡Œå®Œæ•´å®éªŒæµç¨‹
    - ç»“æœæ–‡ä»¶ç®¡ç†
    - æ•°æ®æ‰“åŒ…è¾“å‡º

    ä¸»è¦æ–¹æ³•ï¼š
    process_experiment() - æ‰§è¡Œå®Œæ•´å¤„ç†æµç¨‹
    """

    def __init__(self, file_path, R, Î±m, F, tS, tF, output_dir="å®éªŒç»“æœ"):
        """
        åˆå§‹åŒ–å®éªŒå¤„ç†å™¨

        å‚æ•°ï¼š
        output_dir (str): ç»“æœè¾“å‡ºç›®å½•
        """
        # å›æµæ¯”
        self.R = R

        # åˆå§‹åŒ–è®¡ç®—å¼•æ“
        self.calculator = Distillation_Calculator(file_path=file_path, R=R, Î±m=Î±m, F=F, tS=tS, tF=tF)

        # åˆå§‹åŒ–å¯è§†åŒ–å¼•æ“
        self.plotter = Distillation_Plotter(self.calculator)

        # é…ç½®è¾“å‡ºè·¯å¾„
        self.file_path = file_path
        self.output_dir = Path(output_dir)
        self.base_name = Path(file_path).stem
        self._prepare_directory()

    def _prepare_directory(self):
        """åˆ›å»ºç»“æ„åŒ–è¾“å‡ºç›®å½•"""
        (self.output_dir / "åŸå§‹æ•°æ®").mkdir(parents=True, exist_ok=True)
        (self.output_dir / "è®¡ç®—ç»“æœ").mkdir(parents=True, exist_ok=True)
        (self.output_dir / "æ‹Ÿåˆå›¾ç»“æœ").mkdir(parents=True, exist_ok=True)

    def process_experiment(self, show_plot=False):
        """
        æ‰§è¡Œå®Œæ•´å®éªŒå¤„ç†æµç¨‹

        å‚æ•°ï¼š
        show_plot (bool): æ˜¯å¦æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨
        """
        try:
            # ä¿å­˜è®¡ç®—ç»“æœ
            self._save_text_results()

            # ç”Ÿæˆå¯è§†åŒ–
            self._generate_plots(show=show_plot)

            # æ‰“åŒ…ç»“æœ
            self._create_archive()

            print(f"å®éªŒå¤„ç†å®Œæˆï¼Œç»“æœä¿å­˜åœ¨ï¼š{self.output_dir.resolve()}")
            return True
        except Exception as e:
            print(f"å¤„ç†å¤±è´¥ï¼š{str(e)}")
            return False

    def _save_text_results(self):
        """ä¿å­˜æ–‡æœ¬è®¡ç®—ç»“æœ"""
        result_path = self.output_dir / "è®¡ç®—ç»“æœ" / f"{self.base_name}_results.txt"
        self.calculator.save_results(str(result_path))

    def _generate_plots(self, show=True):
        """ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨"""
        plot_path = self.output_dir / "æ‹Ÿåˆå›¾ç»“æœ" / f"{self.base_name}.png"
        self.plotter.plot_mccabe_thiele(save_path=str(plot_path), show=show)

    def _create_archive(self):
        """åˆ›å»ºZIPæ‰“åŒ…æ–‡ä»¶"""
        zip_path = self.output_dir / f"{self.base_name}_results.zip"

        with zipfile.ZipFile(zip_path, "w") as zipf:
            # åŸå§‹æ•°æ®
            zipf.write(self.file_path, arcname=f"åŸå§‹æ•°æ®/{Path(self.file_path).name}")

            # è®¡ç®—ç»“æœ
            text_file = self.output_dir / "è®¡ç®—ç»“æœ" / f"{self.base_name}_results.txt"
            zipf.write(text_file, arcname=text_file.name)

            # å¯è§†åŒ–ç»“æœ
            plot_file = self.output_dir / "æ‹Ÿåˆå›¾ç»“æœ" / f"{self.base_name}.png"
            zipf.write(plot_file, arcname=plot_file.name)

    @property
    def result_paths(self):
        """è·å–å„ç»“æœæ–‡ä»¶è·¯å¾„"""
        return {
            "original_data": self.file_path,
            "text_results": self.output_dir / "è®¡ç®—ç»“æœ" / f"{self.base_name}_results.txt",
            "visualization": self.output_dir / "æ‹Ÿåˆå›¾ç»“æœ" / f"{self.base_name}.png",
            "archive": self.output_dir / f"{self.base_name}_results.zip",
        }


if __name__ == "__main__":
    # ä½¿ç”¨ç¤ºä¾‹
    DATA_FILE = "./csv_data/ç²¾é¦/ç²¾é¦åŸå§‹è®°å½•è¡¨(é)/Sheet1.csv"

    # å¤„ç†å¸¸è§„å›æµæ¯” (R=4)
    processor_normal = Distillation_Experiment_Processor(
        file_path=DATA_FILE, R=4, Î±m=2.0, F=80, tS=30, tF=26, output_dir="å®éªŒç»“æœ/R4"
    )
    processor_normal.process_experiment(show_plot=True)

    # å¤„ç†å…¨å›æµ (R=+âˆ)
    processor_infinite = Distillation_Experiment_Processor(
        file_path=DATA_FILE, R=10000, Î±m=2.0, F=80, tS=30, tF=26, output_dir="å®éªŒç»“æœ/å…¨å›æµ"
    )
    processor_infinite.process_experiment()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\drying_experiment_processor.py çš„å†…å®¹:
================================================================================
# drying_experiment_processor.py

# å†…ç½®åº“
import sys
import os
import numpy as np
import pandas as pd
import zipfile

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from gui.screens.calculators.drying_calculator import Drying_Calculator
from gui.screens.plotters.drying_plotter import Drying_Plotter


class Drying_Experiment_Processor(Drying_Calculator):
    def __init__(self, csv_file_paths):
        """
        åˆå§‹åŒ–å®éªŒå¤„ç†å™¨ï¼Œç›´æ¥ä¼ å…¥CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        """
        super().__init__(csv_file_paths)
        self._plotter = None  # ç»˜å›¾å™¨å®ä¾‹ï¼Œåˆå§‹åŒ–æ—¶ä¸ºNone

    def process_experiment(self, output_dir="./æ‹Ÿåˆç»“æœ"):
        """
        å¤„ç†æ•´ä¸ªå¹²ç‡¥å®éªŒè¿‡ç¨‹
        åŒ…æ‹¬è®¡ç®—ã€ç»˜å›¾å’Œç»“æœè¾“å‡º
        """
        # è¿è¡Œå®Œæ•´è®¡ç®—
        self.run_full_calculation()

        # åˆ›å»ºç»˜å›¾å™¨å®ä¾‹ï¼ˆå¦‚æœå°šæœªåˆ›å»ºï¼‰
        if self._plotter is None:
            self._plotter = Drying_Plotter(self)

        # è¿è¡Œå®Œæ•´ç»˜å›¾
        return self._plotter.run_full_plotting(output_dir)

    def get_results(self):
        """
        è·å–å®Œæ•´çš„è®¡ç®—ç»“æœ
        """
        return self.results

    def get_plots(self, plot_type="combined"):
        """
        è·å–ç»˜å›¾ç»“æœ
        å¯é€‰å‚æ•°ï¼šplot_type ('combined', 'curve', 'rate')
        """
        # ç¡®ä¿ç»˜å›¾å™¨å·²ç»åˆ›å»º
        if self._plotter is None:
            self._plotter = Drying_Plotter(self)

        if plot_type == "combined":
            return self._plotter.integrate_images()
        elif plot_type == "curve":
            return self._plotter.plot_drying_curve()
        elif plot_type == "rate":
            return self._plotter.plot_drying_rate_curve()
        else:
            raise ValueError("æ— æ•ˆçš„ç»˜å›¾ç±»å‹ï¼Œè¯·é€‰æ‹© 'combined', 'curve' æˆ– 'rate'")

    def __str__(self):
        return f"Drying_Experiment_Processorå¤„ç†äº†{len(self.csv_file_paths)}ä¸ªCSVæ–‡ä»¶"


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    csv_files = [
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®1.csv",
        "./csv_data/å¹²ç‡¥åŸå§‹æ•°æ®è®°å½•è¡¨(é)/åŸå§‹æ•°æ®2.csv",
    ]

    # åˆå§‹åŒ–å®éªŒå¤„ç†å™¨
    processor = Drying_Experiment_Processor(csv_files)

    # å¤„ç†å®éªŒå¹¶è¾“å‡ºç»“æœ
    outputs = processor.process_experiment()

    print("å®éªŒå¤„ç†å®Œæˆï¼Œç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š")
    print(f"- ç»„åˆå›¾è¡¨: {outputs['combined_plot']}")
    print(f"- å‹ç¼©åŒ…: {outputs['zip_archive']}")
    print(f"- åºåˆ—åŒ–æ•°æ®: {outputs['serialized_data']}")

    # è·å–è®¡ç®—ç»“æœ
    results = processor.get_results()

    # æ‰“å°éƒ¨åˆ†è®¡ç®—ç»“æœ
    print("\néƒ¨åˆ†è®¡ç®—ç»“æœï¼š")
    print(f"æ’å®šå¹²ç‡¥é€Ÿç‡ U_c: {processor.U_c}")
    print(f"ä¼ çƒ­ç³»æ•° Î±: {processor.Î±}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\extraction_expriment_processor.py çš„å†…å®¹:
================================================================================
# extraction_experiment_processor.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

import logging

# é…ç½®æ—¥å¿—è®¾ç½®
logging.basicConfig(level=logging.DEBUG, format="%(asctime)s - %(levelname)s - %(message)s")

import argparse
from gui.screens.calculators.extraction_calculator import Extraction_Calculator
from gui.screens.plotters.extraction_plotter import Extraction_Plotter


class ExtractionExperimentProcessor:
    def __init__(self, main_file=None, distribution_file=None):
        """
        åˆå§‹åŒ–å®éªŒå¤„ç†å™¨
        :param main_file: ä¸»æ•°æ®æ–‡ä»¶è·¯å¾„
        :param distribution_file: åˆ†é…æ›²çº¿æ•°æ®æ–‡ä»¶è·¯å¾„
        """
        self.main_file = main_file
        self.distribution_file = distribution_file
        self.calculator = None
        self.plotter = None

        # ç»“æœè¾“å‡ºé…ç½®
        self.output_dir = "./æ‹Ÿåˆå›¾ç»“æœ"
        self.zip_file = "èƒå–åˆ†æç»“æœ.zip"

    def validate_files(self):
        """éªŒè¯è¾“å…¥æ–‡ä»¶æœ‰æ•ˆæ€§"""
        missing_files = []
        if not os.path.exists(self.main_file):
            missing_files.append(self.main_file)
        if not os.path.exists(self.distribution_file):
            missing_files.append(self.distribution_file)

        if missing_files:
            raise FileNotFoundError(f"ä»¥ä¸‹å¿…è¦æ–‡ä»¶ç¼ºå¤±ï¼š{', '.join(missing_files)}")

    def setup_components(self):
        """åˆå§‹åŒ–å„å¤„ç†ç»„ä»¶"""
        self.calculator = Extraction_Calculator(self.main_file, self.distribution_file)
        self.plotter = Extraction_Plotter(self.calculator)
        self.plotter.output_dir = self.output_dir

    def process_data(self):
        """æ‰§è¡Œå®Œæ•´æ•°æ®å¤„ç†æµç¨‹"""
        # æ•°æ®è®¡ç®—é˜¶æ®µ
        self.calculator.run_calculations()

        # å¯è§†åŒ–é˜¶æ®µ
        self.plotter.create_output_dir()
        print("\næ­£åœ¨ç”Ÿæˆåˆ†æå›¾è¡¨...")
        self.plotter.plot_main_curves()
        self.plotter.plot_integration_curves()

        # ç»“æœæ‰“åŒ…
        print("æ­£åœ¨æ‰“åŒ…ç»“æœæ–‡ä»¶...")
        self.plotter.package_results(self.zip_file)

    def print_summary(self):
        """è¾“å‡ºå¤„ç†ç»“æœæ‘˜è¦"""
        print(f"\n{'='*40}")
        print("å¤„ç†å®Œæˆï¼ç»“æœæ–‡ä»¶å·²ä¿å­˜è‡³ï¼š")
        print(f"- å›¾è¡¨ç›®å½•: {os.path.abspath(self.output_dir)}")
        print(f"- å‹ç¼©åŒ…æ–‡ä»¶: {os.path.abspath(self.zip_file)}")
        print(f"{'='*40}")

    def run(self):
        """ä¸»æ‰§è¡Œæµç¨‹"""
        try:
            self.validate_files()
            self.setup_components()
            self.process_data()
            self.print_summary()
        except Exception as e:
            print(f"\nå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š{str(e)}")
            print("å»ºè®®æ£€æŸ¥ï¼š")
            print("1. è¾“å…¥æ–‡ä»¶æ ¼å¼æ˜¯å¦ç¬¦åˆè¦æ±‚")
            print("2. æ•°æ®åˆ—æ˜¯å¦å®Œæ•´")
            print("3. ç³»ç»Ÿå­—ä½“é…ç½®æ˜¯å¦æ­£ç¡®")
            raise


def parse_arguments():
    """è§£æå‘½ä»¤è¡Œå‚æ•°"""
    parser = argparse.ArgumentParser(description="èƒå–å®éªŒæ•°æ®å¤„ç†ç³»ç»Ÿ")
    parser.add_argument(
        "--main",
        type=str,
        default="./1 åŸå§‹æ•°æ®è®°å½•.csv",
        help="ä¸»æ•°æ®æ–‡ä»¶è·¯å¾„",
    )
    parser.add_argument(
        "--distribution",
        type=str,
        default="./3 åˆ†é…æ›²çº¿æ•°æ®é›†.csv",
        help="åˆ†é…æ›²çº¿æ•°æ®æ–‡ä»¶è·¯å¾„",
    )
    return parser.parse_args()


if __name__ == "__main__":
    # å‘½ä»¤è¡Œå‚æ•°è§£æ
    args = parse_arguments()

    # åˆ›å»ºå¤„ç†å™¨å®ä¾‹å¹¶è¿è¡Œ
    processor = ExtractionExperimentProcessor(main_file=args.main, distribution_file=args.distribution)
    processor.run()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\filteration_experiment_processor.py çš„å†…å®¹:
================================================================================
# filteration_experiment_processor.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import zipfile
import matplotlib.pyplot as plt
from gui.screens.calculators.filteration_calculator import Filteration_Calculator
from gui.screens.plotters.filteration_plotter import Filteration_Plotter

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams["font.family"] = "SimHei"
plt.rcParams["axes.unicode_minus"] = False
plt.rcParams["figure.dpi"] = 50
plt.rcParams["savefig.dpi"] = 300


class Filteration_Experiment_Processor:
    """
    è´Ÿè´£å¤„ç†è¿‡æ»¤å®éªŒæ•°æ®çš„ç±»ã€‚
    è¯¥ç±»å¤„ç†æ•°æ®åŠ è½½ã€æ‹Ÿåˆã€å¼‚å¸¸å€¼æ£€æµ‹ä»¥åŠç”Ÿæˆç»“æœå›¾å½¢ã€‚
    """

    def __init__(self, csv_file_path):
        """
        åˆå§‹åŒ–ç±»å¹¶åŠ è½½CSVæ–‡ä»¶ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚
        :param csv_file_path: åŒ…å«æ•°æ®çš„CSVæ–‡ä»¶è·¯å¾„
        """
        self.csv_file_path = csv_file_path

        # åˆå§‹åŒ–è®¡ç®—ç±»å¤„ç†æ•°æ®
        self.calculator = Filteration_Calculator(csv_file_path)

        # åˆå§‹åŒ–ç»˜å›¾ç±»ç”Ÿæˆå›¾å½¢
        self.plotter = Filteration_Plotter(csv_file_path)

        # åˆå§‹åŒ–ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨å¤„ç†åçš„æ•°æ®
        self.processed_data = []

        # å­˜å‚¨æ¥è‡ªFilteration_Calculatorå’ŒFilteration_Plotterçš„æ•°æ®
        self.calculator_data = {
            "data": self.calculator.data,
            "q_to_refit_lists": self.calculator.q_to_refit_lists,
            "delta_theta_over_delta_q_to_refit_lists": self.calculator.delta_theta_over_delta_q_to_refit_lists,
            "refit_slopes": self.calculator.refit_slopes,
            "refit_intercepts": self.calculator.refit_intercepts,
            "selected_data": self.calculator.selected_data,
            "data_array": self.calculator.data_array,
            "deltaV": self.calculator.deltaV,
            "S": self.calculator.S,
            "deltaQ": self.calculator.deltaQ,
            "delta_theta_list": self.calculator.delta_theta_list,
            "delta_q_list": self.calculator.delta_q_list,
            "delta_theta_over_delta_q_list": self.calculator.delta_theta_over_delta_q_list,
            "q_list": self.calculator.q_list,
            "q_to_fit": self.calculator.q_to_fit,
            "delta_theta_over_delta_q_to_fit": self.calculator.delta_theta_over_delta_q_to_fit,
            "fit_model": self.calculator.fit_model,
            "fit_data": self.calculator.fit_data,
            "fit_slope": self.calculator.fit_slope,
            "fit_intercept": self.calculator.fit_intercept,
            "outliers": self.calculator.outliers,
            "refit_model": self.calculator.refit_model,
            "filtered_data": self.calculator.filtered_data,
        }

        self.plotter_data = {
            "q_to_refit_lists": self.plotter.q_to_refit_lists,
            "delta_theta_over_delta_q_to_refit_lists": self.plotter.delta_theta_over_delta_q_to_refit_lists,
            "refit_slopes": self.plotter.refit_slopes,
            "refit_intercepts": self.plotter.refit_intercepts,
        }

    def calculate(self):
        """
        ä½¿ç”¨è®¡ç®—ç±»å¤„ç†æ•°æ®ã€‚
        å¤„ç†å„ç»„æ•°æ®å¹¶è¿”å›è¿›ä¸€æ­¥åˆ†ææ‰€éœ€çš„ä¿¡æ¯ã€‚
        """
        # å¤„ç†æ‰€æœ‰ç»„çš„æ•°æ®å¹¶å­˜å‚¨ç»“æœ
        (
            self.q_to_refit_lists,
            self.delta_theta_over_delta_q_to_refit_lists,
            self.refit_slopes,
            self.refit_intercepts,
        ) = self.calculator.process_all_groups()

    def store(self):
        """
        å°†å¤„ç†åçš„æ•°æ®å­˜å‚¨åˆ°ç±»çš„processed_dataåˆ—è¡¨ä¸­ã€‚
        è¿™äº›æ•°æ®å°†ç”¨äºç”Ÿæˆç»“æœå’Œå›¾å½¢ã€‚
        """
        for i in range(3):
            # å­˜å‚¨æ¯ç»„å¤„ç†åçš„æ•°æ®ï¼ˆqå€¼ã€æ–œç‡ã€æˆªè·ï¼‰åˆ°å­—å…¸ä¸­
            group_data = {
                "group": i + 1,
                "q_values": self.q_to_refit_lists[i],
                "slope": self.refit_slopes[i],
                "intercept": self.refit_intercepts[i],
            }
            # å°†æ¯ç»„çš„æ•°æ®æ·»åŠ åˆ°processed_dataåˆ—è¡¨ä¸­
            self.processed_data.append(group_data)

    def plot(self):
        """
        ä½¿ç”¨ç»˜å›¾ç±»åŸºäºå¤„ç†åçš„æ•°æ®ç”Ÿæˆæ‰€æœ‰æ‰€éœ€çš„å›¾å½¢ã€‚
        """
        # ä½¿ç”¨ç»˜å›¾ç±»ç”Ÿæˆå›¾å½¢
        self.plotter.generate_all_figures()

    def compress_results(self):
        """
        å°†ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶å‹ç¼©æˆä¸€ä¸ªzipæ–‡ä»¶ï¼Œä¾¿äºåˆ†å‘å’Œå­˜å‚¨ã€‚
        """
        dir_to_zip = r"./æ‹Ÿåˆå›¾ç»“æœ"  # å­˜æ”¾ç»“æœçš„ç›®å½•
        dir_to_save = r"./æ‹Ÿåˆå›¾ç»“æœ.zip"  # ç›®æ ‡zipæ–‡ä»¶è·¯å¾„

        # åˆ›å»ºzipæ–‡ä»¶å¹¶å°†ç»“æœç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ è¿›å»
        with zipfile.ZipFile(dir_to_save, "w", zipfile.ZIP_DEFLATED) as zipf:
            for root, dirs, files in os.walk(dir_to_zip):
                for file in files:
                    file_dir = os.path.join(root, file)
                    arc_name = os.path.relpath(file_dir, dir_to_zip)
                    zipf.write(file_dir, arc_name)

        # æ‰“å°å‹ç¼©å®Œæˆçš„ç¡®è®¤ä¿¡æ¯
        print(f"å‹ç¼©å®Œæˆã€‚æ–‡ä»¶å·²ä¿å­˜ä¸º: {dir_to_save}")


if __name__ == "__main__":
    # å®šä¹‰CSVæ–‡ä»¶çš„è·¯å¾„è¿›è¡Œå¤„ç†
    csv_file_path = r"./è¿‡æ»¤åŸå§‹æ•°æ®è®°å½•è¡¨(é).csv"

    # åˆå§‹åŒ–å¤„ç†ç±»
    processor = Filteration_Experiment_Processor(csv_file_path)

    # ç¬¬ä¸€æ­¥ï¼šå¤„ç†æ•°æ®ï¼ˆåŒ…æ‹¬æ‹Ÿåˆã€å¼‚å¸¸å€¼æ£€æµ‹ç­‰ï¼‰
    processor.calculate()  # å¤„ç†æ•°æ®ï¼ˆè®¡ç®—ã€æ‹Ÿåˆç­‰ï¼‰

    # ç¬¬äºŒæ­¥ï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼ˆå¯é€‰æ­¥éª¤ï¼Œç”¨äºç”Ÿæˆç»“æœæˆ–æ‘˜è¦ï¼‰
    processor.store()  # å­˜å‚¨å¤„ç†åçš„æ•°æ®

    # ç¬¬ä¸‰æ­¥ï¼šåŸºäºå¤„ç†åçš„æ•°æ®ç”Ÿæˆå›¾å½¢
    processor.plot()  # ç”Ÿæˆå›¾å½¢ï¼ˆåˆæ‹Ÿåˆã€å†æ‹Ÿåˆç­‰ï¼‰

    # ç¬¬å››æ­¥ï¼šå‹ç¼©ç»“æœå›¾åƒæ–‡ä»¶ä¸ºzipæ–‡ä»¶
    processor.compress_results()  # å°†ç”Ÿæˆçš„ç»“æœæ–‡ä»¶å‹ç¼©æˆzipæ–‡ä»¶


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\fluid_flow_experiment_processor.py çš„å†…å®¹:
================================================================================
# fluid_flow_experiment_processor.py

# å†…ç½®åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(current_script_path))))
sys.path.insert(0, project_root)

from gui.screens.calculators.fluid_flow_calculator import (
    Fluid_Flow_Calculator,
    Centrifugal_Pump_Characteristics_Calculator,
    Auxiliary,
)
from gui.screens.plotters.fluid_flow_plotter import Fluid_Flow_Plotter, Centrifugal_Pump_Characteristics_Plotter


class Fluid_Flow_Expriment_Processor:
    def __init__(self, file_paths):
        """åˆå§‹åŒ–å®éªŒå¤„ç†å™¨ï¼Œè®¾ç½®æ•°æ®æ–‡ä»¶è·¯å¾„"""
        self.file_paths = file_paths
        self.output_dir = "./æ‹Ÿåˆå›¾ç»“æœ"

        # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
        os.makedirs(self.output_dir, exist_ok=True)

        # åˆå§‹åŒ–è®¡ç®—å™¨å’Œç»˜å›¾å™¨
        self.fluid_calculator = None
        self.pump_calculator = None
        self.fluid_plotter = None
        self.pump_plotter = None

        # åˆå§‹åŒ–è¾…åŠ©ç±»
        self.auxiliary = Auxiliary(file_paths)

    def process_fluid_flow(self):
        """å¤„ç†æµä½“é˜»åŠ›å®éªŒæ•°æ®"""
        fluid_file_path = self.auxiliary.identify_file_type(self.file_paths[0])
        if fluid_file_path == "fluid":
            self.fluid_calculator = Fluid_Flow_Calculator(self.file_paths[0])
            ans1, df1 = self.fluid_calculator.process()
            self.fluid_plotter = Fluid_Flow_Plotter(self.fluid_calculator)
            return ans1, df1
        else:
            raise ValueError("ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸æ˜¯æµä½“é˜»åŠ›æ•°æ®æ–‡ä»¶")

    def process_pump_characteristics(self):
        """å¤„ç†ç¦»å¿ƒæ³µç‰¹æ€§å®éªŒæ•°æ®"""
        pump_file_path = self.auxiliary.identify_file_type(self.file_paths[1])
        if pump_file_path == "pump":
            self.pump_calculator = Centrifugal_Pump_Characteristics_Calculator(self.file_paths[1])
            ans2, df2, params_H, params_N, params_Î· = self.pump_calculator.process()
            self.pump_plotter = Centrifugal_Pump_Characteristics_Plotter(self.pump_calculator)
            return ans2, df2, params_H, params_N, params_Î·
        else:
            raise ValueError("ç¬¬äºŒä¸ªæ–‡ä»¶ä¸æ˜¯ç¦»å¿ƒæ³µæ•°æ®æ–‡ä»¶")

    def generate_all_plots(self):
        """ç”Ÿæˆæ‰€æœ‰åˆ†æå›¾è¡¨"""
        if not self.fluid_plotter:
            self.process_fluid_flow()
        if not self.pump_plotter:
            self.process_pump_characteristics()

        self.fluid_plotter.plot()
        self.pump_plotter.plot()

    def get_fluid_flow_results(self):
        """è·å–æµä½“é˜»åŠ›å®éªŒç»“æœ"""
        if not self.fluid_calculator:
            self.process_fluid_flow()
        return {
            "velocity": self.fluid_calculator.ans1[:, 0],
            "reynolds": self.fluid_calculator.ans1[:, 1],
            "friction_factor": self.fluid_calculator.ans1[:, 2],
            "log_reynolds": self.fluid_calculator.log_Re,
            "log_friction": self.fluid_calculator.log_Î»,
            "polynomial": self.fluid_calculator.p,
        }

    def get_pump_characteristics_results(self):
        """è·å–ç¦»å¿ƒæ³µç‰¹æ€§å®éªŒç»“æœ"""
        if not self.pump_calculator:
            self.process_pump_characteristics()
        return {
            "head": self.pump_calculator.ans2[:, 0],
            "power": self.pump_calculator.ans2[:, 1],
            "efficiency": self.pump_calculator.ans2[:, 2],
            "head_params": self.pump_calculator.params_H,
            "power_params": self.pump_calculator.params_N,
            "efficiency_params": self.pump_calculator.params_Î·,
        }


if __name__ == "__main__":
    # æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    file_paths = [
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/æµä½“é˜»åŠ›åŸå§‹æ•°æ®.csv",
        "./csv_data/æµä½“/æµä½“åŸå§‹æ•°æ®è®°å½•è¡¨(é)/ç¦»å¿ƒæ³µåŸå§‹æ•°æ®.csv",
    ]

    # åˆ›å»ºå®éªŒå¤„ç†å™¨å®ä¾‹
    processor = Fluid_Flow_Expriment_Processor(file_paths)

    # å¤„ç†æµä½“é˜»åŠ›æ•°æ®
    fluid_ans, fluid_df = processor.process_fluid_flow()

    # å¤„ç†ç¦»å¿ƒæ³µæ•°æ®
    pump_ans, pump_df, pump_params_H, pump_params_N, pump_params_Î· = processor.process_pump_characteristics()

    # ç”Ÿæˆæ‰€æœ‰å›¾è¡¨
    processor.generate_all_plots()

    # è·å–ç»“æœ
    fluid_results = processor.get_fluid_flow_results()
    pump_results = processor.get_pump_characteristics_results()

    # æ‰“å°ç»“æœ
    print("æµä½“é˜»åŠ›å®éªŒç»“æœ:", fluid_results)
    print("ç¦»å¿ƒæ³µç‰¹æ€§å®éªŒç»“æœ:", pump_results)


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\heat_transfer_experiment_processor.py çš„å†…å®¹:
================================================================================
# heat_transfer_experiment_processor.py

# å†…éƒ¨åº“
import sys
import os

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = os.path.dirname(os.path.dirname(os.path.dirname(current_script_path)))
sys.path.insert(0, project_root)

import zipfile
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

from gui.screens.calculators.heat_transfer_calculator import Heat_Transfer_Calculator
from gui.screens.plotters.heat_transfer_plotter import Heat_Transfer_Plotter

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams["font.family"] = "SimHei"
plt.rcParams["axes.unicode_minus"] = False
plt.rcParams["figure.dpi"] = 50
plt.rcParams["savefig.dpi"] = 300


class Heat_Transfer_Experiment_Processor:
    """
    è´Ÿè´£å¤„ç†ä¼ çƒ­å®éªŒæ•°æ®çš„ç±»ã€‚
    è¯¥ç±»å¤„ç†æ•°æ®åŠ è½½ã€è®¡ç®—ã€æ‹Ÿåˆã€å¼‚å¸¸å€¼æ£€æµ‹ä»¥åŠç”Ÿæˆç»“æœå›¾å½¢ã€‚
    ä¿®æ”¹ä¸ºå¤„ç†CSVæ–‡ä»¶è€ŒéExcelæ–‡ä»¶ã€‚
    """

    def __init__(self, csv_file_paths):
        """
        åˆå§‹åŒ–ç±»å¹¶åŠ è½½CSVæ–‡ä»¶ä»¥è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚
        :param csv_file_paths: åŒ…å«ä¼ çƒ­å®éªŒæ•°æ®çš„CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
        """
        self.csv_file_paths = csv_file_paths  # å­˜å‚¨CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨

        # åˆå§‹åŒ–è®¡ç®—ç±»å¤„ç†æ•°æ®
        self.calculator = Heat_Transfer_Calculator(csv_file_paths)

        # åˆå§‹åŒ–ç»˜å›¾ç±»ç”Ÿæˆå›¾å½¢
        self.plotter = Heat_Transfer_Plotter(self.calculator.results)

        # åˆå§‹åŒ–ä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨å¤„ç†åçš„æ•°æ®
        self.processed_data = []

        # å­˜å‚¨æ¥è‡ªè®¡ç®—å™¨å¤„ç†åçš„æ•°æ®
        self.calculator_data = {"results": self.calculator.results}

    def calculate(self):
        """
        ä½¿ç”¨è®¡ç®—ç±»å¤„ç†ä¼ çƒ­å®éªŒæ•°æ®ã€‚
        å¤„ç†å„ç»„æ•°æ®å¹¶è¿”å›æ‹Ÿåˆç»“æœå’Œè®¡ç®—ä¿¡æ¯ã€‚
        """
        # åŠ è½½æ•°æ®
        datasets = self.calculator.load_data()

        # æ•°æ®é¢„å¤„ç†ï¼ˆå·²åœ¨åˆå§‹åŒ–ä¸­å®Œæˆï¼‰

        # æ•°æ®å¤„ç†
        self.calculator.process_data()

    def store(self):
        """
        å°†å¤„ç†åçš„æ•°æ®å­˜å‚¨åˆ°ç±»çš„processed_dataåˆ—è¡¨ä¸­ã€‚
        è¿™äº›æ•°æ®å°†ç”¨äºç”Ÿæˆç»“æœå’Œå›¾å½¢ã€‚
        """
        for idx, result in enumerate(self.calculator.results):
            group_data = {
                "group": idx + 1,
                "type": "æ— å¼ºåŒ–å¥—ç®¡" if idx == 0 else "æœ‰å¼ºåŒ–å¥—ç®¡",
                "data_for_fit": result["data_for_fit"],
                "params": result["params"],
                "original_data": result["original_data"],
                "calculated_data": result["calculated_data"],
            }
            self.processed_data.append(group_data)

    def plot(self):
        """
        ä½¿ç”¨ç»˜å›¾ç±»åŸºäºå¤„ç†åçš„æ•°æ®ç”Ÿæˆæ‰€æœ‰æ‰€éœ€çš„å›¾å½¢ã€‚
        """
        # ç”Ÿæˆå¹¶ä¿å­˜å›¾è¡¨
        self.plotter.generate_plots()

    def compress_results(self):
        """
        å°†ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶å‹ç¼©æˆä¸€ä¸ªzipæ–‡ä»¶ï¼Œä¾¿äºåˆ†å‘å’Œå­˜å‚¨ã€‚
        """
        dir_to_zip = r"./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ"  # å­˜æ”¾ç»“æœçš„ç›®å½•
        dir_to_save = r"./ä¼ çƒ­å®éªŒç»“æœ.zip"  # ç›®æ ‡zipæ–‡ä»¶è·¯å¾„

        # æ£€æŸ¥ç»“æœç›®å½•æ˜¯å¦å­˜åœ¨
        if not os.path.exists(dir_to_zip):
            print(f"è­¦å‘Šï¼šç»“æœç›®å½• {dir_to_zip} ä¸å­˜åœ¨ï¼Œæ— æ³•å‹ç¼©")
            return

        # åˆ›å»ºzipæ–‡ä»¶å¹¶å°†ç»“æœç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ è¿›å»
        with zipfile.ZipFile(dir_to_save, "w", zipfile.ZIP_DEFLATED) as zipf:
            for root, dirs, files in os.walk(dir_to_zip):
                for file in files:
                    file_path = os.path.join(root, file)
                    arcname = os.path.relpath(file_path, dir_to_zip)
                    zipf.write(file_path, arcname)

        # æ‰“å°å‹ç¼©å®Œæˆçš„ç¡®è®¤ä¿¡æ¯
        print(f"å‹ç¼©å®Œæˆã€‚æ–‡ä»¶å·²ä¿å­˜ä¸º: {dir_to_save}")

    def generate_summary_report(self):
        """
        ç”Ÿæˆå®éªŒæ•°æ®æ‘˜è¦æŠ¥å‘Š
        """
        report = []
        for data in self.processed_data:
            report.append(
                {
                    "å®éªŒç±»å‹": data["type"],
                    "æ•°æ®ç‚¹æ•°": len(data["data_for_fit"]),
                    "æ‹Ÿåˆå‚æ•°A": (data["params"][0] if data["params"] is not None else "N/A"),
                    "æ‹Ÿåˆå‚æ•°B": (data["params"][1] if data["params"] is not None else "N/A"),
                }
            )

        report_df = pd.DataFrame(report)
        report_path = "./ä¼ çƒ­æ‹Ÿåˆå›¾ç»“æœ/å®éªŒæ‘˜è¦.csv"
        os.makedirs(os.path.dirname(report_path), exist_ok=True)
        report_df.to_csv(report_path, index=False, encoding="utf_8_sig")
        print(f"å®éªŒæ‘˜è¦å·²ä¿å­˜è‡³: {report_path}")


if __name__ == "__main__":
    # å®šä¹‰CSVæ–‡ä»¶è·¯å¾„åˆ—è¡¨
    csv_file_paths = [
        "åŸå§‹æ•°æ®-æ— å¼ºåŒ–å¥—ç®¡.csv",
        "åŸå§‹æ•°æ®-æœ‰å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†-æ— å¼ºåŒ–å¥—ç®¡.csv",
        "æ•°æ®é¢„å¤„ç†-æœ‰å¼ºåŒ–å¥—ç®¡.csv",
    ]

    # åˆå§‹åŒ–å¤„ç†ç±»
    processor = Heat_Transfer_Experiment_Processor(csv_file_paths)

    # ç¬¬ä¸€æ­¥ï¼šå¤„ç†æ•°æ®ï¼ˆåŒ…æ‹¬è®¡ç®—ã€æ‹Ÿåˆç­‰ï¼‰
    processor.calculate()

    # ç¬¬äºŒæ­¥ï¼šå­˜å‚¨å¤„ç†åçš„æ•°æ®ï¼ˆå¯é€‰æ­¥éª¤ï¼Œç”¨äºç”Ÿæˆç»“æœæˆ–æ‘˜è¦ï¼‰
    processor.store()

    # ç¬¬ä¸‰æ­¥ï¼šåŸºäºå¤„ç†åçš„æ•°æ®ç”Ÿæˆå›¾å½¢
    processor.plot()

    # ç¬¬å››æ­¥ï¼šç”Ÿæˆå®éªŒæ‘˜è¦æŠ¥å‘Š
    processor.generate_summary_report()

    # ç¬¬äº”æ­¥ï¼šå‹ç¼©ç»“æœå›¾åƒæ–‡ä»¶ä¸ºzipæ–‡ä»¶
    processor.compress_results()


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\oxygen_desorption_experiment_processor.py çš„å†…å®¹:
================================================================================
# Oxygen_Desorption_Experiment_Processor_processor.py

# å†…éƒ¨åº“
import sys
import os
from pathlib import Path

# åŠ¨æ€è·å–é¡¹ç›®æ ¹è·¯å¾„
current_script_path = os.path.abspath(__file__)
project_root = Path(current_script_path).parents[3]  # parents[3]å‘ä¸Š4çº§åˆ°é¡¹ç›®æ ¹
sys.path.insert(0, str(project_root))

import zipfile
from typing import Optional

from gui.screens.calculators.oxygen_desorption_calculator import (
    Experiment_Data_Loader,
    Packed_Tower_Calculator,
    Oxygen_Desorption_Calculator,
)
from gui.screens.plotters.oxygen_desorption_plotter import Packed_Tower_Plotter, Oxygen_Desorption_Plotter


class ResultCompressor:
    @staticmethod
    def compress_results(output_dir: str = "./æ‹Ÿåˆå›¾ç»“æœ", zip_name: str = "æ‹Ÿåˆå›¾ç»“æœ.zip"):
        """å‹ç¼©ç»“æœæ–‡ä»¶

        Args:
            output_dir (str): ç»“æœæ–‡ä»¶ç›®å½•
            zip_name (str): å‹ç¼©åŒ…åç§°

        Raises:
            FileNotFoundError: å½“è¾“å‡ºç›®å½•ä¸å­˜åœ¨æ—¶æŠ›å‡º
        """
        output_path = Path(output_dir)
        if not output_path.exists():
            raise FileNotFoundError(f"ç›®å½• {output_dir} ä¸å­˜åœ¨")

        with zipfile.ZipFile(zip_name, "w") as zipf:
            for file_path in output_path.rglob("*"):
                if file_path.is_file():
                    arcname = file_path.relative_to(output_path)
                    zipf.write(file_path, arcname)
        print(f"ç»“æœå·²å‹ç¼©è‡³ {Path(zip_name).absolute()}")


class Oxygen_Desorption_Experiment_Processor:
    def __init__(
        self,
        dry_packed_path: str,
        wet_packed_path: str,
        water_constant_path: str,
        air_constant_path: str,
        output_dir: Optional[str] = None,
    ):
        """åˆå§‹åŒ–å®éªŒå¤„ç†å™¨

        Args:
            dry_packed_path: å¹²å¡«æ–™æ•°æ®æ–‡ä»¶è·¯å¾„
            wet_packed_path: æ¹¿å¡«æ–™æ•°æ®æ–‡ä»¶è·¯å¾„
            water_constant_path: æ°´æµé‡ä¸€å®šæ•°æ®æ–‡ä»¶è·¯å¾„
            air_constant_path: ç©ºæ°”æµé‡ä¸€å®šæ•°æ®æ–‡ä»¶è·¯å¾„
            output_dir: è¾“å‡ºç›®å½•è·¯å¾„ï¼Œé»˜è®¤ä¸º"./æ‹Ÿåˆå›¾ç»“æœ"
        """
        # åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨
        self.data_loader = Experiment_Data_Loader(
            dry_packed=dry_packed_path,
            wet_packed=wet_packed_path,
            water_constant=water_constant_path,
            air_constant=air_constant_path,
        )

        # è®¾ç½®è¾“å‡ºç›®å½•
        self.output_dir = Path(output_dir) if output_dir else Path("./æ‹Ÿåˆå›¾ç»“æœ")
        self.output_dir.mkdir(parents=True, exist_ok=True)

    def run_full_analysis(self, compress_results: bool = True):
        """æ‰§è¡Œå®Œæ•´åˆ†ææµç¨‹

        Args:
            compress_results: æ˜¯å¦å‹ç¼©ç»“æœæ–‡ä»¶ï¼Œé»˜è®¤ä¸ºTrue
        """
        try:
            # å¡«æ–™å¡”åˆ†æ
            tower_calculator = Packed_Tower_Calculator(self.data_loader)
            tower_calculator.analyze_all_files()

            tower_plotter = Packed_Tower_Plotter(tower_calculator)
            tower_plotter.plot_comparison(save_path=str(self.output_dir / "å¡«æ–™å¡”æ€§èƒ½å¯¹æ¯”.png"))

            # æ°§è§£å¸åˆ†æ
            oxygen_calculator = Oxygen_Desorption_Calculator(self.data_loader)
            oxygen_calculator.analyze_all_files()

            oxygen_plotter = Oxygen_Desorption_Plotter(oxygen_calculator)
            oxygen_plotter.plot_correlation(save_path=str(self.output_dir / "æ°§è§£å¸ä¼ è´¨å…³è”.png"))

            # å¯é€‰ç»“æœå‹ç¼©
            if compress_results:
                ResultCompressor.compress_results(
                    output_dir=str(self.output_dir), zip_name=str(self.output_dir.parent / "æ‹Ÿåˆå›¾ç»“æœ.zip")
                )

        except Exception as e:
            print(f"åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {str(e)}")
            raise


if __name__ == "__main__":
    # ä½¿ç”¨ç¤ºä¾‹
    try:
        # æ›¿æ¢ä¸ºå®é™…æ–‡ä»¶è·¯å¾„
        processor = Oxygen_Desorption_Experiment_Processor(
            dry_packed_path="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/å¹²å¡«æ–™.csv",
            wet_packed_path="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ¹¿å¡«æ–™.csv",
            water_constant_path="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/æ°´æµé‡ä¸€å®š_ç©ºæ°”æµé‡æ”¹å˜.csv",
            air_constant_path="./csv_data/è§£å¸åŸå§‹è®°å½•è¡¨(é)/ç©ºæ°”æµé‡ä¸€å®š_æ°´æµé‡æ”¹å˜.csv",
        )

        processor.run_full_analysis()

    except Exception as e:
        print(f"ç¨‹åºè¿è¡Œå¤±è´¥: {str(e)}")


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\processors\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\utils\config.py çš„å†…å®¹:
================================================================================
# å¿«æ·é”®å¯¹åº”event.stateçš„æ•°å€¼
SHORTCUT_CODE = {"Shift": 0x1, "Control": 0x4, "Command": 0x8, "Alt": 0x20000}

DATA_CONFIG = {
    "app": None,
    "window": None,
    "screen": None,
    "mode": None,
    "csv_len": -1,
    "csv": None,
    "time_lower_limit": 30,
    "time_upper_limit": 40,
    "std_limit": 0.005,
}

SCREEN_CONFIG = {"borderwidth": 5, "relief": "raised"}

MAIN_FRAME_CONFIG = {"borderwidth": 5, "relief": "sunken"}

RAISED_SUBFRAME_CONFIG = {"borderwidth": 1, "relief": "raised"}

FLAT_SUBFRAME_CONFIG = {"borderwidth": 2}

ENTRY_LABEL_CONFIG = {"padding": 2}

PLOT_CONFIG = {
    "MainScatter": {"s": 5, "color": "dimgray"},
    "MainLine": {"linewidth": 1, "color": "#1F77B4"},
}

DEFAULT_DATA_VALUE = {
    # å…¶ä»–é»˜è®¤å€¼
}


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\utils\expserial.py çš„å†…å®¹:
================================================================================
# gui/utils/expserial.py

# Author: å®‰å­å½¦
# å†…ç½®åº“
import time

# ç¬¬ä¸‰æ–¹åº“
from func_timeout import func_set_timeout
from serial import Serial, SerialException
from serial.serialutil import PortNotOpenError
from serial.tools import list_ports

# æœ‰å¦‚ä¸‹å‡ ç§æŠ¥é”™
# æ‰¾ä¸åˆ°ç«¯å£ SerialException FileNotFoundError
# å·²ç»æ‰“å¼€çš„ç«¯å£é‡å¤æ‰“å¼€ SerialException Port is already open (ä½†é‡å¤å…³é—­ä¸ä¼šæœ‰é—®é¢˜)
# ç«¯å£è¢«å ç”¨ SerialException PermissionError
# ä½¿ç”¨æœªæ‰“å¼€ç«¯å£ serialutil.PortNotOpenError
# çªç„¶æ–­å¼€è¿æ¥ SerialException GetOverlappedResultï¼ˆå…³æœºæ²¡é—®é¢˜ï¼Œåªæœ‰æ‹”çº¿æœ‰é—®é¢˜ï¼‰
# æ–­å¼€åé‡æ–°æ’å› SerialException ClearCommError ï¼ˆå¥½åƒåªæœ‰é‡æ–°è¿æ¥ä¸€ç§è§£å†³æ–¹æ³•ï¼‰

# å¯åŠ¨æ—¶ä¼šæœ‰ä¸€æ®µFF 80 0A/0B 0D 0E 0A 0Açš„æ•°æ®ï¼Œæ³¨æ„å¤„ç†ã€‚

COMPORTS = []  # å­˜å‚¨ç«¯å£ä¿¡æ¯
port_status = False  # åˆå§‹åŒ–ç«¯å£çŠ¶æ€


# è·å–å¯ç”¨ç«¯å£ä¿¡æ¯
def getComPorts(select=False, timeout: float = 0.25):
    global COMPORTS, port_status

    # ä½¿ç”¨è£…é¥°å™¨è®¾ç½®è¶…æ—¶æ—¶é—´
    @func_set_timeout(timeout)  # è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º0.25s
    def detectComPort(port_name):
        global port_status
        try:
            with Serial(port_name, 1200, timeout=1) as ser:  # æ‰“å¼€ä¿¡æ¯ä¸ºport_nameçš„ç«¯å£ï¼Œæ³¢ç‰¹ç‡1200ï¼Œè¶…æ—¶1s
                port_read = ser.read(7)
                if len(port_read) < 7:  # å¦‚æœè¯»å–çš„æ•°æ®é•¿åº¦å°äº7ï¼Œè¯´æ˜æ²¡æœ‰æ•°æ®ä¼ å…¥
                    return  # è·³è¿‡æœ¬æ¬¡å¾ªç¯
                else:
                    port_status = True
                    return
        except Exception:  # å¦‚æœå‡ºç°å¼‚å¸¸
            return  # è·³è¿‡æœ¬æ¬¡å¾ªç¯

    # æ£€æµ‹ç«¯å£æ˜¯å¦å¯ç”¨
    COMPORTS = []  # æ¸…ç©ºç«¯å£ä¿¡æ¯
    all_ports = list_ports.comports()  # è·å–æ‰€æœ‰ç«¯å£ä¿¡æ¯
    for port_info in all_ports:
        port_status = False  # é»˜è®¤å½“å‰æ£€æµ‹çš„ç«¯å£ä¸å¯ç”¨
        port_name = str(port_info.device)  # éå†è·å–ç«¯å£ä¿¡æ¯
        if select:
            try:
                detectComPort(port_name)  # æ£€æµ‹ç«¯å£æ˜¯å¦å¯ç”¨
            except:
                pass
        if port_status:
            COMPORTS.append(port_name)
    return sorted(COMPORTS, key=lambda x: x[3:])  # è¿”å›ç«¯å£ä¿¡æ¯


# è®¡ç®—æ¸©å·®
def derive_Delta_T(msg):
    dT = msg[3] + (msg[4] + (msg[5] + msg[6] / 10) / 10) / 10
    if msg[2] == 10:
        pass
    elif msg[2] == 11:
        dT = -dT
    elif msg[2] == 1:
        dT += 10
    elif msg[2] == 12:
        dT = -10 - dT
    return dT


class EasySerial:
    """
    å°†serialçš„Serialæ‰“åŒ…æˆåœ¨æœ¬å®éªŒä¸­æ›´æ˜“ä½¿ç”¨çš„ç»“æ„
    """

    def __init__(self, name, baud=1200):  # é™¤éæ›´æ¢è®¾å¤‡ï¼Œå¦åˆ™æ­¤å¤„æ³¢ç‰¹ç‡1200ä¸è¦æ”¹
        self._name = name  # ç«¯å£å
        self._baud = baud  # æ³¢ç‰¹ç‡
        self._port = None  # æœªæ‰“å¼€ç«¯å£
        self._changed = False  # ç«¯å£åæ”¹å˜æ ‡å¿—ä½ï¼Œåˆå§‹ä¸ºFalseï¼Œæ”¹å˜åä¸ºTrue

    # è®¾ç½®è¦æ‰“å¼€çš„ç«¯å£
    def setName(self, name):
        self._name = name
        self._changed = True

    # æ‰“å¼€ç«¯å£
    def open(self):
        self.close()  # å…ˆå…³é—­å¯èƒ½æ‰“å¼€çš„ç«¯å£
        if self._changed or self._port is None:  # å¦‚æœç«¯å£åæ”¹å˜æˆ–ç«¯å£æœªæ‰“å¼€
            try:
                self._port = Serial(self._name, self._baud)  # æ‰“å¼€ç«¯å£
                self._changed = False  # ç«¯å£åæ”¹å˜æ ‡å¿—ä½æ¸…é›¶
            except SerialException as e:
                self._port = None  # æœªæ‰“å¼€ç«¯å£
                s = str(e)
                if "PermissionError" in s:  # æœ€å¯èƒ½æ˜¯å¤šå¼€é€ æˆçš„
                    raise PermissionError("ç«¯å£è¢«å ç”¨ï¼è¯·æŸ¥æ‰¾å¯èƒ½å ç”¨ç«¯å£çš„ç¨‹åºï¼")
                elif "FileNotFoundError" in s:
                    raise FileNotFoundError("æœªçŸ¥ç«¯å£åï¼è¯·æ£€æŸ¥çº¿ç¼†æ˜¯å¦æ­£ç¡®è¿æ¥ï¼")
                else:
                    raise e
        if self._port is not None and not self._port.is_open:  # å¦‚æœç«¯å£åº”æ‰“å¼€ä½†æ‰“å¼€å¤±è´¥
            # è§£å†³äº†ä¸²å£æ–­çº¿é‡è¿çš„é—®é¢˜
            try:
                self._port.open()  # é‡æ–°å°è¯•æ‰“å¼€ç«¯å£
                time.sleep(0.5)  # ç­‰å¾…0.5s
            except SerialException as e:
                pass

    # è¯»å–æ¸©åº¦
    @func_set_timeout(1)
    def read(self):
        if self._port is None:
            "ç«¯å£æœªæ‰“å¼€ï¼è¯·å…ˆæ‰“å¼€ç«¯å£ï¼"
            return
        elif not self._port.is_open:
            try:
                self._port.open()
            except SerialException as e:
                return
        msg = b""
        try:
            self._port.read_all()  #!! æ¸…ç©ºç¼“å­˜
            while self._port.in_waiting < 7:  # ç­‰å¾…7ä¸ªå­—èŠ‚
                pass
            msg = self._port.read(7)  # è¯»å–7ä¸ªå­—èŠ‚
            while len(msg) < 7 or msg.find(b"\xff") < 0:  # å¦‚æœè¯»å–çš„æ•°æ®é•¿åº¦å°äº7æˆ–æ²¡æœ‰æ‰¾åˆ°FF
                msg = self._port.read(7)  # è¯»å–7ä¸ªå­—èŠ‚
            i = msg.find(b"\xff")  # æ‰¾åˆ°ç¬¬ä¸€ä¸ªFFçš„ä½ç½®ï¼Œä½œä¸ºèµ·å§‹ä½ç½®
            msg = msg[i:] + self._port.read(i)  # ä¸€ä¸ªå®Œæ•´çš„æ•°æ®ç”±FFå¼€å¤´ï¼Œå¹¶æœ‰7ä¸ªå­—èŠ‚ï¼Œæ ¹æ®FFçš„ä½ç½®è¡¥å…¨æ•°æ®
            while msg[-1] == 10:  # å¦‚æœæœ€åä¸€ä¸ªå­—èŠ‚ä¸º0Aï¼Œå³å¯åŠ¨æ—¶å‡ºç°çš„éæ¸©å·®æ•°æ®
                msg = self._port.read(7)  # å†è¯»å–7ä¸ªå­—èŠ‚
            temperature = derive_Delta_T(msg)  # è®¡ç®—æ¸©å·®
            return temperature  # è¿”å›æ¸©å·®
        except AssertionError as e:
            print(msg)
            raise e
        except AttributeError as e:
            if "NoneType" in s:
                raise ValueError("ç«¯å£æœªæ‰“å¼€ï¼è¯·å…ˆæ‰“å¼€ç«¯å£ï¼")
            else:
                raise e
        except PortNotOpenError:
            raise ValueError("ç«¯å£æœªæ‰“å¼€ï¼è¯·å…ˆæ‰“å¼€ç«¯å£ï¼")
        except SerialException as e:
            s = str(e)
            if "GetOverlappedResult" in s:
                raise BufferError("è¿æ¥å·²æ–­å¼€ï¼è¯·æ£€æŸ¥ç‰©ç†çº¿ç¼†è¿æ¥ï¼")
            elif "ClearCommError" in s:
                raise IOError("çŠ¶æ€é”™è¯¯ï¼è¯·æ–­å¼€é‡è¿ï¼")
            else:
                raise e

    # å…³é—­ç«¯å£
    def close(self):
        if self._port is not None:
            self._port.close()  # è°ƒç”¨serialçš„closeæ–¹æ³•å…³é—­ç«¯å£


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\utils\__init__.py çš„å†…å®¹:
================================================================================


================================================================================
E:\Chem-Experiment-Process-App\gui\screens\widgets\__init__.py çš„å†…å®¹:
================================================================================


